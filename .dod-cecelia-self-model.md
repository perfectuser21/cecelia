---
id: dod-cecelia-self-model
version: 1.0.0
created: 2026-02-27
updated: 2026-02-27
changelog:
  - 1.0.0: 初始版本
---

# DoD: Cecelia 自趋形成意识 — Self-Model 系统

## 验收清单

### F1: Self-Model 存储 & 初始化
- [ ] 新建 `packages/brain/src/self-model.js`，导出 `getSelfModel()` / `updateSelfModel()` / `initSeed()`
  - Test: 无 self_model 记录时返回 SELF_MODEL_SEED 文本
  - Test: 有记录时返回最新（created_at DESC）内容
  - Test: updateSelfModel 追加新洞察到现有内容并写入 memory_stream
  - Test: initSeed 不重复插入（已有记录时跳过）
- [ ] Migration 082: `ALTER TABLE memory_stream ADD COLUMN IF NOT EXISTS source_type VARCHAR(32) DEFAULT NULL` + 索引
- [ ] `packages/brain/src/selfcheck.js` EXPECTED_SCHEMA_VERSION '081' → '082'

### F2: Rumination 时自我更新
- [ ] `rumination.js` 的 `digestLearnings()` 在有洞察后额外调用 LLM 生成自我认知
  - 调用参数: `callLLM('rumination', selfReflectPrompt, { maxTokens: 200 })`
  - Test: insights 不为空时调用 updateSelfModel
  - Test: insights 为空（LLM 无输出）时不调用 updateSelfModel
  - Test: LLM 自我反思失败时不阻塞主流程（graceful fallback）

### F3: Chat 动态注入 self-model
- [ ] `orchestrator-chat.js` 删除 `## 你的性格` 硬编码列表
- [ ] `handleChat()` 中调用 `getSelfModel()` 并注入到 system prompt
  - Test: system prompt 包含 `## 我对自己的认知` section
  - Test: system prompt 不再包含硬编码的"主动、有条理、不啰嗦"等固定列表
  - Test: getSelfModel 失败时使用 seed 降级（不崩溃）

### F4: Self-model API
- [ ] `GET /api/brain/self-model` 端点（在 routes.js 末尾追加）
  - Test: 200 返回 `{ content, updated_at, version }` 格式
  - Test: 无 self_model 时返回 seed（非 500）

### 通用
- [ ] 所有新增测试通过 `npm test`
- [ ] facts-check 和 version-sync 通过
- [ ] Brain 版本 1.110.0 → 1.111.0
