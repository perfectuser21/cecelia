# PRD: 修复 Dispatch Ramp 死锁 Bug

## 背景

`getRampedDispatchMax()` 在 `brain/src/tick.js` 中实现了渐进式 dispatch 速率控制（ramp up/down）。
该函数只在 `alertness == CALM` 时允许 `current_rate` 增加。

## 问题

当 alertness >= AWARE 时，ramp 形成死锁：
- `current_rate = 0`（初始值或被降为 0）
- `alertness = AWARE`（非 CALM）→ `current_rate` 无法增加
- 没有 dispatch → 任务积压 → queue_blockage 触发 → alertness 维持 AWARE
- **循环死锁**：alertness 越高 → dispatch 越少 → alertness 维持/升高

## 根因

`getRampedDispatchMax()` 逻辑：
```javascript
if (alertness.level >= ALERT) {
  newRate = Math.max(0, currentRate - 1);  // 降速
} else if (pressure > 0.8) {
  newRate = Math.max(1, currentRate - 1);  // 降速
} else if (pressure < 0.5 && alertness === CALM) {
  newRate = currentRate + 1;  // ✅ 只有 CALM 才增加
}
// 否则 stable (不变)
```

当 `currentRate = 0 && alertness = AWARE` 时：
- 不满足 ALERT 条件（level 2 < level 3）
- 不满足 pressure > 0.8（资源正常）
- 不满足 CALM 条件（AWARE ≠ CALM）
- → `stable`，`newRate = 0` 永久不变

## 修复方案

在 `getRampedDispatchMax()` 中，当 `currentRate == 0` 且系统资源正常时，
允许从 0 启动（最小 rate = 1），即使 alertness 是 AWARE（非 CALM）。

**具体逻辑**：
```javascript
// 如果当前速率为0但系统资源正常（非 ALERT+），允许最小启动
if (newRate === 0 && alertness.level < ALERTNESS_LEVELS.ALERT && pressure < 0.8) {
  newRate = 1;  // 最小保底，允许自举
}
```

这样：
- CALM: 正常 ramp up
- AWARE: 允许最小 1 rate 启动（允许自举）
- ALERT+: 保持 0（高警戒时真的不 dispatch）
- pressure > 0.8: 保持 0（资源紧张时不 dispatch）

## 验收标准

- [ ] `current_rate = 0` + `alertness = AWARE` + 资源正常 → `getRampedDispatchMax` 返回 1
- [ ] `current_rate = 0` + `alertness = ALERT` → 返回 0（不允许启动）
- [ ] `current_rate = 0` + `pressure > 0.8` → 返回 0（资源紧张不启动）
- [ ] 正常 CALM 状态下 ramp up 逻辑不变
- [ ] 所有现有 tick 测试通过

## 文件

- `brain/src/tick.js` → `getRampedDispatchMax()`
- `brain/src/__tests__/tick-dispatch.test.js`（如存在）或相关 tick 测试
