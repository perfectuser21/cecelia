---
id: dod-okr-validation-spec
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

# DoD: OKR Validation Spec + Validator (L0)

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|-----------|---------|
| D1 | config/okr-validation-spec.yml 存在且可被 js-yaml 解析 | `validate-okr-spec-load.test.js` | 单元测试 |
| D2 | validateOkrStructure(pool, {scope:'full'}) 返回 {ok, issues} 结构 | `validate-okr-structure.test.js` | 单元测试 |
| D3 | 必须字段检查：goals 缺 title/type/status → BLOCK issue | `validate-okr-structure.test.js` | 单元测试 |
| D4 | parent 存在性：area_okr.parent_id 指向不存在 goal → BLOCK | `validate-okr-structure.test.js` | 单元测试 |
| D5 | parent type 一致性：area_okr.parent type 不是 global_kr → BLOCK | `validate-okr-structure.test.js` | 单元测试 |
| D6 | children 数量范围：KR 有 0 个关联 project → WARNING | `validate-okr-structure.test.js` | 单元测试 |
| D7 | 孤儿检测：task.project_id 指向不存在 project → BLOCK | `validate-okr-structure.test.js` | 单元测试 |
| D8 | pr_plan.depends_on 环检测：A→B→A → BLOCK | `validate-okr-cycle.test.js` | 单元测试 |
| D9 | 文本规则：task.title 包含禁词 → BLOCK | `validate-okr-structure.test.js` | 单元测试 |
| D10 | CI 脚本 scripts/devgate/check-okr-structure.mjs 可独立运行 | `check-okr-structure.test.js` | 集成测试 |
| D11 | facts-check.mjs 通过（文档同步） | `node scripts/facts-check.mjs` | CI |
| D12 | 现有测试全部通过 | `npm test` | CI |

## 验收清单

- [ ] D1: config/okr-validation-spec.yml 存在且可被 js-yaml 解析
- [ ] D2: validateOkrStructure(pool, {scope:'full'}) 返回 {ok, issues} 结构
- [ ] D3: 必须字段检查：goals 缺 title/type/status → BLOCK issue
- [ ] D4: parent 存在性：area_okr.parent_id 指向不存在 goal → BLOCK
- [ ] D5: parent type 一致性：area_okr.parent type 不是 global_kr → BLOCK
- [ ] D6: children 数量范围：KR 有 0 个关联 project → WARNING
- [ ] D7: 孤儿检测：task.project_id 指向不存在 project → BLOCK
- [ ] D8: pr_plan.depends_on 环检测：A→B→A → BLOCK
- [ ] D9: 文本规则：task.title 包含禁词 → BLOCK
- [ ] D10: CI 脚本 scripts/devgate/check-okr-structure.mjs 可独立运行
- [ ] D11: facts-check.mjs 通过（文档同步）
- [ ] D12: 现有测试全部通过
