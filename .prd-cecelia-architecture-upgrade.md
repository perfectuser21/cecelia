## PRD - Cecelia 架构升级：任务分类与多层对话系统

**需求来源**: 用户计划文档 + 讨论补充（任务分类机制缺失问题）

**功能描述**:
将 Cecelia 从简单的任务派发系统升级为完整的管家系统，支持：
1. 多层对话（聊清楚再存）
2. OKR 拆解（规划师）
3. 部门管理（仓库主管）
4. 每日对齐（日报+复盘）
5. **任务分类机制**（关键补充）

**核心改动**:

### 1. 数据库改动
- `goals` 表：增加状态 (needs_info, ready, decomposing 等)
- `tasks` 表：增加 `task_type` 字段 (dev/automation/qa/audit/research)
- `projects` 表：增加 `lead_agent` 字段
- `daily_logs` 表：增加 project_id, agent, type 字段
- 新建 `reflections` 表（合并 learnings + incidents）

### 2. Brain 改动
- 新增 `okr-tick.js`：每 5 分钟检查 status='ready' 的 Goals，触发规划师
- 修改 `tick.js`：routeTask() 根据 task_type 路由到对应 agent
- 新增 `nightly-tick.js`：每晚 22:00 执行对齐
- 新增 API 端点：OKR 问题回答、日报管理

### 3. Skills 改动
- 更新 `/cecelia`：对话收集信息，确认后存储 OKR
- 更新 `/autumnrice`：规划师 + **分类员**（执行者类型 + 组织归属 + OKR 关联）
- 新建 `/repo-lead`：部门主管（读仓库上下文、拆解任务、写日报）

### 4. 前端改动
- `GoalDetail.tsx`：OKR 详情页，支持问题补充
- `DailyReports.tsx`：日报查看页面

**涉及文件**:
- brain/src/db.js (数据库连接)
- brain/src/tick.js (任务路由逻辑)
- brain/src/routes.js (API 端点)
- brain/src/okr-tick.js (新建)
- brain/src/nightly-tick.js (新建)
- ~/.claude/skills/cecelia/SKILL.md
- ~/.claude/skills/autumnrice/SKILL.md
- ~/.claude/skills/repo-lead/SKILL.md (新建)
- frontend/src/pages/GoalDetail.tsx (新建)
- frontend/src/pages/DailyReports.tsx (新建)
- 数据库迁移脚本

**成功标准**:
1. tasks 表有 task_type 字段，routeTask() 能正确路由
2. goals 表状态流转正常：pending → needs_info → ready → decomposing → in_progress
3. Autumnrice 能自动分类任务（类型 + 项目 + OKR）
4. 前端能显示 OKR 详情和日报
5. 端到端测试：需求 → OKR → Tasks → 正确路由执行

**非目标**:
- 不改动现有的 /dev、/qa、/audit 等执行 agent
- 不改动 CI/CD 流程
- 不引入新的外部依赖
