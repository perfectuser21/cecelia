---
id: prd-cp-02182200-auto-rca-on-failure
version: 1.0.0
created: 2026-02-18
updated: 2026-02-18
changelog:
  - 1.0.0: 初始版本
---

## PRD - execution-callback 任务失败时自动触发 RCA

**需求来源**: 用户提出 - 任务失败后缺少自动 RCA 调用链路

**功能描述**:
在任务失败后（execution-callback 处理 failed/timeout/quarantined 状态时），
自动调用 Cortex RCA，记录根因分析结果到 cortex_analyses 表。
使用 rca-deduplication.js 的 shouldAnalyzeFailure() 提供 24h 去重保护。

**涉及文件**:
- `brain/src/routes.js` - POST /api/brain/execution-callback 处理函数（主要修改点）
- `brain/src/__tests__/decision-executor.test.js` - 添加测试用例

**成功标准**:
1. 任务失败（failed/timeout/quarantined）时，异步触发 RCA
2. 24h 内相同错误不重复分析
3. RCA 结果保存到 cortex_analyses 表
4. RCA 失败不影响主回调响应
5. 日志记录 [AutoRCA] 前缀

**非目标**:
- 不修改 Cortex performRCA() 实现
- 不修改 rca-deduplication.js
- completed 状态不触发 RCA
