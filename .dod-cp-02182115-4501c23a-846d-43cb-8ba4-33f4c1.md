# DoD: planner.js 集成 learnings 失败历史权重惩罚

## 验收清单

- [ ] **DoD 1**: `buildLearningPenaltyMap(projectId)` 函数存在于 planner.js，返回 Map<task_type, score>
  - Test: `planner-learning-penalty.test.js` - "DoD 1: buildLearningPenaltyMap 函数存在且返回 Map"

- [ ] **DoD 2**: 无 learnings 时任务评分不变（不惩罚）
  - Test: `planner-learning-penalty.test.js` - "DoD 2: 无 learnings 时任务评分不变"

- [ ] **DoD 3**: 同 task_type 失败 >= 2 次后，惩罚 -20 分（`LEARNING_PENALTY_SCORE`）
  - Test: `planner-learning-penalty.test.js` - "DoD 3: 失败 >= 2 次的任务类型打 -20 分惩罚"

- [ ] **DoD 4**: `generateNextTask` 中失败 task_type 排序靠后
  - Test: `planner-learning-penalty.test.js` - "DoD 4: generateNextTask 中失败 task_type 排序靠后"

- [ ] **DoD 5**: `LEARNING_PENALTY_SCORE`, `LEARNING_LOOKBACK_DAYS`, `LEARNING_FAILURE_THRESHOLD` 导出
  - Test: 已在测试文件中验证导入

- [ ] **DoD 6**: `facts-check.mjs` 通过

- [ ] **DoD 7**: `check-version-sync.sh` 通过（patch bump v1.49.8 → v1.49.9）

## CI 检查映射

| DoD | 测试文件 | 测试名称 |
|-----|----------|----------|
| DoD 1 | planner-learning-penalty.test.js | buildLearningPenaltyMap returns Map |
| DoD 2 | planner-learning-penalty.test.js | no penalty when no failures |
| DoD 3 | planner-learning-penalty.test.js | penalize -20 for 2+ failures |
| DoD 4 | planner-learning-penalty.test.js | deprioritize penalized task_type |
| DoD 5 | planner-learning-penalty.test.js | exports verified |
| DoD 6 | CI facts-check | facts-check.mjs |
| DoD 7 | CI version-sync | check-version-sync.sh |
