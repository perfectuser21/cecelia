---
id: prd-cecelia-chat-to-cmdpalette
version: 1.0.0
created: 2026-02-25
updated: 2026-02-25
changelog:
  - 1.0.0: 初始版本
---

# CeceliaPage V2 Phase 3.1 — ChatDrawer 改为 Cmd+K 命令面板

## 背景

Phase 3 将 CeceliaPage 重构为指挥室布局（PR #9），但用户反馈两个问题：
1. 底部 ChatDrawer 展开后占 50vh，太大，遮挡监控内容
2. 派发按钮点击无反应（已通过重建 Brain Docker 修复，但前端缺少错误反馈）

## 目标

1. 将底部全宽 ChatDrawer 替换为 Cmd+K 命令面板 + 右下角迷你浮动按钮
2. 为 dispatchTask / acknowledgeDesire 添加错误反馈（避免静默失败）

## 设计方案（基于 Linear/Raycast 调研）

### 命令面板 (CommandPalette)
- 触发：Cmd+K / Ctrl+K / 点击右下角气泡
- 位置：居中，top: 15vh
- 尺寸：560px 宽，自适应高（max 420px）
- 背景：slate-900/95 + backdrop-blur
- 功能：文本输入 → AI 回复 + 前端命令路由
- 按 Esc 或点击遮罩关闭

### 迷你浮动气泡
- 尺寸：40x40px 圆形
- 位置：right: 16px, bottom: 16px
- 点击：打开命令面板
- 未读回复时显示小红点

### 错误反馈
- dispatchTask 失败时显示 toast 提示
- acknowledgeDesire 失败时显示 toast 提示

## 不改的部分
- ActionZone、AgentMonitor、TodayOverview、EventStream — 保持不变
- PulseStrip、AmbientGlow — 保持不变
- useCeceliaWS / useBriefing hooks — 保持不变
- Brain 后端 — 不碰

## 成功标准

1. Cmd+K 打开命令面板，Esc 关闭
2. 命令面板支持文本聊天（调用 /api/orchestrator/chat）
3. 右下角迷你气泡点击打开面板
4. ChatDrawer 被完全替代，不再渲染
5. dispatch/acknowledge 失败时有错误提示
6. TypeScript 编译零错误
7. Vite build 成功
