---
id: migration-070-dept-heartbeat-task-type
version: 1.0.0
created: 2026-02-23
updated: 2026-02-23
changelog:
  - 1.0.0: 初始版本
---

# PRD：Migration 070 — 添加 dept_heartbeat 到 task_type 约束

## 需求来源

`tasks_task_type_check` 约束没有包含 `dept_heartbeat` task_type，导致 Cecelia tick 每次尝试为部门创建 heartbeat 任务时失败：

```
ERROR: new row for relation "tasks" violates check constraint "tasks_task_type_check"
```

## 功能描述

修改 tasks 表的 task_type 约束，将 `dept_heartbeat` 加入允许列表，使部门主管 heartbeat 调度正常运行。

## 成功标准

- tasks 表可以插入 task_type='dept_heartbeat' 的记录
- Cecelia tick 成功创建 ZenithJoy heartbeat 任务
- selfcheck.js schema version 更新到 070
- npm test 全部通过
