---
id: autumnrice-dual-mode
version: 1.0.0
created: 2026-01-30
updated: 2026-01-30
changelog:
  - 1.0.0: Initial version
---

# PRD: Autumnrice 双模式路由

## 功能描述

让 `call_autumnrice` 支持两种执行模式：
- **chain** (Agent Chain): 即时执行，同步返回
- **queue** (Task Queue): 任务入库，异步执行（默认）

## 路由规则

| 类别 | 触发信号 | 模式 |
|------|----------|------|
| NOW | 现在/立刻/马上/解释/总结/给我草案 | chain |
| TONIGHT | 今晚跑/明早给我/批量/要PR+CI | queue |
| MIXED | 既要方案又要执行 | chain → queue |

## 强制队列条件

出现以下任意条件，强制 queue：
- 需要 PR/CI/合并
- 有多步骤依赖
- 预计 > 10 分钟
- 可能要重试
- 需要审计日志

## API 变更

```python
call_autumnrice(
    task: str,
    mode: "chain" | "queue" = "queue",  # 新增
    priority: str = "P1",
    project: str = None
)
```

## 成功标准

1. mode="queue" 调用 Orchestrator v2 API（已实现）
2. mode="chain" 调用无头 Claude 即时执行
3. 测试通过
4. 构建通过
