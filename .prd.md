---
id: connect-autumnrice-to-orchestrator
version: 1.0.0
created: 2026-01-30
updated: 2026-01-30
changelog:
  - 1.0.0: Initial version
---

# PRD: 连接 Autumnrice 到 Orchestrator v2

## 功能描述

修改 `call_autumnrice` 工具，让它直接调用 Orchestrator v2 API，而不是运行无头 Claude。

## 背景

当前 `call_autumnrice` 的实现：
```python
# 运行无头 Claude
subprocess.run([claude_path, "-p", prompt, "--model", "opus", ...])
```

问题：
1. 启动慢（需要加载 Claude）
2. 不稳定（依赖外部进程）
3. 无法利用已有的 4 个护栏

## 目标实现

```python
# 直接调用 Orchestrator v2 API
1. 生成 idempotency_key（从任务描述 hash）
2. 创建 TRD（POST /orchestrator/v2/trd）
3. 分解为 Tasks（POST /orchestrator/v2/trd/{id}/plan）
4. 返回结果
```

## 成功标准

1. call_autumnrice 直接调用 Orchestrator v2 内部函数
2. 使用 idempotency_key 防止重复创建
3. 返回创建的 TRD 和 Tasks
4. 测试通过
5. 构建通过
