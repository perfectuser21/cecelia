---
id: prd-cleanup-features-refs
version: 1.0.0
created: 2026-02-14
updated: 2026-02-14
changelog:
  - 1.0.0: 初始版本
---

# PRD: 删除 features 表的所有代码引用

## 功能描述

## 背景
Migration 027 已删除 `features` 表、`tasks.feature_id` 列、`pr_plans.initiative_id` 列。
但代码中仍有大量引用，会导致运行时 SQL 错误。

## 目标
清理所有引用已删除 features 表的代码，确保零运行时错误。

## 范围
- 删除 `feature-tick.js` 和 `anti-crossing.js`（整个文件查询 features 表）
- 删除对应测试文件
- 清理 `routes.js` 中的 feature API 路由和导入
- 清理 `tick.js` 中的 anti-crossing 导入和调用
- 清理 `callback-atomic.test.js` 和 `selfcheck.test.js` 中的 features 引用
- 修复 `pr-plans` 路由中对 features 表的 initiative_id 验证

## 成功标准
- 全局搜索 `FROM features` 返回 0 结果
- 测试全部通过

## 不做
- 不修改 executor.js 中的 `payload.feature_id`（这是 payload 元数据，不是 DB 列）
- 不修改 task-router.js 中的 `feature_id` 参数（纯逻辑判断，不查 DB）
