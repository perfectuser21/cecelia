## PRD - 修复质量检查系统（detect-phase.sh 缺失）

**TASK_ID**: quality-fix-20260125-6ba6
**CHECKPOINT**: CP-001

**需求来源**: 自动化任务 - 修复质量检查系统

**问题描述**:
质量检查系统的核心脚本 `detect-phase.sh` 缺失，导致 Stop Hook 无法正确检测当前开发阶段(p0/p1/p2/pending)。这会导致:
1. Stop Hook 在 line 74 执行 detect-phase.sh 时失败
2. 阶段回退到 "unknown"，直接退出而不执行任何检查
3. 质检门控失效，无法正确判断是否应该继续还是结束会话

**根本原因**:
- `scripts/detect-phase.sh` 文件不存在
- Stop Hook (hooks/stop.sh:73-75) 依赖此脚本判断当前阶段

**功能描述**:
创建 `scripts/detect-phase.sh` 脚本，实现以下功能:
1. 检测当前分支是否有 PR
2. 如果有 PR，检测 CI 状态
3. 根据 PR 和 CI 状态输出阶段标识:
   - `p0`: 无 PR（Published 阶段）
   - `p1`: PR 存在 + CI fail（修复阶段）
   - `p2`: PR 存在 + CI pass（已完成）
   - `pending`: PR 存在 + CI pending（等待中）
   - `unknown`: gh API 错误或无法检测

**涉及文件**:
- `scripts/detect-phase.sh` (新建)
- `docs/PHASE-DETECTION.md` (新建，参考文档)

**成功标准**:
- [ ] detect-phase.sh 脚本创建完成
- [ ] 脚本能正确检测 p0 阶段（无 PR）
- [ ] 脚本能正确检测 p1 阶段（PR + CI fail）
- [ ] 脚本能正确检测 p2 阶段（PR + CI pass）
- [ ] 脚本能正确检测 pending 阶段（PR + CI pending）
- [ ] 脚本能正确处理 gh API 错误返回 unknown
- [ ] Stop Hook 能成功调用脚本不再报错
- [ ] 输出格式符合规范（PHASE: xxx / DESCRIPTION: xxx / ACTION: xxx）
- [ ] PHASE-DETECTION.md 文档创建完成

**技术规范**:
- Bash 脚本，使用 `#!/usr/bin/env bash`
- 使用 `gh` 命令检查 PR 和 CI 状态
- 遵循 hooks/stop.sh 的调用方式（line 74）
- 输出格式参考 skills/dev/SKILL.md 中的定义
