## PRD - Protective Brain Runtime

**需求来源**: Brain 服务需要生产级部署能力：迁移管理、启动自检、不可变镜像、一键部署/回滚
**功能描述**: 为 Cecelia Brain 添加 schema 迁移系统、6 项启动自检、多阶段 Dockerfile、生产/开发 Compose 分离、构建/部署/回滚脚本
**涉及文件**:
  - 新建: brain/src/migrate.js, brain/src/selfcheck.js, brain/src/__tests__/selfcheck.test.js, brain/migrations/005_schema_version_and_config.sql, brain/Dockerfile, brain/.dockerignore, docker-compose.prod.yml, scripts/brain-build.sh, scripts/brain-deploy.sh, scripts/brain-rollback.sh
  - 修改: brain/server.js, brain/package.json, docker-compose.yml, .env.example, .env.docker, .gitignore
**成功标准**:
  - migrate.js 能幂等执行所有迁移并记录到 schema_version 表
  - selfcheck.js 6 项检查全部 PASS（ENV_REGION、DB 连接、region 匹配、核心表、schema 版本、配置指纹）
  - selfcheck 单元测试 10/10 通过（mock pool，不依赖真实 DB）
  - Dockerfile 多阶段构建，非 root 用户 cecelia，镜像 < 200MB
  - docker-compose.prod.yml 使用 read_only rootfs + tmpfs /tmp
  - brain-deploy.sh 完整流程：build → migrate → selfcheck → test → tag → start
  - brain-rollback.sh 可回滚到上一版本
  - 不引入新的测试失败
**非目标**:
  - 不修改现有业务逻辑（tick、executor、planner 等）
  - 不修复预先存在的测试失败（feature-tick、intent、planner 中的 schema drift 问题）
  - 不做跨服务器部署（本期只在 US 服务器本地）
