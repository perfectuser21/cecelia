---
id: audit-fix-module-registration
version: 1.0.0
created: 2026-01-29
updated: 2026-01-29
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复模块注册和数据库初始化

## 背景

代码审计发现 3 个 L2 级别问题，影响模块导入和首次运行：

1. `ParserService` 未在 `parser/__init__.py` 导出
2. `ensure_patrol_table()` 未在启动时调用
3. `ensure_agent_tables()` 未在启动时调用

## 目标

- 修复模块导出，确保 `from src.intelligence.parser import ParserService` 可用
- 在应用启动时自动创建必要的数据库表

## 范围

- `src/intelligence/parser/__init__.py`
- `src/api/main.py`

## 验收标准

1. `python3 -c "from src.intelligence.parser import ParserService"` 成功
2. 应用启动时自动调用 `ensure_patrol_table()` 和 `ensure_agent_tables()`
3. 所有现有测试通过
