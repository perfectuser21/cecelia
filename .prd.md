---
id: prd-task-intelligence
version: 1.4.0
created: 2026-01-28
updated: 2026-01-28
changelog:
  - 1.4.0: Full integration - fix API test compatibility
  - 1.3.0: Milestone 4 - Planner implementation
  - 1.2.0: Milestone 3 - Detector implementation
  - 1.1.0: Milestone 2 - Scheduler implementation
  - 1.0.0: Initial PRD for Task Intelligence integration
---

# PRD: Task Intelligenceï¼ˆä»»åŠ¡æ™ºèƒ½å±‚ï¼‰

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| **åç§°** | Cecelia Task Intelligence |
| **ä»“åº“** | cecelia-semantic-brainï¼ˆé›†æˆåˆ°ç°æœ‰ repoï¼‰|
| **å®šä½** | ä»»åŠ¡æ‹†è§£ã€æ™ºèƒ½è°ƒåº¦ã€è‡ªåŠ¨ç›‘æ§çš„å¤§è„‘ |
| **ä¾èµ–** | Semantic Brainï¼ˆçŸ¥è¯†æ£€ç´¢å±‚ï¼‰|
| **éƒ¨ç½²** | ä¸ Semantic Brain åŒå®¹å™¨ |
| **ç«¯å£** | 5220ï¼ˆå…±ç”¨ï¼‰|
| **æŠ€æœ¯æ ˆ** | Python + FastAPI + LLM API + Rule Engine |

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡

**æ ¸å¿ƒä»·å€¼**ï¼šè®© Cecelia åƒäººä¸€æ ·æ€è€ƒä»»åŠ¡

### ä¸‰å¤§èƒ½åŠ›

1. **ç†è§£æ„å›¾ï¼ˆParserï¼‰**
   - ç”¨æˆ·è¯´ï¼š"å®ç°ç™»å½•åŠŸèƒ½"
   - Brain ç†è§£ï¼šéœ€è¦åç«¯ API + å‰ç«¯ UI + æ•°æ®åº“ + æµ‹è¯•
   - è‡ªåŠ¨æ‹†è§£æˆ 5-8 ä¸ªå¯æ‰§è¡Œçš„å­ä»»åŠ¡

2. **æ™ºèƒ½è°ƒåº¦ï¼ˆSchedulerï¼‰**
   - åˆ†æä¾èµ–ï¼šå‰ç«¯ä¾èµ–åç«¯ API
   - è®¡ç®—ä¼˜å…ˆçº§ï¼šP0 > P1 > P2
   - å†³å®šé¡ºåºï¼šå…ˆåš 1ï¼Œå†å¹¶è¡Œåš 2 å’Œ 3ï¼Œæœ€ååš 4

3. **é™é»˜ç›‘æ§ï¼ˆDetectorï¼‰**
   - CI å¤±è´¥ â†’ è‡ªåŠ¨åˆ›å»ºä¿®å¤ä»»åŠ¡ï¼ˆP0ï¼‰
   - æ–°æäº¤ â†’ è§¦å‘æµ‹è¯•ä»»åŠ¡ï¼ˆP1ï¼‰
   - æ¼æ´å‘ç° â†’ åˆ›å»ºå®‰å…¨ä¿®å¤ä»»åŠ¡ï¼ˆP0ï¼‰

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ï¼ˆæ•´åˆç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Cecelia Semantic Brain (Port 5220)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Semantic Layer (è¯­ä¹‰å±‚ - å·²æœ‰)              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  - Watcher: ç›‘å¬æ–‡ä»¶å˜åŒ–                     â”‚  â”‚
â”‚  â”‚  - Chunker: æ–‡æœ¬åˆ‡å—                         â”‚  â”‚
â”‚  â”‚  - Embedder: å‘é‡åŒ–                          â”‚  â”‚
â”‚  â”‚  - Chroma DB: å‘é‡å­˜å‚¨                       â”‚  â”‚
â”‚  â”‚  - Search API: è¯­ä¹‰æœç´¢                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â†‘                              â”‚
â”‚                      â”‚ è°ƒç”¨æŸ¥è¯¢å†å²                â”‚
â”‚                      â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Intelligence Layer (æ™ºèƒ½å±‚ - æ–°å¢)          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  ğŸ“ Parser (ä»»åŠ¡æ‹†è§£å™¨)                       â”‚  â”‚
â”‚  â”‚     â”œâ”€ Intent Analyzer: ç†è§£ç”¨æˆ·æ„å›¾         â”‚  â”‚
â”‚  â”‚     â”œâ”€ Task Decomposer: æ‹†è§£æˆå­ä»»åŠ¡         â”‚  â”‚
â”‚  â”‚     â”œâ”€ Dependency Builder: æ„å»ºä¾èµ–å…³ç³»      â”‚  â”‚
â”‚  â”‚     â””â”€ ğŸ” è°ƒç”¨ Semantic æŸ¥è¯¢å†å²å®ç°          â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  ğŸ§  Scheduler (æ™ºèƒ½è°ƒåº¦å™¨)                    â”‚  â”‚
â”‚  â”‚     â”œâ”€ Priority Calculator: è®¡ç®—ä¼˜å…ˆçº§        â”‚  â”‚
â”‚  â”‚     â”œâ”€ Dependency Solver: ä¾èµ–æ’åº           â”‚  â”‚
â”‚  â”‚     â””â”€ Concurrency Planner: å¹¶å‘è§„åˆ’         â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  ğŸ¤– Detector (é™é»˜ç›‘æ§å™¨)                     â”‚  â”‚
â”‚  â”‚     â”œâ”€ CI Monitor: ç›‘æ§ GitHub Actions       â”‚  â”‚
â”‚  â”‚     â”œâ”€ Code Monitor: ç›‘æ§ git commits        â”‚  â”‚
â”‚  â”‚     â”œâ”€ Security Monitor: ç›‘æ§æ¼æ´            â”‚  â”‚
â”‚  â”‚     â””â”€ Dependency Monitor: ç›‘æ§ä¾èµ–æ›´æ–°      â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â”‚  ğŸ“Š Planner (æ‰§è¡Œè§„åˆ’å™¨)                      â”‚  â”‚
â”‚  â”‚     â”œâ”€ Execution Graph: ç”Ÿæˆæ‰§è¡Œå›¾           â”‚  â”‚
â”‚  â”‚     â””â”€ Resource Allocator: èµ„æºåˆ†é…          â”‚  â”‚
â”‚  â”‚                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â†“                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Unified API (ç»Ÿä¸€æ¥å£)                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  POST /fusion        (è¯­ä¹‰æœç´¢ - å·²æœ‰)       â”‚  â”‚
â”‚  â”‚  POST /parse         (ä»»åŠ¡æ‹†è§£ - æ–°å¢)       â”‚  â”‚
â”‚  â”‚  POST /schedule      (æ™ºèƒ½è°ƒåº¦ - æ–°å¢)       â”‚  â”‚
â”‚  â”‚  GET  /plan          (æŸ¥çœ‹è§„åˆ’ - æ–°å¢)       â”‚  â”‚
â”‚  â”‚  GET  /health        (å¥åº·æ£€æŸ¥)              â”‚  â”‚
â”‚  â”‚  GET  /stats         (ç»Ÿè®¡ä¿¡æ¯)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“ å†™å…¥ä»»åŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cecelia Quality (Task Database)                    â”‚
â”‚  - PostgreSQL: ä»»åŠ¡å­˜å‚¨                              â”‚
â”‚  - Gateway: ä»»åŠ¡é˜Ÿåˆ—                                 â”‚
â”‚  - Worker: ä»»åŠ¡æ‰§è¡Œ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ åŠŸèƒ½éœ€æ±‚

### Phase 1: Parserï¼ˆä»»åŠ¡æ‹†è§£å™¨ï¼‰- MVP

**ç›®æ ‡**ï¼šç†è§£ç”¨æˆ·æ„å›¾ï¼Œæ‹†è§£æˆå¯æ‰§è¡Œä»»åŠ¡

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Intent Analysis** | åˆ†æç”¨æˆ·æ„å›¾ï¼ˆfeature/fix/refactor/testï¼‰| P0 |
| **Task Decomposition** | æ‹†è§£æˆå­ä»»åŠ¡ï¼ˆ5-10 ä¸ªï¼‰| P0 |
| **Dependency Graph** | æ„å»ºä»»åŠ¡ä¾èµ–å…³ç³» | P0 |
| **Context Retrieval** | è°ƒç”¨ Semantic Brain æŸ¥è¯¢å†å²å®ç° | P0 |
| **PRD Generation** | è‡ªåŠ¨ç”Ÿæˆ .prd.md æ–‡ä»¶ | P1 |

**API è®¾è®¡**ï¼š

```bash
POST http://localhost:5220/parse
Content-Type: application/json

{
  "intent": "å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½",
  "context": {
    "project": "cecelia-workspace",
    "current_branch": "develop"
  },
  "use_history": true  # æ˜¯å¦æŸ¥è¯¢å†å²å®ç°
}

# å“åº”
{
  "understanding": {
    "type": "feature",
    "scope": "authentication",
    "estimated_complexity": "medium"
  },
  "tasks": [
    {
      "id": "task-1",
      "title": "è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„",
      "description": "åˆ›å»º users è¡¨ï¼ŒåŒ…å« id, email, password_hash, created_at",
      "priority": "P0",
      "estimated_time": "30min",
      "dependencies": [],
      "tags": ["database", "schema"]
    },
    {
      "id": "task-2",
      "title": "å®ç°åç«¯ç™»å½• API",
      "description": "POST /api/auth/login æ¥å£ï¼ŒéªŒè¯é‚®ç®±å¯†ç ï¼Œè¿”å› JWT token",
      "priority": "P0",
      "estimated_time": "2h",
      "dependencies": ["task-1"],
      "tags": ["backend", "api"]
    },
    {
      "id": "task-3",
      "title": "å®ç°å‰ç«¯ç™»å½•é¡µé¢",
      "description": "åˆ›å»º LoginPage.tsxï¼ŒåŒ…å«è¡¨å•å’Œé”™è¯¯æç¤º",
      "priority": "P0",
      "estimated_time": "1.5h",
      "dependencies": ["task-2"],
      "tags": ["frontend", "ui"]
    },
    {
      "id": "task-4",
      "title": "å†™å•å…ƒæµ‹è¯•",
      "description": "æµ‹è¯•ç™»å½• API å’Œå‰ç«¯è¡¨å•éªŒè¯",
      "priority": "P1",
      "estimated_time": "1h",
      "dependencies": ["task-2", "task-3"],
      "tags": ["test"]
    },
    {
      "id": "task-5",
      "title": "é›†æˆæµ‹è¯•å’Œéƒ¨ç½²",
      "description": "ç«¯åˆ°ç«¯æµ‹è¯• + éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ",
      "priority": "P1",
      "estimated_time": "30min",
      "dependencies": ["task-4"],
      "tags": ["test", "deployment"]
    }
  ],
  "dependency_graph": {
    "task-1": [],
    "task-2": ["task-1"],
    "task-3": ["task-2"],
    "task-4": ["task-2", "task-3"],
    "task-5": ["task-4"]
  },
  "historical_context": [
    {
      "file": "/home/xx/dev/cecelia-workspace/apps/api/src/auth/login.ts",
      "summary": "ä¹‹å‰å®ç°è¿‡ç±»ä¼¼çš„ OAuth ç™»å½•ï¼Œå¯ä»¥å‚è€ƒç»“æ„"
    }
  ],
  "suggested_prd": "# PRD: ç”¨æˆ·ç™»å½•åŠŸèƒ½\n\n## éœ€æ±‚æè¿°\n...",
  "parse_time_ms": 450
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½ç†è§£ 10 ç§å¸¸è§æ„å›¾ï¼ˆç™»å½•ã€æ³¨å†Œã€CRUDã€éƒ¨ç½²ç­‰ï¼‰
- [ ] æ‹†è§£çš„ä»»åŠ¡æ•°é‡åˆç†ï¼ˆ5-10 ä¸ªï¼‰
- [ ] ä¾èµ–å…³ç³»æ­£ç¡®ï¼ˆæ— å¾ªç¯ä¾èµ–ï¼‰
- [ ] èƒ½è°ƒç”¨ Semantic Brain æŸ¥è¯¢åˆ°ç›¸å…³å†å²ä»£ç 

---

### Phase 2: Schedulerï¼ˆæ™ºèƒ½è°ƒåº¦å™¨ï¼‰

**ç›®æ ‡**ï¼šæ ¹æ®ä¼˜å…ˆçº§å’Œä¾èµ–å…³ç³»ï¼Œç”Ÿæˆæœ€ä¼˜æ‰§è¡Œé¡ºåº

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Priority Calculation** | åŠ¨æ€è®¡ç®—ä¼˜å…ˆçº§ï¼ˆP0/P1/P2ï¼‰| P0 |
| **Dependency Solving** | æ‹“æ‰‘æ’åºï¼Œå¤„ç†ä¾èµ– | P0 |
| **Concurrency Planning** | è¯†åˆ«å¯å¹¶è¡Œä»»åŠ¡ | P0 |
| **Resource Allocation** | æœ€å¤š 3 ä¸ªå¹¶å‘ä»»åŠ¡ | P1 |
| **Re-scheduling** | ä»»åŠ¡å¤±è´¥åé‡æ–°è°ƒåº¦ | P1 |

**API è®¾è®¡**ï¼š

```bash
POST http://localhost:5220/schedule
Content-Type: application/json

{
  "tasks": [
    {"id": "task-1", "priority": "P0", "dependencies": []},
    {"id": "task-2", "priority": "P0", "dependencies": ["task-1"]},
    {"id": "task-3", "priority": "P0", "dependencies": ["task-2"]},
    {"id": "task-4", "priority": "P1", "dependencies": ["task-2", "task-3"]},
    {"id": "task-5", "priority": "P1", "dependencies": ["task-4"]}
  ],
  "constraints": {
    "max_concurrent": 3,
    "must_finish_first": ["task-1"]
  }
}

# å“åº”
{
  "execution_plan": {
    "phases": [
      {
        "phase": 1,
        "tasks": ["task-1"],
        "concurrent": false,
        "reason": "å¿…é¡»å…ˆå®Œæˆ"
      },
      {
        "phase": 2,
        "tasks": ["task-2"],
        "concurrent": false,
        "reason": "ä¾èµ– task-1"
      },
      {
        "phase": 3,
        "tasks": ["task-3"],
        "concurrent": false,
        "reason": "ä¾èµ– task-2"
      },
      {
        "phase": 4,
        "tasks": ["task-4"],
        "concurrent": false,
        "reason": "ä¾èµ– task-2 å’Œ task-3"
      },
      {
        "phase": 5,
        "tasks": ["task-5"],
        "concurrent": false,
        "reason": "ä¾èµ– task-4"
      }
    ],
    "estimated_total_time": "5.5h",
    "critical_path": ["task-1", "task-2", "task-3", "task-4", "task-5"]
  },
  "visualization": "task-1 â†’ task-2 â†’ task-3 â†’ task-4 â†’ task-5",
  "schedule_time_ms": 12
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¾èµ–é¡ºåºæ­£ç¡®ï¼ˆå…ˆåš A å†åš Bï¼‰
- [ ] è¯†åˆ«å¯å¹¶è¡Œä»»åŠ¡ï¼ˆB å’Œ C å¯åŒæ—¶åšï¼‰
- [ ] ä¼˜å…ˆçº§æ’åºæ­£ç¡®ï¼ˆP0 å…ˆäº P1ï¼‰
- [ ] æ— æ­»é”ã€æ— å¾ªç¯ä¾èµ–

---

### Phase 3: Detectorï¼ˆé™é»˜ç›‘æ§å™¨ï¼‰ğŸ¤–

**ç›®æ ‡**ï¼šè‡ªåŠ¨ç›‘æ§ç³»ç»Ÿäº‹ä»¶ï¼Œåˆ›å»ºä»»åŠ¡

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **CI Monitor** | ç›‘æ§ GitHub Actions å¤±è´¥ | P0 |
| **Code Monitor** | ç›‘æ§ git commits | P1 |
| **Security Monitor** | ç›‘æ§æ¼æ´ï¼ˆGitHub Security Alertsï¼‰| P0 |
| **Dependency Monitor** | ç›‘æ§ä¾èµ–æ›´æ–° | P2 |
| **Auto Task Creation** | è‡ªåŠ¨è°ƒç”¨ Quality API åˆ›å»ºä»»åŠ¡ | P0 |

**ç›‘æ§é€»è¾‘**ï¼š

```python
# src/intelligence/detector/ci_monitor.py

async def monitor_ci():
    """æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ CI çŠ¶æ€"""
    while True:
        # 1. è°ƒç”¨ GitHub API è·å–æœ€è¿‘çš„ workflow runs
        runs = await github_client.get_workflow_runs(
            repo="cecelia-workspace",
            status="failure"
        )

        for run in runs:
            # 2. æ£€æŸ¥æ˜¯å¦å·²ç»åˆ›å»ºè¿‡ä¿®å¤ä»»åŠ¡
            if not await task_exists(run.id):
                # 3. è°ƒç”¨ Semantic Brain æŸ¥è¯¢ç›¸å…³é”™è¯¯å†å²
                history = await semantic_search(
                    query=f"CI failure: {run.error_message}"
                )

                # 4. è‡ªåŠ¨åˆ›å»ºä¿®å¤ä»»åŠ¡
                task = {
                    "title": f"ä¿®å¤ CI å¤±è´¥: {run.name}",
                    "description": f"Workflow: {run.workflow}\nError: {run.error_message}",
                    "priority": "P0",
                    "tags": ["ci-fix", "auto-created"],
                    "context": {
                        "ci_run_id": run.id,
                        "branch": run.branch,
                        "similar_fixes": history
                    }
                }

                # 5. è°ƒç”¨ Quality API åˆ›å»ºä»»åŠ¡
                await quality_api.create_task(task)

                # 6. å…¥é˜Ÿæ‰§è¡Œ
                await gateway.enqueue(task)

        await asyncio.sleep(300)  # 5 åˆ†é’Ÿ
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] CI å¤±è´¥å 5 åˆ†é’Ÿå†…åˆ›å»ºä¿®å¤ä»»åŠ¡
- [ ] ä»»åŠ¡æ ‡è®°ä¸º `auto-created` å’Œ `P0`
- [ ] åŒ…å«é”™è¯¯æ—¥å¿—å’Œä¿®å¤å»ºè®®
- [ ] ä¸é‡å¤åˆ›å»ºä»»åŠ¡

---

### Phase 4: Plannerï¼ˆæ‰§è¡Œè§„åˆ’å™¨ï¼‰

**ç›®æ ‡**ï¼šç”Ÿæˆå®Œæ•´çš„æ‰§è¡Œè®¡åˆ’

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Execution Graph** | å¯è§†åŒ–æ‰§è¡Œå›¾ | P1 |
| **Resource Estimation** | ä¼°ç®—æ‰€éœ€èµ„æºï¼ˆæ—¶é—´ã€å¹¶å‘ï¼‰| P1 |
| **Risk Assessment** | è¯†åˆ«é£é™©ä»»åŠ¡ | P2 |
| **Alternative Plans** | ç”Ÿæˆå¤‡é€‰æ–¹æ¡ˆ | P2 |

**API è®¾è®¡**ï¼š

```bash
GET http://localhost:5220/plan?project=cecelia-workspace

# å“åº”
{
  "current_tasks": {
    "total": 15,
    "by_priority": {
      "P0": 3,
      "P1": 8,
      "P2": 4
    },
    "by_status": {
      "queued": 10,
      "in_progress": 3,
      "completed": 2
    }
  },
  "execution_plan": {
    "next_up": ["task-42", "task-43"],
    "in_progress": ["task-40", "task-41", "task-39"],
    "waiting": ["task-44", "task-45"],
    "blocked": []
  },
  "estimated_completion": "2h 30min",
  "bottlenecks": [
    {
      "task": "task-40",
      "reason": "é˜»å¡äº† 5 ä¸ªåç»­ä»»åŠ¡",
      "suggestion": "ä¼˜å…ˆå®Œæˆæ­¤ä»»åŠ¡"
    }
  ],
  "risks": []
}
```

---

## ğŸ”— Semantic Brain é›†æˆï¼ˆåä½œå…³ç³»ï¼‰

### è°ƒç”¨åœºæ™¯

| Intelligence åŠŸèƒ½ | è°ƒç”¨ Semantic | ç”¨é€” |
|-------------------|---------------|------|
| **Parser** | `/fusion` | æŸ¥è¯¢å†å²å®ç°ï¼š"ä¹‹å‰ç™»å½•åŠŸèƒ½æ€ä¹ˆåšçš„ï¼Ÿ" |
| **Detector (CI)** | `/fusion` | æŸ¥è¯¢å†å²é”™è¯¯ï¼š"è¿™ä¸ª CI é”™è¯¯ä¹‹å‰æ€ä¹ˆä¿®çš„ï¼Ÿ" |
| **Scheduler** | `/fusion` | æŸ¥è¯¢ä»»åŠ¡å†å²ï¼š"ç±»ä¼¼ä»»åŠ¡é€šå¸¸è¦å¤šä¹…ï¼Ÿ" |
| **Planner** | `/fusion` | æŸ¥è¯¢é¡¹ç›®æ–‡æ¡£ï¼š"è¿™ä¸ªé¡¹ç›®çš„æ¶æ„æ˜¯ä»€ä¹ˆï¼Ÿ" |

### ç¤ºä¾‹ï¼šParser è°ƒç”¨ Semantic

```python
# src/intelligence/parser/task_decomposer.py

async def decompose_task(intent: str, project: str):
    # 1. å…ˆè°ƒç”¨ Semantic Brain æŸ¥è¯¢å†å²
    history = await semantic_client.search(
        query=f"{intent} implementation in {project}",
        filters={"project": project, "file_type": ".md"},
        top_k=5
    )

    # 2. å°†å†å²ä¸Šä¸‹æ–‡ä¼ ç»™ LLM
    prompt = f"""
    ç”¨æˆ·æ„å›¾: {intent}
    é¡¹ç›®: {project}

    å†å²å®ç°å‚è€ƒ:
    {history['summary']}

    è¯·æ‹†è§£æˆå­ä»»åŠ¡...
    """

    # 3. è°ƒç”¨ LLM API æ‹†è§£
    tasks = await llm_client.complete(prompt)

    return tasks
```

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

```
cecelia-semantic-brain/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ semantic/              # è¯­ä¹‰å±‚ï¼ˆå·²æœ‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ chunker.py
â”‚   â”‚   â”œâ”€â”€ embedder.py
â”‚   â”‚   â”œâ”€â”€ searcher.py
â”‚   â”‚   â””â”€â”€ watcher.py
â”‚   â”‚
â”‚   â”œâ”€â”€ intelligence/          # æ™ºèƒ½å±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”‚   â”œâ”€â”€ intent_analyzer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ task_decomposer.py
â”‚   â”‚   â”‚   â””â”€â”€ dependency_builder.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ scheduler/
â”‚   â”‚   â”‚   â”œâ”€â”€ priority_calculator.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dependency_solver.py
â”‚   â”‚   â”‚   â””â”€â”€ concurrency_planner.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ detector/
â”‚   â”‚   â”‚   â”œâ”€â”€ ci_monitor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ code_monitor.py
â”‚   â”‚   â”‚   â”œâ”€â”€ security_monitor.py
â”‚   â”‚   â”‚   â””â”€â”€ base_monitor.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ planner/
â”‚   â”‚       â””â”€â”€ execution_planner.py
â”‚   â”‚
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPI ç»Ÿä¸€å…¥å£
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ semantic.py    # /fusion æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ intelligence.py # /parse, /schedule æ¥å£
â”‚   â”‚   â””â”€â”€ models.py
â”‚   â”‚
â”‚   â”œâ”€â”€ clients/               # å¤–éƒ¨å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ quality_api.py     # Cecelia Quality API
â”‚   â”‚   â”œâ”€â”€ github_api.py      # GitHub API
â”‚   â”‚   â””â”€â”€ llm_client.py      # OpenAI/Claude API
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ logger.py
â”‚       â””â”€â”€ config.py
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ sor_config.yaml        # Semantic é…ç½®
â”‚   â””â”€â”€ intelligence_config.yaml # Intelligence é…ç½®
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_semantic/
â”‚   â””â”€â”€ test_intelligence/
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ chroma/                # Chroma æ•°æ®åº“
â”‚
â”œâ”€â”€ logs/
â”‚
â”œâ”€â”€ .env.example
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .prd.md                    # Semantic Brain PRD
â””â”€â”€ .prd-task-intelligence.md  # æœ¬æ–‡ä»¶
```

---

## ğŸ› ï¸ æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | æŠ€æœ¯ | ç†ç”± |
|------|------|------|
| **LLM** | OpenAI GPT-4 / Claude Sonnet | ç†è§£æ„å›¾ã€æ‹†è§£ä»»åŠ¡ |
| **Rule Engine** | Python é€»è¾‘ | ä¾èµ–æ’åºã€ä¼˜å…ˆçº§è®¡ç®— |
| **ç›‘æ§** | GitHub API + asyncio | è½®è¯¢ CI çŠ¶æ€ |
| **é˜Ÿåˆ—** | è°ƒç”¨ Quality Gateway | å¤ç”¨ç°æœ‰ç³»ç»Ÿ |
| **å›¾ç®—æ³•** | NetworkX | ä¾èµ–å›¾ã€æ‹“æ‰‘æ’åº |

### æ–°å¢ä¾èµ–

```txt
# requirements.txt (è¿½åŠ )

# LLM
openai==1.10.0
anthropic==0.8.0

# å›¾ç®—æ³•
networkx==3.2.1

# GitHub API
pygithub==2.1.1

# ä»»åŠ¡é˜Ÿåˆ—å®¢æˆ·ç«¯
httpx==0.25.0
```

---

## ğŸ“Š å·¥ä½œæµç¤ºä¾‹

### ç”¨æˆ·ä¸»åŠ¨ä»»åŠ¡

```
1. ç”¨æˆ·ï¼ˆClaude Codeï¼‰ï¼š"å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"
   â†“
2. Brain Parser:
   - è°ƒç”¨ Semantic Brain: æŸ¥è¯¢å†å²ç™»å½•å®ç°
   - è°ƒç”¨ LLM: æ‹†è§£æˆ 5 ä¸ªå­ä»»åŠ¡
   - æ„å»ºä¾èµ–å…³ç³»
   â†“
3. Brain Scheduler:
   - è®¡ç®—ä¼˜å…ˆçº§
   - æ‹“æ‰‘æ’åº
   - ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
   â†“
4. è°ƒç”¨ Quality API:
   - æ‰¹é‡åˆ›å»º 5 ä¸ªä»»åŠ¡åˆ° PostgreSQL
   â†“
5. è°ƒç”¨ Gateway:
   - æŒ‰é¡ºåºå…¥é˜Ÿä»»åŠ¡
   â†“
6. Worker æ‰§è¡Œ:
   - task-1 â†’ task-2 â†’ task-3 â†’ task-4 â†’ task-5
   â†“
7. å®Œæˆï¼Œæ›´æ–°çŠ¶æ€
```

### é™é»˜ç›‘æ§ä»»åŠ¡

```
1. CI Monitorï¼ˆåå°è½®è¯¢ 5 åˆ†é’Ÿï¼‰:
   - GitHub API: æ£€æµ‹åˆ° CI å¤±è´¥
   â†“
2. åˆ¤æ–­æ˜¯å¦å·²å¤„ç†:
   - æŸ¥è¯¢ Quality DB: æ²¡æœ‰ç›¸å…³ä»»åŠ¡
   â†“
3. è°ƒç”¨ Semantic Brain:
   - æŸ¥è¯¢å†å²: "è¿™ä¸ªé”™è¯¯ä¹‹å‰æ€ä¹ˆä¿®çš„ï¼Ÿ"
   â†“
4. è‡ªåŠ¨åˆ›å»ºä»»åŠ¡:
   - æ ‡é¢˜: "ä¿®å¤ CI å¤±è´¥: build.yml"
   - ä¼˜å…ˆçº§: P0
   - æ ‡ç­¾: auto-created, ci-fix
   - ä¸Šä¸‹æ–‡: é”™è¯¯æ—¥å¿— + å†å²ä¿®å¤æ–¹æ³•
   â†“
5. è°ƒç”¨ Quality API + Gateway:
   - åˆ›å»ºä»»åŠ¡ + é«˜ä¼˜å…ˆçº§å…¥é˜Ÿ
   â†“
6. Worker ç«‹å³æ‰§è¡Œ:
   - ä¿®å¤ä»£ç  â†’ commit â†’ push â†’ CI é‡è·‘
   â†“
7. CI é€šè¿‡ï¼Œä»»åŠ¡å®Œæˆ
```

---

## ğŸ“… é‡Œç¨‹ç¢‘

### Milestone 1: Parser MVPï¼ˆ3-5 å¤©ï¼‰

- [ ] Intent Analyzer å®ç°
- [ ] Task Decomposer å®ç°
- [ ] Dependency Builder å®ç°
- [ ] é›†æˆ Semantic Brain æŸ¥è¯¢
- [ ] `/parse` API å®ç°
- [ ] CLI æµ‹è¯•å·¥å…·

**äº¤ä»˜ç‰©**ï¼šèƒ½æ‹†è§£ä»»åŠ¡çš„ API

---

### Milestone 2: Schedulerï¼ˆ2-3 å¤©ï¼‰

- [ ] Priority Calculator å®ç°
- [ ] Dependency Solverï¼ˆæ‹“æ‰‘æ’åºï¼‰
- [ ] Concurrency Planner å®ç°
- [ ] `/schedule` API å®ç°
- [ ] é›†æˆæµ‹è¯•

**äº¤ä»˜ç‰©**ï¼šæ™ºèƒ½è°ƒåº¦ API

---

### Milestone 3: Detectorï¼ˆ3-4 å¤©ï¼‰

- [ ] CI Monitor å®ç°
- [ ] Code Monitor å®ç°
- [ ] Security Monitor å®ç°
- [ ] åå°æœåŠ¡ï¼ˆasyncio loopsï¼‰
- [ ] è‡ªåŠ¨ä»»åŠ¡åˆ›å»º
- [ ] æ—¥å¿—å’Œç›‘æ§

**äº¤ä»˜ç‰©**ï¼šè‡ªåŠ¨ç›‘æ§åå°æœåŠ¡

---

### Milestone 4: Planner + Integrationï¼ˆ2-3 å¤©ï¼‰

- [ ] Execution Planner å®ç°
- [ ] `/plan` API å®ç°
- [ ] ä¸ Quality API å®Œæ•´é›†æˆ
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ–‡æ¡£å®Œå–„

**äº¤ä»˜ç‰©**ï¼šå®Œæ•´çš„ Intelligence ç³»ç»Ÿ

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

```python
# tests/test_intelligence/test_parser.py

async def test_parse_login_intent():
    result = await parser.parse("å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½")
    assert result['understanding']['type'] == 'feature'
    assert len(result['tasks']) >= 3
    assert 'task-1' in result['dependency_graph']

# tests/test_intelligence/test_scheduler.py

def test_topological_sort():
    tasks = [
        {"id": "A", "deps": []},
        {"id": "B", "deps": ["A"]},
        {"id": "C", "deps": ["B"]}
    ]
    order = scheduler.sort(tasks)
    assert order == ["A", "B", "C"]

# tests/test_intelligence/test_detector.py

@patch('github_client.get_workflow_runs')
async def test_ci_monitor(mock_github):
    mock_github.return_value = [MockFailedRun()]
    await ci_monitor.check_once()
    # éªŒè¯åˆ›å»ºäº†ä»»åŠ¡
    assert quality_api.create_task.called
```

### é›†æˆæµ‹è¯•

```bash
# ç«¯åˆ°ç«¯æµ‹è¯•
1. è°ƒç”¨ /parse: "å®ç°ç™»å½•åŠŸèƒ½"
2. éªŒè¯è¿”å› 5 ä¸ªä»»åŠ¡
3. è°ƒç”¨ /schedule: ä¼ å…¥ 5 ä¸ªä»»åŠ¡
4. éªŒè¯è¿”å›æ­£ç¡®çš„æ‰§è¡Œé¡ºåº
5. æ¨¡æ‹Ÿ CI å¤±è´¥
6. éªŒè¯ Detector è‡ªåŠ¨åˆ›å»ºä¿®å¤ä»»åŠ¡
7. éªŒè¯ä»»åŠ¡å·²å…¥é˜Ÿåˆ° Quality Gateway
```

---

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | éªŒè¯æ–¹å¼ |
|------|------|----------|
| **æ‹†è§£å‡†ç¡®ç‡** | 80% çš„ä»»åŠ¡æ‹†è§£åˆç† | äººå·¥è¯„ä¼° 20 ä¸ªæ¡ˆä¾‹ |
| **è°ƒåº¦æ­£ç¡®ç‡** | 100% ä¾èµ–é¡ºåºæ­£ç¡® | å•å…ƒæµ‹è¯• |
| **ç›‘æ§å»¶è¿Ÿ** | CI å¤±è´¥å 5 åˆ†é’Ÿå†…åˆ›å»ºä»»åŠ¡ | é›†æˆæµ‹è¯• |
| **API å“åº”æ—¶é—´** | P99 < 500ms | å‹æµ‹ |

### ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| **è‡ªåŠ¨ä»»åŠ¡æ¯”ä¾‹** | 20% ä»»åŠ¡ç”± Detector è‡ªåŠ¨åˆ›å»º |
| **ä»»åŠ¡æ‹†è§£ä½¿ç”¨ç‡** | æ¯å¤©è‡³å°‘ 1 æ¬¡ Parser è°ƒç”¨ |
| **è°ƒåº¦ä¼˜åŒ–** | èŠ‚çœ 10% æ‰§è¡Œæ—¶é—´ï¼ˆvs äººå·¥æ’åºï¼‰|

---

## âœ… DoDï¼ˆDefinition of Doneï¼‰

MVP å®Œæˆçš„æ ‡å‡†ï¼š

- [ ] Parser èƒ½æ‹†è§£ 10 ç§å¸¸è§ä»»åŠ¡
- [ ] Scheduler èƒ½æ­£ç¡®æ’åºä¾èµ–ä»»åŠ¡
- [ ] CI Monitor èƒ½è‡ªåŠ¨åˆ›å»ºä¿®å¤ä»»åŠ¡
- [ ] æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸å·¥ä½œ
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä¸ Semantic Brain åä½œæ­£å¸¸
- [ ] ä¸ Quality API é›†æˆæ­£å¸¸
- [ ] æ–‡æ¡£å®Œå–„ï¼ˆAPI docs + ä½¿ç”¨æŒ‡å—ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 60%
- [ ] Docker éƒ¨ç½²æˆåŠŸ

---

## ğŸ”„ ä¸ Semantic Brain çš„å…³ç³»

**Semantic Brain** = çŸ¥è¯†åº“ï¼ˆè®°å¿†ï¼‰
- å­˜å‚¨æ‰€æœ‰é¡¹ç›®æ–‡æ¡£ã€ä»£ç ã€å†å²
- æä¾›è¯­ä¹‰æœç´¢èƒ½åŠ›

**Task Intelligence** = æ€è€ƒä¸­æ¢ï¼ˆå¤§è„‘ï¼‰
- ç†è§£æ„å›¾ã€æ‹†è§£ä»»åŠ¡ã€æ™ºèƒ½è°ƒåº¦
- **ä¾èµ–** Semantic Brain æä¾›ä¸Šä¸‹æ–‡

**åä½œæµç¨‹**ï¼š
```
ç”¨æˆ·æ„å›¾ â†’ Intelligence ç†è§£ â†’ æŸ¥è¯¢ Semanticï¼ˆå†å²ï¼‰ â†’ ç”Ÿæˆä»»åŠ¡ â†’ æ‰§è¡Œ
                                    â†‘
                                çŸ¥è¯†æ”¯æŒ
```

---

**Owner**: Claude Code
**Reviewers**: Alex
**Estimated Effort**: 10-15 å¤©ï¼ˆ4 ä¸ª Milestonesï¼‰
**Risk Level**: Mediumï¼ˆLLM API ç¨³å®šæ€§ã€ä¾èµ– Quality APIï¼‰
