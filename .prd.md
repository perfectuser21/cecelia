---
id: prd-chat-intent-pipeline
version: 1.0.0
created: 2026-02-25
updated: 2026-02-25
changelog:
  - 1.0.0: 初始版本
---

# 前端聊天接入 Brain Intent 管道 — 统一前后端能力

## 背景

用户反馈：在 CommandPalette 里跟 Cecelia 对话，应该和后端自动运行一样 — 能识别意图、拆解任务、派发执行。
当前 orchestrator-chat 的动作检测仅用关键词匹配创建 P2 任务，没有接上 Brain 的完整 intent 管道。

**关键发现**：后端已有完整能力：
- `POST /api/brain/intent/execute` — 自然语言 → 意图识别 → 自动执行
- 支持 CREATE_TASK、CREATE_PROJECT、CREATE_GOAL、FIX_BUG 等意图类型
- 但 orchestrator-chat 没有调用它

## 目标

将 orchestrator-chat 的 `detectAndExecuteAction()` 升级为调用 intent/execute 管道，
使前端聊天和后端 Tick 自动规划走同一条管道。

## 设计方案

### 改动范围

**只改一个文件**：`packages/brain/src/chat-action-dispatcher.js`

当前流程：
```
用户消息 → detectAction(关键词匹配) → executeAction(硬编码) → 返回文本
```

目标流程：
```
用户消息 → detectAction(关键词匹配，快速通道)
         → 不匹配? → 调用 intent/execute 管道（LLM 意图识别）
         → 返回结构化结果（创建了什么、做了什么）
```

### 具体改动

1. **chat-action-dispatcher.js** — `detectAndExecuteAction()` 函数增加 intent 管道回退：
   - 保留现有关键词匹配作为快速通道（零延迟）
   - 关键词不匹配时，调用 `parseAndExecuteIntent()`（来自 intent.js）
   - 返回结构化结果供前端展示

2. **不改前端** — CommandPalette 已经调用 orchestrator-chat，后端升级后自动生效

## 不改的部分

- CommandPalette.tsx — 不碰
- CeceliaPage.tsx — 不碰
- orchestrator-chat.js — 不碰（它已经调用 detectAndExecuteAction）
- intent.js — 不碰（已有完整管道）
- Brain 其他模块 — 不碰

## 成功标准

1. 在 CommandPalette 中说"创建一个任务：优化首页性能"→ Brain 创建任务并返回确认
2. 说"我想做一个用户中心"→ intent 管道识别为 CREATE_PROJECT → 创建项目
3. 说"帮我修一下登录 bug"→ 识别为 FIX_BUG → 创建修复任务
4. 现有关键词匹配功能不受影响（"帮我记任务：xxx" 仍然走快速通道）
5. 纯聊天/问答不触发任何动作（"你好"、"今天天气怎么样"）
6. npm run build 成功（workspace CI）
7. Brain 服务重启后正常运行
