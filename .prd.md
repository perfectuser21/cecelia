## PRD - Capacity-Aware Decomposition（SLOTS 驱动容量管控）

**需求来源**: 秋米拆解器无容量约束，一天拆出 200+ projects / 300+ initiatives。SLOTS 应为唯一约束输入。

**功能描述**:

以 Pool C 可用 SLOTS 为唯一输入，推导所有层级（Project / Initiative / Task）的 active 上限，实现背压机制。

### 核心公式

```
SLOTS = Pool C 可用（当前 9，8核16GB 机器）

Project:    max = ceil(SLOTS/2)     softMin = 1
Initiative: max = SLOTS             softMin = ceil(SLOTS/3)
Task:       queued_cap = SLOTS × 3  softMin = SLOTS
```

### 激活评分

从 pending 中选哪些激活到 active，按分数排序：
- priority 权重：P0=300, P1=200, P2=100
- aging 防饿死：每天 +2 分，最多 +200
- progress bonus：做到 30%-70% 的 +40 分
- dependency bonus：被别人依赖的 +80
- user_pinned：手动置顶 +999
- cooldown 防抖：刚切换状态 120s 内不再切换

### 背压机制

- 拆解器（decomposition-checker.js）每个 check 前检查该层 active 数量是否已满
- 满了就跳过拆解，不创建新的拆解任务
- 只有 active 的 project/initiative 才会被拆解，pending 不拆

### 状态流转

- pending → active（有空位 + 分数够高）
- active → inactive（超出 max，分数最低的被暂停）
- inactive → active（有空位时重新上场，有 progress bonus）
- active → completed（正常完成）

**涉及文件**:

新建：
- brain/src/capacity.js - 容量公式
- brain/src/activation-scorer.js - 激活评分
- brain/src/project-activator.js - Project 层激活/降级
- brain/migrations/048-capacity-cleanup.sql - 数据清理

修改：
- brain/src/initiative-closer.js - MAX=10 → 用 capacity.js
- brain/src/decomposition-checker.js - 每个 check 加门控
- brain/src/tick.js - 集成 project 激活 + capacity
- brain/src/selfcheck.js - schema 047 → 048

**成功标准**:
1. computeCapacity(9) 返回正确的各层 cap
2. initiative-closer 用公式而非硬编码
3. decomposition-checker 所有 check 前有 capacity gate
4. project-activator 管理 project 层 active/inactive
5. tick.js 每 tick 调用激活/降级检查
6. migration 清理数据（238 active projects → cap 内）
7. 全部现有测试通过 + 新测试覆盖

**非目标**:
- 不改 planner.js 的任务选择逻辑（那是选哪个 task 执行，不是选哪个 project 激活）
- 不改 slot-allocator.js（那是计算 SLOTS 数量，不改计算方式）
- 不改前端（那是 workspace 的事）
