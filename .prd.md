---
id: prd-brain-consolidation-m4
version: 1.0.0
created: 2026-01-29
updated: 2026-01-29
changelog:
  - 1.0.0: M4 Queue Layer è¿ç§»
---

# PRD: M4 Queue Layer Migration

## ğŸ“‹ é¡¹ç›®ä¿¡æ¯

| é¡¹ç›® | ä¿¡æ¯ |
|------|------|
| **åç§°** | Brain Consolidation - M4 |
| **ç›®æ ‡ä»“åº“** | cecelia-semantic-brain |
| **æºä»“åº“** | cecelia-workspace/apps/core/src/brain |
| **æŠ€æœ¯æ ˆ** | Python + FastAPI + asyncpg |

---

## ğŸ¯ ç›®æ ‡

**M4: è¿ç§» PRD Queue Layer**

### æœ¬æ¬¡ PR èŒƒå›´

1. **Queue æ¨¡å—**
   - get_queue() - è·å–é˜Ÿåˆ—çŠ¶æ€
   - init_queue() - åˆå§‹åŒ–é˜Ÿåˆ—
   - get_next_prd() - è·å–ä¸‹ä¸€ä¸ª PRD
   - start_current_prd() - å¼€å§‹æ‰§è¡Œ
   - complete_prd() - å®Œæˆ PRD
   - fail_prd() - æ ‡è®°å¤±è´¥
   - retry_failed() - é‡è¯•å¤±è´¥
   - clear_queue() - æ¸…ç©ºé˜Ÿåˆ—
   - get_queue_summary() - æ‘˜è¦

2. **API è·¯ç”±**
   - GET /api/brain/queue - è·å–é˜Ÿåˆ—
   - POST /api/brain/queue/init - åˆå§‹åŒ–
   - GET /api/brain/queue/next - è·å–ä¸‹ä¸€ä¸ª
   - POST /api/brain/queue/start - å¼€å§‹æ‰§è¡Œ
   - POST /api/brain/queue/complete - å®Œæˆ
   - POST /api/brain/queue/fail - å¤±è´¥
   - POST /api/brain/queue/retry - é‡è¯•
   - DELETE /api/brain/queue - æ¸…ç©º

---

## ğŸ“¦ æ¶‰åŠæ–‡ä»¶

### æ–°å¢

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `src/state/queue.py` | PRD Queue é€»è¾‘ |
| `tests/test_queue.py` | Queue å•å…ƒæµ‹è¯• |
| `tests/test_queue_api.py` | Queue API æµ‹è¯• |

### ä¿®æ”¹

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `src/state/__init__.py` | å¯¼å‡º queue æ¨¡å— |
| `src/api/state_routes.py` | æ·»åŠ  Queue è·¯ç”± |

---

## âœ… æˆåŠŸæ ‡å‡†

- [ ] get_queue() æ­£å¸¸å·¥ä½œ
- [ ] init_queue() æ­£å¸¸å·¥ä½œ
- [ ] get_next_prd() æ­£å¸¸å·¥ä½œ
- [ ] start_current_prd() æ­£å¸¸å·¥ä½œ
- [ ] complete_prd() æ­£å¸¸å·¥ä½œ
- [ ] fail_prd() æ­£å¸¸å·¥ä½œ
- [ ] retry_failed() æ­£å¸¸å·¥ä½œ
- [ ] clear_queue() æ­£å¸¸å·¥ä½œ
- [ ] æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ”— ä¾èµ–

- M1-M3 å·²å®Œæˆ
- working_memory è¡¨
