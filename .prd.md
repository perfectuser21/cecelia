# PRD: Decomposition Checker (7-Layer OKR Gap Detection)

## 功能描述

The tick.js OKR decomposition logic only covers Global OKR -> KR and KR -> Task, but Migration 036 introduced the full 6-layer hierarchy (Global OKR -> Global KR -> Area OKR -> Area KR -> Project -> Task). Gaps at any layer mean work silently stalls.

## Impact

**Severity: P0 - Core Automation**

- Missing Global KR means Area OKRs never get created
- Missing Area KR means Projects never get linked
- Missing Initiative means Tasks never get planned
- No automated gap detection = manual intervention required

## Solution

### Create brain/src/decomposition-checker.js

7 check functions scanning each layer transition:

1. **checkGlobalOkrDecomposition** - Global OKR without Global KR children
2. **checkGlobalKrDecomposition** - Global KR without Area OKR children (new key check)
3. **checkAreaOkrDecomposition** - Area OKR without Area KR children
4. **checkAreaKrProjectLink** - Area KR not linked to any Project (via project_kr_links)
5. **checkProjectDecomposition** - Project without Initiative children
6. **checkInitiativeDecomposition** - Initiative without active Tasks
7. **checkExploratoryDecompositionContinue** - Completed exploratory tasks needing follow-up

### Common Logic per Check

- Query parent entities missing children
- Dedup: skip if decomposition task already queued/in_progress or completed within 24h
- Create decomposition task (payload.decomposition='true', trigger_source='brain_auto')

### Entry Point

- `runDecompositionChecks()` - runs all 7 checks, returns summary

## 成功标准

- All 7 check functions correctly identify gaps
- Dedup prevents duplicate decomposition tasks
- Created tasks have correct payload for autumnrice (/okr)
- All existing tests pass
- CI passes

## Regression Risk

Low - New module, no changes to existing files
