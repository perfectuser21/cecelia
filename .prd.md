---
id: prd-fix-minimax-api
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复 MiniMax Coding Plan API 调用方式

## 功能描述

修复 orchestrator-chat.js 中 MiniMax API 调用完全失败的问题。当前使用的是旧版 API 端点和模型名，
与 Coding Plan API Key（sk-cp- 前缀）不兼容。同时容器内缺少 credentials 卷挂载导致读不到 API Key。

## 问题分析

1. **端点路径错误**：`/v1/text/chatcompletion_v2`（旧版）→ `/v1/chat/completions`（OpenAI 兼容）
2. **模型名错误**：`MiniMax-Text-01`（旧版）→ `MiniMax-M2.5`（Coding Plan 支持）
3. **回复解析缺失**：MiniMax-M2.5 回复包含 `<think>...</think>` 思维链块，需要去掉
4. **容器凭据缺失**：docker-compose.yml 缺少 `~/.credentials` 卷挂载

## 已验证

curl 测试确认正确调用方式：
```bash
POST https://api.minimaxi.com/v1/chat/completions
Authorization: Bearer sk-cp-xxx
Model: MiniMax-M2.5
```

回复格式：
```json
{
  "choices": [{
    "message": {
      "content": "<think>\n思考过程...\n</think>\n\n实际回复内容"
    }
  }]
}
```

## 涉及文件

修改：
- brain/src/orchestrator-chat.js
- docker-compose.yml
- brain/src/__tests__/orchestrator-chat.test.js

## 成功标准

1. MiniMax API 调用成功返回回复
2. 回复中不包含 `<think>` 思维链块
3. Docker 容器内能读到 credentials
4. 所有现有测试通过
5. 新增 thinking strip 测试

## 非目标

- 不改前端
- 不改代理配置
- 不加新的消息平台
