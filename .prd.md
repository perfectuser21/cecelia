# PRD - å…ç–«ç³»ç»Ÿå‰ç«¯å±•ç¤ºå±‚

**éœ€æ±‚æ¥æº**: ç”¨æˆ·åŸè¯ï¼š"ä½ å†™ä¸€ä¸ªprdå§ç„¶åæˆ‘åœ¨workspaceé‡Œé¢å»åš"

**å½“å‰çŠ¶æ€**:
- âœ… P0-P2 åç«¯é€»è¾‘å·²å®Œæˆï¼ˆç›‘æ§ã€è¯•ç”¨æœŸã€ç­–ç•¥æ ‡å‡†åŒ–ï¼‰
- âœ… API æ¥å£å±‚å·²å®Œæˆï¼ˆ8 ä¸ª REST API ç«¯ç‚¹ï¼ŒBrain port 5221ï¼‰
- âŒ P3 å‰ç«¯å±•ç¤ºå±‚ç¼ºå¤± - **æœ¬ PRD ç›®æ ‡**

---

## ä¸€ã€äº§å“ç›®æ ‡

### æ ¸å¿ƒä»·å€¼
ä¸º Cecelia ç®¡ç†å‘˜æä¾›ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ï¼ŒæŸ¥çœ‹å’Œç®¡ç†å…ç–«ç³»ç»Ÿï¼š
- **ç­–ç•¥ç®¡ç†** - æŸ¥çœ‹æ‰€æœ‰ Absorption Policiesï¼ˆdraft/probation/active/disabledï¼‰
- **å¤±è´¥åˆ†æ** - åˆ†æå¤±è´¥ç­¾åï¼Œè¯†åˆ«é«˜é¢‘é—®é¢˜
- **æ™‹å‡è¿½è¸ª** - æŸ¥çœ‹ç­–ç•¥ä»è¯•ç”¨æœŸæ™‹å‡åˆ°æ­£å¼çš„å†å²
- **ç³»ç»Ÿæ€»è§ˆ** - Dashboard æ±‡æ€»å…³é”®æŒ‡æ ‡

### ç›®æ ‡ç”¨æˆ·
- **ä¸»è¦ç”¨æˆ·**: Cecelia ç³»ç»Ÿç®¡ç†å‘˜ï¼ˆä½ ï¼‰
- **ä½¿ç”¨é¢‘ç‡**: æ¯å¤© 1-2 æ¬¡ï¼Œæ£€æŸ¥å…ç–«ç³»ç»Ÿå¥åº·çŠ¶å†µ
- **ä½¿ç”¨åœºæ™¯**:
  1. æ—©ä¸ŠæŸ¥çœ‹ Dashboardï¼Œç¡®è®¤ç³»ç»Ÿå¥åº·
  2. å‘ç°ä»»åŠ¡å¤±è´¥å¢å¤šæ—¶ï¼ŒæŸ¥çœ‹å¤±è´¥ç­¾ååˆ†æ
  3. æ‰‹åŠ¨ç¦ç”¨è¡¨ç°ä¸ä½³çš„ç­–ç•¥
  4. å®¡æŸ¥è¯•ç”¨æœŸç­–ç•¥çš„æ¨¡æ‹Ÿæ•ˆæœ

---

## äºŒã€åŠŸèƒ½éœ€æ±‚ï¼ˆ4 ä¸ªé¡µé¢ï¼‰

### 2.1 Dashboard - å…ç–«ç³»ç»Ÿæ€»è§ˆ

**è·¯ç”±**: `/immune/dashboard`

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…ç–«ç³»ç»Ÿæ€»è§ˆ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­–ç•¥ç»Ÿè®¡                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Draft â”‚ Trial â”‚ Activeâ”‚ Off   â”‚                      â”‚
â”‚  â”‚   5   â”‚   3   â”‚  12   â”‚   8   â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  éš”ç¦»åŒºç»Ÿè®¡                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ æ€»è®¡: 15 tasks                   â”‚                    â”‚
â”‚  â”‚ - failure_threshold: 10          â”‚                    â”‚
â”‚  â”‚ - manual: 3                      â”‚                    â”‚
â”‚  â”‚ - resource_hog: 2                â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Top 10 å¤±è´¥ç­¾å                                          â”‚
â”‚  1. error-network-timeout         45 æ¬¡                  â”‚
â”‚  2. error-rate-limit              32 æ¬¡                  â”‚
â”‚  3. error-billing-cap             18 æ¬¡                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ€è¿‘æ™‹å‡è®°å½• (7 å¤©)                                       â”‚
â”‚  - [2026-02-12] policy #123: error-network-timeout       â”‚
â”‚    5 simulations, 100% pass rate, risk: low              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**:
```typescript
GET /api/brain/immune/dashboard
```

**äº¤äº’**:
- ç‚¹å‡»ç­–ç•¥ç»Ÿè®¡å¡ç‰‡ â†’ è·³è½¬åˆ°ç­–ç•¥åˆ—è¡¨ï¼ˆè‡ªåŠ¨è¿‡æ»¤è¯¥çŠ¶æ€ï¼‰
- ç‚¹å‡»å¤±è´¥ç­¾å â†’ è·³è½¬åˆ°è¯¥ç­¾åè¯¦æƒ…é¡µ
- ç‚¹å‡»æ™‹å‡è®°å½• â†’ è·³è½¬åˆ°è¯¥ç­–ç•¥è¯¦æƒ…é¡µ

---

### 2.2 Policies - ç­–ç•¥åˆ—è¡¨

**è·¯ç”±**: `/immune/policies`

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥åˆ—è¡¨                                   [+ æ–°å»ºç­–ç•¥]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿‡æ»¤: [Allâ–¾] [Activeâ–¾] [Probationâ–¾] [Draftâ–¾] [Disabledâ–¾] â”‚
â”‚  æ’åº: [æœ€æ–°åˆ›å»ºâ–¾] [æœ€è¿‘æ™‹å‡â–¾] [æˆåŠŸç‡â–¾]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ID   | Signature                | Status  | Stats       â”‚
â”‚  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  #123 | error-network-timeout    | Active  | âœ… 15/0     â”‚
â”‚       | Created: 2026-02-10      | (Low)   | è¯•ç”¨: 5/5   â”‚
â”‚  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  #124 | error-rate-limit         | Trial   | ğŸŸ¡ 3/0      â”‚
â”‚       | Created: 2026-02-12      | (Med)   | è¯•ç”¨: 3/3   â”‚
â”‚  â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  #125 | error-billing-cap        | Draft   | - -         â”‚
â”‚       | Created: 2026-02-12      | (Low)   | æœªå¯ç”¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:
- **ID**: policy_id
- **Signature**: å¤±è´¥ç­¾å
- **Status**:
  - Active (ç»¿è‰²) - æ­£å¼è¿è¡Œ
  - Probation (é»„è‰²) - è¯•ç”¨æœŸ
  - Draft (ç°è‰²) - è‰ç¨¿
  - Disabled (çº¢è‰²) - å·²ç¦ç”¨
- **Stats**:
  - âœ… 15/0 = æˆåŠŸ 15 æ¬¡ / å¤±è´¥ 0 æ¬¡
  - è¯•ç”¨: 5/5 = æ¨¡æ‹ŸæˆåŠŸ 5 æ¬¡ / æ€»å…± 5 æ¬¡
- **Risk Level**: (Low/Medium/High)

**API è°ƒç”¨**:
```typescript
GET /api/brain/policies?status=active&limit=50&offset=0
```

**äº¤äº’**:
- ç‚¹å‡»ç­–ç•¥è¡Œ â†’ è·³è½¬åˆ°ç­–ç•¥è¯¦æƒ…é¡µ
- ç‚¹å‡» "æ–°å»ºç­–ç•¥" â†’ å¼¹å‡ºè¡¨å•ï¼ˆæ‰‹åŠ¨åˆ›å»ºç­–ç•¥ï¼‰
- è¿‡æ»¤å™¨å’Œæ’åº â†’ å®æ—¶æ›´æ–°åˆ—è¡¨

---

### 2.3 Policy Detail - ç­–ç•¥è¯¦æƒ…

**è·¯ç”±**: `/immune/policies/:id`

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–ç•¥ #123: error-network-timeout                        â”‚
â”‚  [è¿”å›åˆ—è¡¨]                                  [ç¦ç”¨] [ç¼–è¾‘] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºæœ¬ä¿¡æ¯                                                  â”‚
â”‚  - çŠ¶æ€: Active (Low Risk)                               â”‚
â”‚  - åˆ›å»ºæ—¶é—´: 2026-02-10 10:00                            â”‚
â”‚  - æ™‹å‡æ—¶é—´: 2026-02-11 15:30                            â”‚
â”‚  - æˆåŠŸç‡: 100% (15/15)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­–ç•¥å†…å®¹ (policy_json)                                   â”‚
â”‚  {                                                       â”‚
â”‚    "action": "requeue",                                  â”‚
â”‚    "params": {                                           â”‚
â”‚      "delay_minutes": 5,                                 â”‚
â”‚      "max_retries": 3                                    â”‚
â”‚    },                                                    â”‚
â”‚    "reason": "Network timeout detected"                  â”‚
â”‚  }                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯„ä¼°å†å² (æœ€è¿‘ 10 æ¬¡)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ—¶é—´    â”‚ Mode   â”‚ Result â”‚ Task ID              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ 14:30   â”‚ apply  â”‚ successâ”‚ task-abc-123         â”‚  â”‚
â”‚  â”‚ 13:45   â”‚ apply  â”‚ successâ”‚ task-def-456         â”‚  â”‚
â”‚  â”‚ 12:30   â”‚ sim    â”‚ would_sâ”‚ task-ghi-789         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  [æŸ¥çœ‹æ‰€æœ‰è¯„ä¼°]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**:
```typescript
GET /api/brain/policies/:id  // åŒ…å«æœ€è¿‘ 10 æ¬¡è¯„ä¼°
GET /api/brain/policies/:id/evaluations?limit=100  // æŸ¥çœ‹æ‰€æœ‰
```

**äº¤äº’**:
- ç‚¹å‡» "ç¦ç”¨" â†’ ç¡®è®¤å¯¹è¯æ¡† â†’ `PATCH /api/brain/policies/:id/status` (status: disabled)
- ç‚¹å‡» "ç¼–è¾‘" â†’ å¼¹å‡ºè¡¨å•ï¼Œç¼–è¾‘ policy_json
- ç‚¹å‡» "æŸ¥çœ‹æ‰€æœ‰è¯„ä¼°" â†’ å±•å¼€å®Œæ•´è¯„ä¼°å†å²ï¼ˆåˆ†é¡µï¼‰

---

### 2.4 Signatures - å¤±è´¥ç­¾ååˆ†æ

**è·¯ç”±**: `/immune/signatures`

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤±è´¥ç­¾ååˆ†æ                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿‡æ»¤: æœ€å°‘å‡ºç°æ¬¡æ•° [5â–¾]  æ—¶é—´èŒƒå›´ [7 å¤©â–¾]                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Signature                    | Count | Policies         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  error-network-timeout        |  45   | 2 active, 1 trialâ”‚
â”‚    é¦–æ¬¡: 2026-02-10 08:00                                 â”‚
â”‚    æœ€è¿‘: 2026-02-12 14:30                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  error-rate-limit             |  32   | 1 active         â”‚
â”‚    é¦–æ¬¡: 2026-02-11 09:15                                 â”‚
â”‚    æœ€è¿‘: 2026-02-12 13:00                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  error-billing-cap            |  18   | 0 policies       â”‚
â”‚    é¦–æ¬¡: 2026-02-12 10:30                                 â”‚
â”‚    æœ€è¿‘: 2026-02-12 14:00                                 â”‚
â”‚    âš ï¸  æ²¡æœ‰å…³è”ç­–ç•¥ï¼ˆå»ºè®®åˆ›å»ºï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**:
```typescript
GET /api/brain/failures/signatures?limit=20&min_count=5
```

**äº¤äº’**:
- ç‚¹å‡»ç­¾åè¡Œ â†’ è·³è½¬åˆ°ç­¾åè¯¦æƒ…é¡µ
- "æ²¡æœ‰å…³è”ç­–ç•¥" è­¦å‘Š â†’ ç‚¹å‡»è·³è½¬åˆ°æ–°å»ºç­–ç•¥è¡¨å•ï¼ˆè‡ªåŠ¨å¡«å…… signatureï¼‰

---

### 2.5 Signature Detail - ç­¾åè¯¦æƒ…

**è·¯ç”±**: `/immune/signatures/:signature`

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤±è´¥ç­¾å: error-network-timeout                          â”‚
â”‚  [è¿”å›åˆ—è¡¨]                                     [åˆ›å»ºç­–ç•¥] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç»Ÿè®¡ä¿¡æ¯                                                  â”‚
â”‚  - å‡ºç°æ¬¡æ•°: 45 æ¬¡                                        â”‚
â”‚  - é¦–æ¬¡å‡ºç°: 2026-02-10 08:00                            â”‚
â”‚  - æœ€è¿‘å‡ºç°: 2026-02-12 14:30                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…³è”ç­–ç•¥ (2 ä¸ª)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ #123 | Active (Low Risk)                           â”‚ â”‚
â”‚  â”‚      | æˆåŠŸ: 15/15, è¯•ç”¨: 5/5                       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ #126 | Probation (Med Risk)                        â”‚ â”‚
â”‚  â”‚      | è¯•ç”¨: 2/3 (67% pass rate)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**:
```typescript
GET /api/brain/failures/signatures/:signature
```

**äº¤äº’**:
- ç‚¹å‡»ç­–ç•¥å¡ç‰‡ â†’ è·³è½¬åˆ°ç­–ç•¥è¯¦æƒ…é¡µ
- ç‚¹å‡» "åˆ›å»ºç­–ç•¥" â†’ å¼¹å‡ºè¡¨å•ï¼ˆè‡ªåŠ¨å¡«å…… signatureï¼‰

---

## ä¸‰ã€æŠ€æœ¯å®ç°

### 3.1 æŠ€æœ¯æ ˆ

**å‰ç«¯æ¡†æ¶**:
- React + TypeScript
- è·¯ç”±: React Router
- çŠ¶æ€ç®¡ç†: SWRï¼ˆAPI æ•°æ®ç¼“å­˜ï¼‰
- UI ç»„ä»¶åº“: Ant Design / Shadcn UIï¼ˆæ ¹æ® workspace ç°æœ‰æŠ€æœ¯æ ˆé€‰æ‹©ï¼‰

**API å®¢æˆ·ç«¯**:
```typescript
// apps/core/src/dashboard/services/immune-api.ts
export class ImmuneAPI {
  private baseURL = 'http://localhost:5221/api/brain';

  async getDashboard() {
    return fetch(`${this.baseURL}/immune/dashboard`).then(r => r.json());
  }

  async getPolicies(params: { status?: string; limit?: number; offset?: number }) {
    const query = new URLSearchParams(params as any).toString();
    return fetch(`${this.baseURL}/policies?${query}`).then(r => r.json());
  }

  async getPolicy(id: number) {
    return fetch(`${this.baseURL}/policies/${id}`).then(r => r.json());
  }

  async updatePolicyStatus(id: number, status: string, reason?: string) {
    return fetch(`${this.baseURL}/policies/${id}/status`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status, reason })
    }).then(r => r.json());
  }

  async getSignatures(params: { limit?: number; min_count?: number }) {
    const query = new URLSearchParams(params as any).toString();
    return fetch(`${this.baseURL}/failures/signatures?${query}`).then(r => r.json());
  }

  async getSignature(signature: string) {
    return fetch(`${this.baseURL}/failures/signatures/${signature}`).then(r => r.json());
  }
}
```

### 3.2 æ–‡ä»¶ç»“æ„

```
workspace/apps/core/src/dashboard/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ immune/
â”‚       â”œâ”€â”€ Dashboard.tsx          # æ€»è§ˆé¡µ
â”‚       â”œâ”€â”€ Policies.tsx            # ç­–ç•¥åˆ—è¡¨
â”‚       â”œâ”€â”€ PolicyDetail.tsx        # ç­–ç•¥è¯¦æƒ…
â”‚       â”œâ”€â”€ Signatures.tsx          # å¤±è´¥ç­¾ååˆ—è¡¨
â”‚       â”œâ”€â”€ SignatureDetail.tsx     # ç­¾åè¯¦æƒ…
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ PolicyCard.tsx      # ç­–ç•¥å¡ç‰‡ç»„ä»¶
â”‚           â”œâ”€â”€ StatusBadge.tsx     # çŠ¶æ€å¾½ç« 
â”‚           â”œâ”€â”€ RiskBadge.tsx       # é£é™©ç­‰çº§å¾½ç« 
â”‚           â””â”€â”€ EvaluationTable.tsx # è¯„ä¼°å†å²è¡¨æ ¼
â”œâ”€â”€ services/
â”‚   â””â”€â”€ immune-api.ts               # API å®¢æˆ·ç«¯
â”œâ”€â”€ routes.ts                       # æ·»åŠ  /immune è·¯ç”±
â””â”€â”€ types/
    â””â”€â”€ immune.ts                   # TypeScript ç±»å‹å®šä¹‰
```

### 3.3 ç±»å‹å®šä¹‰

```typescript
// apps/core/src/dashboard/types/immune.ts

export type PolicyStatus = 'draft' | 'probation' | 'active' | 'disabled';
export type RiskLevel = 'low' | 'medium' | 'high';

export interface Policy {
  policy_id: number;
  signature: string;
  status: PolicyStatus;
  policy_json: {
    action: string;
    params: Record<string, any>;
    reason?: string;
  };
  risk_level: RiskLevel;
  success_count: number;
  failure_count: number;
  created_at: string;  // ISO 8601
  promoted_at: string | null;
}

export interface PolicyEvaluation {
  eval_id: number;
  task_id: string;
  mode: 'simulate' | 'apply' | 'promote';
  result: 'would_succeed' | 'would_fail' | 'success' | 'failure';
  evaluated_at: string;
  details?: Record<string, any>;
}

export interface FailureSignature {
  signature: string;
  count: number;
  first_seen: string;
  last_seen: string;
  active_policies: number;
  probation_policies: number;
}

export interface DashboardData {
  policies: {
    draft: number;
    probation: number;
    active: number;
    disabled: number;
    total: number;
  };
  quarantine: {
    total: number;
    by_reason: {
      failure_threshold: number;
      manual: number;
      resource_hog: number;
    };
  };
  failures: {
    top_signatures: Array<{
      signature: string;
      count: number;
    }>;
  };
  recent_promotions: Array<{
    policy_id: number;
    signature: string;
    promoted_at: string;
    simulations: number;
    pass_rate: number;
    risk_level: RiskLevel;
  }>;
}
```

---

## å››ã€API ç«¯ç‚¹æ–‡æ¡£ï¼ˆå‚è€ƒï¼‰

### 4.1 Dashboard API

```
GET /api/brain/immune/dashboard
```

**Response**:
```json
{
  "success": true,
  "data": {
    "policies": { "draft": 5, "probation": 3, "active": 12, "disabled": 8, "total": 28 },
    "quarantine": { "total": 15, "by_reason": { "failure_threshold": 10, "manual": 3, "resource_hog": 2 } },
    "failures": {
      "top_signatures": [
        { "signature": "error-network-timeout", "count": 45 }
      ]
    },
    "recent_promotions": [
      {
        "policy_id": 123,
        "signature": "error-network-timeout",
        "promoted_at": "2026-02-13T15:30:00Z",
        "simulations": 5,
        "pass_rate": 1.0,
        "risk_level": "low"
      }
    ]
  }
}
```

### 4.2 Policies API

```
GET /api/brain/policies?status=active&limit=50&offset=0
GET /api/brain/policies/:id
GET /api/brain/policies/:id/evaluations?limit=100&offset=0
PATCH /api/brain/policies/:id/status
```

è¯¦ç»†å“åº”æ ¼å¼è§ `core/.prd.md`ï¼ˆAPI å±‚ PRDï¼‰ã€‚

### 4.3 Signatures API

```
GET /api/brain/failures/signatures?limit=20&min_count=5
GET /api/brain/failures/signatures/:signature
```

---

## äº”ã€UI/UX è®¾è®¡è¦æ±‚

### 5.1 è®¾è®¡é£æ ¼

- **æ•´ä½“é£æ ¼**: ç®€æ´ã€ä¸“ä¸šã€æ•°æ®é©±åŠ¨
- **é…è‰²æ–¹æ¡ˆ**:
  - Active: ç»¿è‰² (#52c41a)
  - Probation: é»„è‰² (#faad14)
  - Draft: ç°è‰² (#8c8c8c)
  - Disabled: çº¢è‰² (#f5222d)
  - Low Risk: ç»¿è‰²
  - Medium Risk: æ©™è‰²
  - High Risk: çº¢è‰²

### 5.2 å“åº”å¼å¸ƒå±€

- **Desktop First**: ä¸»è¦åœ¨æ¡Œé¢ç«¯ä½¿ç”¨
- **æœ€å°å®½åº¦**: 1280px
- **ä¾§è¾¹æ å¯¼èˆª**: æ·»åŠ  "å…ç–«ç³»ç»Ÿ" èœå•é¡¹

### 5.3 äº¤äº’ç»†èŠ‚

- **åŠ è½½çŠ¶æ€**: ä½¿ç”¨ Skeleton Loadingï¼ˆéª¨æ¶å±ï¼‰
- **é”™è¯¯å¤„ç†**: Toast é€šçŸ¥ + é”™è¯¯è¾¹ç•Œ
- **ç©ºçŠ¶æ€**: å‹å¥½çš„æç¤ºä¿¡æ¯ï¼ˆ"æš‚æ— ç­–ç•¥ï¼Œç‚¹å‡»æ–°å»º"ï¼‰
- **ç¡®è®¤å¯¹è¯æ¡†**: ç¦ç”¨ç­–ç•¥ã€åˆ é™¤ç­–ç•¥ç­‰å±é™©æ“ä½œ

---

## å…­ã€æˆåŠŸæ ‡å‡†ï¼ˆDoDï¼‰

### 6.1 åŠŸèƒ½å®Œæ•´æ€§

- [ ] Dashboard é¡µé¢æ­£ç¡®å±•ç¤º 4 ä¸ªæ¨¡å—
- [ ] ç­–ç•¥åˆ—è¡¨æ”¯æŒè¿‡æ»¤å’Œæ’åº
- [ ] ç­–ç•¥è¯¦æƒ…é¡µå±•ç¤ºå®Œæ•´ä¿¡æ¯ + è¯„ä¼°å†å²
- [ ] å¤±è´¥ç­¾ååˆ—è¡¨å±•ç¤ºç»Ÿè®¡ä¿¡æ¯
- [ ] ç­¾åè¯¦æƒ…é¡µå±•ç¤ºå…³è”ç­–ç•¥

### 6.2 API é›†æˆ

- [ ] æ‰€æœ‰ 8 ä¸ª API ç«¯ç‚¹è°ƒç”¨æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†è¦†ç›– 400/404/500
- [ ] åŠ è½½çŠ¶æ€æ˜¾ç¤ºæ­£ç¡®
- [ ] æ•°æ®åˆ·æ–°æœºåˆ¶ï¼ˆSWR è‡ªåŠ¨é‡æ–°éªŒè¯ï¼‰

### 6.3 äº¤äº’ä½“éªŒ

- [ ] ç‚¹å‡»è·³è½¬æ­£ç¡®ï¼ˆç­–ç•¥ â†” ç­¾åï¼‰
- [ ] ç¦ç”¨ç­–ç•¥åŠŸèƒ½æ­£å¸¸ï¼ˆå«ç¡®è®¤å¯¹è¯æ¡†ï¼‰
- [ ] è¿‡æ»¤å’Œæ’åºåŠŸèƒ½æ­£å¸¸
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸ï¼ˆç­–ç•¥åˆ—è¡¨ã€è¯„ä¼°å†å²ï¼‰

### 6.4 ä»£ç è´¨é‡

- [ ] TypeScript ç±»å‹å®Œæ•´ï¼Œæ—  any
- [ ] ç»„ä»¶å¯å¤ç”¨ï¼ˆPolicyCard, StatusBadge ç­‰ï¼‰
- [ ] API å®¢æˆ·ç«¯å°è£…è‰¯å¥½
- [ ] è‡³å°‘ 5 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆå…³é”®ç»„ä»¶ï¼‰

---

## ä¸ƒã€éåŠŸèƒ½éœ€æ±‚

### 7.1 æ€§èƒ½

- **é¦–å±åŠ è½½**: < 2sï¼ˆæœ¬åœ°ç¯å¢ƒï¼‰
- **API å“åº”ç¼“å­˜**: SWR è‡ªåŠ¨ç¼“å­˜ + 5 åˆ†é’Ÿé‡æ–°éªŒè¯
- **åˆ—è¡¨æ¸²æŸ“**: è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚æœç­–ç•¥ > 100 æ¡ï¼‰

### 7.2 å…¼å®¹æ€§

- **æµè§ˆå™¨**: Chrome æœ€æ–°ç‰ˆï¼ˆä¸»è¦ä½¿ç”¨ï¼‰
- **ä¸éœ€è¦**: Safari/Firefox/Edge å…¼å®¹ï¼ˆå†…éƒ¨å·¥å…·ï¼‰

### 7.3 å®‰å…¨æ€§

- **è®¤è¯**: å¤ç”¨ workspace ç°æœ‰è®¤è¯æœºåˆ¶ï¼ˆå¦‚æœæœ‰ï¼‰
- **CORS**: Brain API å·²é…ç½® CORS å…è®¸ localhost:5211

---

## å…«ã€å®ç°é¡ºåºå»ºè®®

### Phase 1: åŸºç¡€è®¾æ–½ï¼ˆ1-2 å°æ—¶ï¼‰
1. åˆ›å»ºæ–‡ä»¶ç»“æ„
2. å®ç° API å®¢æˆ·ç«¯ï¼ˆ`immune-api.ts`ï¼‰
3. å®šä¹‰ TypeScript ç±»å‹ï¼ˆ`immune.ts`ï¼‰
4. æ·»åŠ è·¯ç”±é…ç½®

### Phase 2: Dashboardï¼ˆ2-3 å°æ—¶ï¼‰
1. Dashboard é¡µé¢æ¡†æ¶
2. 4 ä¸ªç»Ÿè®¡æ¨¡å—ï¼ˆå¡ç‰‡ç»„ä»¶ï¼‰
3. API é›†æˆ + æ•°æ®å±•ç¤º
4. äº¤äº’è·³è½¬

### Phase 3: ç­–ç•¥ç®¡ç†ï¼ˆ3-4 å°æ—¶ï¼‰
1. ç­–ç•¥åˆ—è¡¨é¡µï¼ˆè¿‡æ»¤ã€æ’åºã€åˆ†é¡µï¼‰
2. ç­–ç•¥è¯¦æƒ…é¡µï¼ˆåŸºæœ¬ä¿¡æ¯ + è¯„ä¼°å†å²ï¼‰
3. ç¦ç”¨ç­–ç•¥åŠŸèƒ½
4. ç»„ä»¶å¤ç”¨ï¼ˆPolicyCard, StatusBadgeï¼‰

### Phase 4: å¤±è´¥åˆ†æï¼ˆ2-3 å°æ—¶ï¼‰
1. å¤±è´¥ç­¾ååˆ—è¡¨é¡µ
2. ç­¾åè¯¦æƒ…é¡µ
3. å…³è”ç­–ç•¥å±•ç¤º

### Phase 5: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1-2 å°æ—¶ï¼‰
1. å•å…ƒæµ‹è¯•ï¼ˆå…³é”®ç»„ä»¶ï¼‰
2. ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆç”¨æˆ·æµç¨‹ï¼‰
3. æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€è™šæ‹Ÿæ»šåŠ¨ï¼‰
4. UI ç»†èŠ‚æ‰“ç£¨

**é¢„ä¼°æ€»æ—¶é—´**: 9-14 å°æ—¶

---

## ä¹ã€æ³¨æ„äº‹é¡¹

### 9.1 API è°ƒç”¨

- **Brain API åœ°å€**: `http://localhost:5221/api/brain`
- **æ³¨æ„**: ç¡®ä¿ Brain æœåŠ¡è¿è¡Œï¼ˆ`docker-compose up -d` åœ¨ core ä»“åº“ï¼‰
- **CORS**: å·²é…ç½®ï¼Œworkspace å¯ä»¥ç›´æ¥è°ƒç”¨

### 9.2 æ•°æ®æ ¼å¼

- **æ‰€æœ‰æ—¶é—´å­—æ®µ**: ISO 8601 æ ¼å¼ï¼ˆ`2026-02-12T14:30:00Z`ï¼‰
- **ä½¿ç”¨ `new Date(timestamp).toLocaleString('zh-CN')` æ ¼å¼åŒ–æ˜¾ç¤º**

### 9.3 çŠ¶æ€ç®¡ç†

- **æ¨èä½¿ç”¨ SWR**: è‡ªåŠ¨ç¼“å­˜ + é‡æ–°éªŒè¯
- **ä¸éœ€è¦ Redux/Zustand**: æ•°æ®ä¸»è¦æ˜¯æœåŠ¡ç«¯çŠ¶æ€

### 9.4 æµ‹è¯•ç­–ç•¥

- **ä¼˜å…ˆçº§**: E2E > é›†æˆ > å•å…ƒ
- **å…³é”®è·¯å¾„**: Dashboard â†’ ç­–ç•¥åˆ—è¡¨ â†’ ç­–ç•¥è¯¦æƒ… â†’ ç¦ç”¨ç­–ç•¥

---

## åã€é™„å½•ï¼šAPI å¿«é€Ÿå‚è€ƒ

| API ç«¯ç‚¹ | æ–¹æ³• | ç”¨é€” |
|---------|------|------|
| `/immune/dashboard` | GET | Dashboard æ€»è§ˆ |
| `/policies` | GET | ç­–ç•¥åˆ—è¡¨ |
| `/policies/:id` | GET | ç­–ç•¥è¯¦æƒ… |
| `/policies/:id/evaluations` | GET | è¯„ä¼°å†å² |
| `/policies/:id/status` | PATCH | æ›´æ–°çŠ¶æ€ |
| `/failures/signatures` | GET | å¤±è´¥ç­¾ååˆ—è¡¨ |
| `/failures/signatures/:signature` | GET | ç­¾åè¯¦æƒ… |
| `/policies/promotions` | GET | æ™‹å‡å†å² |

**æ‰€æœ‰ API å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "data": { ... }
}
```

**é”™è¯¯å“åº”æ ¼å¼**:
```json
{
  "success": false,
  "error": "Error message",
  "details": "Detailed error info"
}
```

---

## åä¸€ã€å‚è€ƒèµ„æ–™

- **API æ¥å£å±‚ PRD**: `core/.prd.md` - è¯¦ç»†çš„ API è®¾è®¡æ–‡æ¡£
- **Brain API æµ‹è¯•**: ä½¿ç”¨ `curl localhost:5221/api/brain/immune/dashboard` æµ‹è¯•
- **ç°æœ‰ workspace ä»£ç **: å‚è€ƒ `apps/core/src/dashboard/` ç°æœ‰é¡µé¢ç»“æ„

---

**ä¸‹ä¸€æ­¥**: åœ¨ `cecelia/workspace` ä»“åº“è¿è¡Œ `/dev`ï¼ŒåŸºäºæœ¬ PRD å¼€å§‹å‰ç«¯å¼€å‘ã€‚
