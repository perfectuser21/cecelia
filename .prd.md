---
id: fix-frontend-proxy-ws
version: 1.0.0
created: 2026-02-23
updated: 2026-02-23
changelog:
  - 1.0.0: 初始版本
---

# PRD: frontend-proxy.js 补充 WebSocket upgrade 支持

## 背景

InboxPage 的 `useProposals` hook 通过 WebSocket 连接到 `/api/brain/ws`。
用户通过端口 5212 访问前端，请求经过 `cecelia-frontend` Docker 容器中的 `frontend-proxy.js`。

## 根因

`frontend-proxy.js` 是简单的 HTTP 代理，**没有处理 `upgrade` 事件**，
WebSocket 握手在这里被丢弃，导致 wsConnected 始终为 false。

## 解决方案

给 `frontend-proxy.js` 的 HTTP server 添加 `upgrade` 事件处理：
- 对 `/api/*` 路径的 WS upgrade，通过 `net.createConnection` 建立 TCP 隧道转发到 5211

## 验收标准

1. InboxPage 访问 localhost:5212 时 wsConnected = true
2. 容器重启后 WebSocket 依然正常
