---
id: unified-data-model
version: 3.0.0
created: 2026-01-30
updated: 2026-01-30
changelog:
  - 3.0.0: Phase 2 - 数据库统一迁移
  - 2.0.0: Phase 1 - 动态 Seats 调控
  - 1.0.0: 初始版本 - 统一数据模型
---

# PRD: 统一数据模型 (Phase 2)

## 背景

当前系统存在两个问题：
1. Autumnrice 使用独立的 TRD/Task 表，没有和现有 OKR/Project/Task 系统打通
2. Seats（并行执行能力）是静态的，没有根据服务器资源动态调整

## 目标

### 1. 动态 Seats 调控

服务器配置：8 核 CPU，16G 内存

计算逻辑：
- 基于内存：`(available_memory - 2GB) / 1.5GB`
- 基于 CPU：`cpu_cores / 1.5`
- 基于 Load：如果 `load_average > 6`，暂停新任务
- 上限：最多 6 seats

### 2. 统一数据模型

```
OKR
 └─ Objective → Key Result
     │
     ▼
Project (Repository)
 ├─ trd_content (项目文档)
 └─ Feature (SubProject)
     └─ PRD (迭代文档)
         │
         ▼
Task = Run = PR (从接任务到 merge)
 └─ Checkpoints (回滚点)
 └─ Commits
```

## 改动清单

### Phase 1: 动态 Seats

1. 更新 `executor.py` - Seats 动态计算
2. 添加 `GET /autumnrice/seats` API
3. 添加 throttle 逻辑

### Phase 2: 数据库迁移

1. `projects` 添加 `trd_content` 字段
2. 创建 `feature_prds` 表
3. 扩展 `tasks` 表字段

### Phase 3: 统一模型

1. Autumnrice 使用现有 projects/tasks 表
2. 删除独立的 trds/orchestrator_* 表

## Seats 状态 API

```json
GET /autumnrice/seats
{
  "max_seats": 6,
  "active_seats": 2,
  "available_seats": 4,
  "can_spawn_more": true,
  "throttle_reason": null,
  "seats": [
    {"seat_id": 1, "status": "running", "task_id": "xxx", "project": "cecelia-workspace"},
    {"seat_id": 2, "status": "running", "task_id": "yyy", "project": "cecelia-brain"},
    {"seat_id": 3, "status": "idle"},
    ...
  ]
}
```

## 成功标准

1. Seats 状态可通过 API 查询
2. 可以同时运行 5-6 个无头 Claude（资源允许时）
3. 当资源紧张时自动暂停新任务
4. 数据模型和现有 OKR/Project/Task 系统统一
