---
id: prd-thalamus-suggest-task-type
version: 1.0.0
created: 2026-02-18
updated: 2026-02-18
changelog:
  - 1.0.0: 初始版本
---

# PRD: thalamus.js 新增 suggest-task-type 警告 action

## 需求来源

探索调研（task 4da2a503）确认：capabilities 表孤立（未被任何代码引用），identifyWorkType() 是死代码。推荐方案 D Step 3：在 thalamus.js 的 ACTION_WHITELIST 中新增 suggest-task-type action，作为轻量级的 task_type 建议机制。

## 功能描述

在 thalamus.js 中新增 suggest-task-type action：
- 触发条件：当 dev task 完成时 failure_rate > 30%（可能 task_type 选错了）
- 行为：记录 warning 日志，写入 learnings 表，供人工审查
- **不自动修改 task_type**（风险太高）

## 涉及文件

- brain/src/thalamus.js（新增 action + 处理函数）
- brain/src/__tests__/thalamus-suggest-task-type.test.js（新增测试）
- DEFINITION.md（同步更新 action 列表）

## 成功标准

- suggest-task-type 加入 ACTION_WHITELIST
- handleSuggestTaskType() 实现完成（只记录日志/learnings，不修改 task_type）
- vitest 测试：3 个用例全部通过
- facts-check.mjs 通过（action_count 字段更新）
- DEFINITION.md 同步更新
- check-version-sync.sh 通过（minor bump）

## 非目标

- 不自动修改 task_type
- 不修改 capabilities 表或 identifyWorkType()
- 不删除任何现有代码
