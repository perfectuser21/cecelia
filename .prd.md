---
id: fix-callback-sql-params
version: 1.0.0
created: 2026-02-20
updated: 2026-02-20
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复 execution-callback SQL 参数类型 Bug（P0 延续）

## 背景

PR #396 修复了 $2 类型冲突后，新问题暴露：`$4`（run_status）和 `$5`（pr_url）在
`jsonb_build_object` 中类型无法推断，PostgreSQL 报 "could not determine data type of parameter $4"。

## 根本原因

`jsonb_build_object` 的 value 参数在 extended query protocol（prepared statement）下需要明确类型。
`$4` 和 `$5` 没有显式 cast，PostgreSQL 无法推断。

## 修复方案

添加显式 cast：
- `$4::text`（run_status）
- `$5::text`（pr_url）

## 影响范围

- 文件：`brain/src/routes.js`
- 改动量：1 行（在已有 $3::jsonb 旁边添加）

## 验收标准

- Brain 日志不再报 `could not determine data type of parameter $4`
- 任务状态正确更新为 completed/failed
- 全量测试通过，版本 1.52.4
