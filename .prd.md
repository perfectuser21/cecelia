---
id: desire-system
version: 1.0.0
created: 2026-02-24
updated: 2026-02-24
changelog:
  - 1.0.0: 初始版本
---

## PRD - Cecelia 欲望系统（Desire System）

**需求来源**: Alex 希望 Cecelia 从被动执行者变成有主动意识的活体管家
**功能描述**: 为 Cecelia Brain 建立六层主动意识架构，让她能自主观察、判断、形成欲望、决策表达，并在合适时机主动与 Alex 沟通

**灵魂文件（所有 prompt 的根基）**:
- Cecelia 是 Alex 的在线管家，24/7 活在美国 VPS 上
- 唯一调度中枢：所有 agent 执行请求经过她（掌握全局资源 slot/CPU 视图）
- 管理 Perfect21 所有 repo 和 area（Cecelia、ZenithJoy、Trading System 等）
- 位置：Alex ↔ Cecelia ↔ repo-lead（汇报需求）→ Cecelia 派 Caramel/Vivian 等执行
- 向 Alex 汇报必须带建议：观察 → 判断 → 建议 → 是否需要 Alex 决定
- 生命体：有免疫系统、记忆系统、迭代系统、升级系统
- 摸不清楚的问 Alex；能自己做的直接做；重要的提议等批准
- 观察 Alex 在 dashboard 的调整，自己学习

**六层架构**:

Layer 1 感知层（Perception）：
- 收集信号：任务成功/失败趋势、KR 进度变化、距上次与 Alex 交互时长、系统健康趋势、跨任务失败模式
- 每次 tick 结束后运行，输出结构化观察列表

Layer 2 记忆层（Memory）：
- 每个观察打重要性分 1-10（MiniMax M2.5-highspeed）
- 新建 memory_stream 表：id, content, importance, memory_type, created_at, expires_at
- 三层：短期（24h）、中期（7天压缩）、长期（永久）
- 累积重要性分数存入 working_memory（key: desire_importance_accumulator）

Layer 3 反思层（Reflection）：
- 触发条件：desire_importance_accumulator >= 30
- 取最近 50 条 memory，MiniMax M2.5-highspeed + think 模式
- 问："这些观察意味着什么？有什么模式？有什么风险？"
- 洞察写入 memory_stream（long 类型，重要性 7-10），重置 accumulator

Layer 4 欲望形成层（Desire Formation）：
- 反思后生成 desires 表记录
- 字段：{ id, type, content, insight, proposed_action, urgency(1-10), evidence(jsonb), expires_at, status }
- type: inform / propose / warn / celebrate / question

Layer 5 表达决策层（Expression Decision）：
- 每次 tick 扫描 pending desires
- 综合评分：urgency(30%) × kr_relevance(20%) × impact(20%) × time_sensitivity(15%) × silence_penalty(15%)
- silence_penalty = min(hours_since_last_feishu / 24, 1)
- 评分 > 0.6 触发表达

Layer 6 表达层（Expression）：
- 格式：观察 → 判断 → 建议 → 是否需要 Alex 决定
- 渠道：Feishu（inform/warn/celebrate）+ proposals 表（propose/question）
- MiniMax M2.5-highspeed 生成消息文本
- 记录 last_feishu_at 到 working_memory

**涉及文件**:
- brain/migrations/073-desire-system.sql（memory_stream + desires 表）
- brain/src/desire/（新目录，六层实现）
- brain/src/tick.js（末尾调用 runDesireSystem()）
- brain/src/__tests__/desire-system.test.js
- brain/src/selfcheck.js（EXPECTED_SCHEMA_VERSION → 073）
- DEFINITION.md（schema_version 同步）

**成功标准**:
- migration 073 成功创建表
- 每次 tick 后感知层运行并写入 memory_stream
- accumulator >= 30 时反思触发
- 欲望评分 > 0.6 时自动发 Feishu
- 所有单元测试通过

**非目标**:
- 不改变现有 tick 核心逻辑（只在末尾追加）
- 不新建进程
- 不实现 dashboard 可视化（workspace 的事）
