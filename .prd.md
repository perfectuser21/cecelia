---
id: fix-seats-detection
version: 1.0.0
created: 2026-01-30
---

# PRD: 修复 Seats 检测逻辑

## 问题

当前 `/autumnrice/seats` API 的 `active_seats` 只统计通过 Autumnrice 启动的任务，不包括手动启动的 Claude Code 会话。

导致：
- 实际有 4 个 Claude 进程在运行
- 但 API 返回 `active_seats: 0`

## 目标

修改 `active_seats` 逻辑，让它基于实际检测到的 Claude 主进程数量。

## 改动

修改 `src/autumnrice/executor.py`:
1. 使用 `pgrep -x claude` 精确匹配 Claude 主进程
2. 如果没有通过 Executor 启动的任务，使用检测到的进程数作为 `active_seats`

## 成功标准

1. 手动启动的 Claude Code 会显示为 active seat
2. 前端显示正确的 active/total 比例
