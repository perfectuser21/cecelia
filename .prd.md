---
id: prd-model-profile-switch
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

# PRD: 模型 Profile 运行时切换系统

## 功能描述

Brain executor 当前硬编码 LLM 模型配置（MODEL_MAP / FIXED_PROVIDER），切换模型需要改代码重启。
需要实现运行时 Profile 切换：后台 Dashboard 一键选择 Profile，Brain 自动切换所有 LLM 调用路由。

### 核心功能

1. **model_profiles 表**：存储 Profile 配置（thalamus/cortex/executor 三层模型配置）
2. **内存缓存 + DB 持久化**：启动时加载 active profile，切换时刷新缓存
3. **Profile-driven dispatch**：executor/thalamus/cortex 读取 profile 决定使用哪个 LLM
4. **REST API**：GET/PUT 端点查询和切换 Profile
5. **WebSocket 广播**：切换时 broadcast profile:changed 事件

### 预置 Profile

- **MiniMax 主力**（默认）：L1=MiniMax M2.1, L2=Opus, executor=MiniMax M2.5-hs
- **Anthropic 主力**：L1=Haiku, L2=Opus, executor=Sonnet

### FALLBACK 策略

DB 不可用时使用硬编码 FALLBACK_PROFILE（MiniMax 主力配置）。

## 成功标准

- Dashboard 可通过 API 切换 Profile，无需重启 Brain
- executor/thalamus/cortex 都从 active profile 读取模型配置
- 切换时 WebSocket 广播 profile:changed 事件
- 所有现有测试通过（零回归）
