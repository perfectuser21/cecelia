---
id: autumnrice-one-click-run
version: 1.0.0
created: 2026-01-30
---

# PRD: 秋米一键启动 - R-cell 循环

## 背景

秋米（Autumnrice）现在有：
- Planner（LLM 拆解 TRD → Tasks）
- Executor（执行 Task，调用 claude -p /dev）
- Seats（动态执行槽位）

但是缺少一个一键启动入口，让 R-cell 循环能转起来。

## 目标

添加 `POST /autumnrice/run` API，实现：
1. 接收一句话需求或完整 PRD
2. 自动创建 TRD
3. 自动调用 Planner 拆解成 Tasks
4. 自动分配 Seat 执行第一个 Task
5. Task 完成后自动执行下一个（R-cell 循环）

## API 设计

### POST /autumnrice/run

```json
Request:
{
  "prompt": "帮我给 cecelia-workspace 添加暗黑模式",
  "repo": "cecelia-workspace",  // 可选，默认从 prompt 推断
  "priority": "P1",  // 可选
  "async": true  // 是否异步执行
}

Response:
{
  "success": true,
  "trd_id": "TRD-2026-01-30-ABC",
  "tasks": [...],
  "execution": {
    "started": true,
    "first_task_id": "T-XXXXXX",
    "seat_id": 1
  }
}
```

### GET /autumnrice/run/{trd_id}

查询执行进度：
```json
{
  "trd_id": "TRD-2026-01-30-ABC",
  "status": "in_progress",
  "tasks": [
    {"id": "T-1", "status": "done", "pr_url": "..."},
    {"id": "T-2", "status": "running", "seat_id": 2},
    {"id": "T-3", "status": "queued"}
  ],
  "progress": "2/3 tasks completed"
}
```

## R-cell 循环逻辑

```
用户 → POST /run "需求"
         ↓
       Planner 拆解 → Tasks [T1, T2, T3]
         ↓
       检查 Seats → 有空位？
         ↓ 有
       分配 T1 → Seat 1 → claude -p /dev
         ↓
       T1 完成 → 更新状态 → 检查下一个
         ↓
       T2 ready？→ 分配 Seat → 执行
         ↓
       ... 循环直到所有 Tasks 完成
         ↓
       TRD 标记为 done
```

## 自动循环触发

两种方式：
1. **轮询模式**: 定时调用 `/tick`，检查并推进状态
2. **事件驱动**: Task 完成时自动触发下一个

先实现轮询模式（简单可靠），后续优化为事件驱动。

## 成功标准

1. `POST /autumnrice/run "需求"` 能启动完整流程
2. Tasks 能自动依次执行（无需人工干预）
3. 可以通过 `/run/{id}` 查询进度
4. Seats 动态分配，支持并行执行无依赖的 Tasks
