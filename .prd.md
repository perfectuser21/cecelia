---
id: dept-head-missing-apis
version: 1.0.0
created: 2026-02-23
---

# PRD: 部门主管缺失 API — goals 查询 + pending-actions 创建

## 背景

部门主管（repo-lead）在 heartbeat 流程中需要调用两个 Brain API，但这两个接口目前不存在：

1. `GET /api/brain/goals?dept=xxx` — 读取本部门的 OKR/KR 进度
2. `POST /api/brain/pending-actions` — 向 Cecelia 提交提案/请求

当前 `routes.js` 缺少这两个端点，导致 heartbeat 流程中断（404 响应）。

## 需求

### 接口 1：GET /api/brain/goals

**功能**：查询 goals 表，支持按部门过滤

**请求**：
```
GET /api/brain/goals?dept=zenithjoy
GET /api/brain/goals          (无过滤，返回全部)
```

**过滤逻辑**：
- `dept` 参数存在时：`WHERE metadata->>'dept' = $1`
- 无参数时：返回所有 goals

**响应**：
```json
[
  {
    "id": "uuid",
    "title": "OKR 标题",
    "type": "area_okr",
    "status": "in_progress",
    "priority": "P0",
    "progress": 0,
    "metadata": { "dept": "zenithjoy" },
    "created_at": "2026-02-23T..."
  }
]
```

### 接口 2：POST /api/brain/pending-actions

**功能**：创建新的 pending action（部门主管向 Cecelia 提案）

**请求 body**：
```json
{
  "action_type": "request_more_slots",
  "requester": "repo-lead:zenithjoy",
  "context": {
    "reason": "当前有 3 个 dev 任务等待，但配额只有 2",
    "requested_slots": 1
  }
}
```

**字段说明**：
- `action_type`: 必填，动作类型
- `requester`: 必填，请求方身份
- `context`: 可选，附加上下文信息
- `status`: 默认 'pending'
- `source`: 默认 'repo-lead'

**响应**：
```json
{
  "id": "uuid",
  "action_type": "request_more_slots",
  "status": "pending",
  "created_at": "2026-02-23T..."
}
```

## 验收标准

- [ ] GET /api/brain/goals 返回全部 goals
- [ ] GET /api/brain/goals?dept=zenithjoy 过滤正确
- [ ] POST /api/brain/pending-actions 创建成功，返回新记录
- [ ] 两个接口的单元测试通过
- [ ] npm test 全部通过
