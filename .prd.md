---
id: prd-mouth-brain-unify
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

## PRD - 嘴巴→大脑架构统一 + OpenAI Realtime 后端

**需求来源**: 用户架构讨论 — 嘴巴不应有独立"小脑"，应委托大脑处理所有思考/记忆/决策

**功能描述**:

### 背景

当前 Cecelia 嘴巴（orchestrator-chat.js）独立调用旧版记忆 API（memory-service.js）和 MiniMax LLM，
相当于嘴巴有自己的"小脑"。这违反了器官职责分离原则：嘴巴应该只是 I/O 接口，所有思考都由大脑负责。

同时，前端语音代码（useRealtimeVoice.ts）已完成，但后端 OpenAI Realtime 的 3 个端点未实现。

### 改动内容

**Part 1: 文字对话记忆统一**
- orchestrator-chat.js 的 `fetchMemoryContext()` 从调用旧 API (`POST /api/brain/memory/search`)
  改为直接调用 `buildMemoryContext()` (memory-retriever.js)
- 这样文字对话和大脑决策共享同一套记忆系统（Phase 1-3 升级后的版本）

**Part 2: OpenAI Realtime 后端端点**
- `GET /api/brain/orchestrator/realtime/config` — 返回 OpenAI API key、模型、voice、instructions、tools 配置
- `POST /api/brain/orchestrator/realtime/tool` — 处理 Realtime 会话中的工具调用（导航、查状态等）
- `WS /api/brain/orchestrator/realtime/ws` — WebSocket 代理，转发前端音频到 OpenAI Realtime API

**涉及文件**:
- `brain/src/orchestrator-chat.js` — 替换 fetchMemoryContext 为 buildMemoryContext
- `brain/src/orchestrator-realtime.js` — 新文件，Realtime 端点实现
- `brain/src/routes.js` — 注册新路由
- `brain/src/__tests__/orchestrator-realtime.test.js` — 新测试
- `brain/src/__tests__/orchestrator-chat-memory.test.js` — 记忆统一测试

**成功标准**:
1. orchestrator-chat 使用 buildMemoryContext 搜索记忆（不再调旧 API）
2. GET /realtime/config 返回正确配置
3. POST /realtime/tool 能处理工具调用
4. WS /realtime/ws 能建立 WebSocket 连接并代理到 OpenAI
5. 所有现有测试通过（零回归）

**非目标**:
- 不改前端代码（useRealtimeVoice.ts 已完成）
- 不改 thalamus/cortex 决策逻辑
- 不实现语音转文字（OpenAI Realtime API 自带）
