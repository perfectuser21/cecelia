---
id: prd-cp-02172100-whitelist-learning-actions
version: 1.0.0
created: 2026-02-17
updated: 2026-02-17
changelog:
  - 1.0.0: 初始版本
---

# PRD: 扩展白名单 - 知识/学习类 Actions

## 背景

丘脑当前缺少直接写入 learnings 表的能力，以及主动触发 RCA 的能力。现有 analyze_failure 只是标记分析意图，但丘脑没法真正保存经验教训。这导致系统无法形成自我学习闭环。

## 目标

在 ACTION_WHITELIST 中新增 3 个学习类 Actions，让丘脑能够直接保存经验教训、更新 learning 记录，以及触发根因分析流程。

## 具体修改

### 文件：brain/src/thalamus.js

在 ACTION_WHITELIST 中新增 3 个 Actions：
- `create_learning`: `{ dangerous: false, description: '保存经验教训到 learnings 表' }`
- `update_learning`: `{ dangerous: false, description: '更新已有 learning 记录' }`
- `trigger_rca`: `{ dangerous: false, description: '触发根因分析 (RCA) 流程' }`

### 文件：brain/src/decision-executor.js

新增对应的执行逻辑：
- `create_learning`: 调用 `INSERT INTO learnings`
- `update_learning`: 调用 `UPDATE learnings SET ... WHERE id = ...`
- `trigger_rca`: 创建一个 `task_type=analysis` 的任务

## 验收标准

1. ACTION_WHITELIST 新增 3 个 Actions（action_count 从 21 → 24）
2. decision-executor.js 中有对应 handler
   - create_learning: INSERT INTO learnings
   - update_learning: UPDATE learnings SET WHERE id
   - trigger_rca: 创建 task_type=analysis 任务
3. 单元测试验证 3 个新 Actions 通过白名单校验
4. 丘脑 Prompt 动态生成部分自动包含（从 ACTION_WHITELIST 遍历）
5. facts-check.mjs 更新 action_count = 24
6. DEFINITION.md 更新 action_count 字段
7. version bump (patch): 1.48.3 → 1.48.4
