import{r as n,j as e,R as j,ak as h,L as m,b5 as u,ae as N,af as k,aQ as v,b8 as w,a4 as y,e as C,a5 as S}from"./index-BhHU9tw7.js";import{g as $}from"./dev-tracker.api-D425N5eH.js";import"./client-CnxuPcLV.js";import"./index-B9ygI19o.js";const R=({status:t})=>{const a={passed:{bg:"bg-slate-500/20",text:"text-slate-500 dark:text-slate-400",label:"通过"},running:{bg:"bg-slate-400/20",text:"text-slate-500 dark:text-slate-400",label:"运行中"},failed:{bg:"bg-slate-600/20",text:"text-slate-600 dark:text-slate-400",label:"失败"},pending:{bg:"bg-slate-400/20",text:"text-slate-500 dark:text-slate-400",label:"等待中"},unknown:{bg:"bg-slate-500/20",text:"text-slate-500 dark:text-slate-400",label:"未知"}}[t];return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.bg} ${a.text}`,children:a.label})},L=({type:t})=>{const a={cp:{bg:"bg-slate-500/20",text:"text-slate-500 dark:text-slate-400"},feature:{bg:"bg-slate-400/20",text:"text-slate-500 dark:text-slate-400"},develop:{bg:"bg-slate-500/20",text:"text-slate-500 dark:text-slate-400"},main:{bg:"bg-slate-600/20",text:"text-slate-600 dark:text-slate-400"},unknown:{bg:"bg-slate-500/20",text:"text-slate-500 dark:text-slate-400"}},{bg:l,text:s}=a[t]||a.unknown;return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${l} ${s}`,children:t})},T=({steps:t})=>{const a=s=>{switch(s){case"done":return"bg-violet-500 border-violet-400 text-white";case"in_progress":return"bg-purple-400 border-purple-300 text-white animate-pulse";case"failed":return"bg-slate-500 border-slate-400 text-white";case"skipped":return"bg-slate-400 border-slate-300 text-white";default:return"bg-slate-200 dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-500 dark:text-slate-400"}},l=(s,d)=>s==="done"?"bg-violet-400":s==="in_progress"?"bg-gradient-to-r from-purple-400 to-slate-300 dark:to-slate-600":"bg-slate-300 dark:bg-slate-600";return e.jsx("div",{className:"flex items-center gap-0 overflow-x-auto pb-2",children:t.items.map((s,d)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all ${a(s.status)}`,title:`${s.name}: ${s.status}`,children:s.status==="done"?e.jsx(S,{className:"w-4 h-4"}):s.status==="in_progress"?e.jsx(m,{className:"w-4 h-4 animate-spin"}):s.status==="failed"?e.jsx(h,{className:"w-4 h-4"}):s.id}),e.jsx("span",{className:`text-[10px] mt-1 whitespace-nowrap ${s.status==="done"?"text-violet-600 dark:text-violet-400":s.status==="in_progress"?"text-purple-500 dark:text-purple-400":s.status==="failed"?"text-slate-500 dark:text-slate-400":"text-slate-400 dark:text-slate-500"}`,children:s.name})]}),d<t.items.length-1&&e.jsx("div",{className:`w-6 h-0.5 -mt-4 ${l(s.status,t.items[d+1].status)}`})]},s.id))})},E=({task:t})=>{const a=t.steps.items.filter(s=>s.status==="done").length,l=a/t.steps.total*100;return e.jsxs("div",{className:"bg-white dark:bg-slate-800/80 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-lg shadow-slate-200/50 dark:shadow-black/30 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-500/10 flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-slate-600 dark:text-slate-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-[#1d1d1f] dark:text-white",children:t.repo.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(v,{className:"w-3.5 h-3.5 text-[#86868b]"}),e.jsx("span",{className:"text-sm text-[#86868b] dark:text-slate-300",children:t.branches.current}),e.jsx(L,{type:t.branches.type})]})]})]}),t.task.prUrl&&e.jsxs("a",{href:t.task.prUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 px-3 py-1.5 bg-slate-500/10 text-slate-600 dark:text-slate-400 rounded-lg text-sm hover:bg-slate-500/20 transition-colors",children:[e.jsx(w,{className:"w-4 h-4"}),"#",t.task.prNumber,e.jsx(y,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"进度"}),e.jsxs("span",{className:"text-slate-700 dark:text-slate-300 font-medium",children:[a,"/",t.steps.total," 步骤"]})]}),e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-500 to-purple-400 transition-all duration-500",style:{width:`${l}%`}})})]}),e.jsx(T,{steps:t.steps}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-black/5 dark:border-white/10",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("span",{className:"text-[#86868b] dark:text-slate-300",children:"CI:"}),e.jsx(R,{status:t.quality.ci})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-[#86868b] dark:text-slate-300",children:[e.jsx(C,{className:"w-3.5 h-3.5"}),new Date(t.updatedAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})},_=({connected:t,loading:a})=>a?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-slate-400",children:[e.jsx(m,{className:"w-3 h-3 animate-spin"}),"同步中"]}):e.jsxs("span",{className:`flex items-center gap-1.5 text-xs ${t?"text-emerald-500":"text-red-400"}`,children:[t?e.jsx(N,{className:"w-3 h-3"}):e.jsx(k,{className:"w-3 h-3"}),t?"已连接":"离线"]});function G(){const[t,a]=n.useState([]),[l,s]=n.useState(!0),[d,i]=n.useState(null),[b,g]=n.useState(new Date),[p,o]=n.useState(!0),c=n.useRef(0),x=n.useCallback(async()=>{try{const r=await $();r.success&&r.data?(a(r.data),i(null),o(!0),c.current=0):i(r.error||"获取任务失败")}catch{c.current++,c.current>=3&&o(!1),i("无法连接到服务器")}finally{s(!1),g(new Date)}},[]);n.useEffect(()=>{x();const r=setInterval(x,5e3);return()=>clearInterval(r)},[x]);const f=()=>{s(!0),x()};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-[#1d1d1f] dark:text-white",children:"开发任务"}),e.jsx("p",{className:"text-[#86868b] dark:text-slate-300 mt-1",children:"实时追踪 VPS 上的开发进度"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{connected:p,loading:l&&t.length>0}),e.jsx("span",{className:"text-sm text-[#86868b] dark:text-slate-300",children:b.toLocaleTimeString("zh-CN")}),e.jsxs("button",{onClick:f,disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-slate-500/10 text-slate-600 dark:text-slate-400 rounded-xl hover:bg-slate-500/20 transition-colors disabled:opacity-50",children:[e.jsx(j,{className:`w-4 h-4 ${l?"animate-spin":""}`}),"刷新"]})]})]}),d&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-500 dark:text-red-400",children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{children:d})]})}),l&&t.length===0&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(m,{className:"w-10 h-10 text-slate-600 dark:text-slate-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-[#86868b] dark:text-slate-300",children:"加载中..."})]})}),!l&&t.length===0&&!d&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"w-16 h-16 text-[#86868b] dark:text-slate-300 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-lg font-medium text-[#1d1d1f] dark:text-white mb-2",children:"暂无活跃任务"}),e.jsx("p",{className:"text-[#86868b] dark:text-slate-300",children:"所有仓库都在 main 或 develop 分支上"})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:t.map(r=>e.jsx(E,{task:r},r.repo.name))}),t.length>0&&e.jsx("div",{className:"mt-8 p-4 bg-white dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"图例:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-violet-500"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"完成"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-purple-400 animate-pulse"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"进行中"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-500"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"失败"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-200 dark:bg-slate-600"}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"待处理"})]})]})})]})}export{G as default};
