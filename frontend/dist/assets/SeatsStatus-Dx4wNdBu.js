import{r as n,j as e,L as o,aa as O,R as L,ab as B,ac as I,e as U,a9 as R,a8 as D,ad as A,ae as W,af as z,ag as G,ah as H,m as X,a1 as F}from"./index-BhHU9tw7.js";function J({server:s,tickEnabled:g}){const a=s.status==="online",x=s.resources&&s.resources.cpu_pct>80,d=s.resources&&s.resources.mem_used_pct>80;return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border ${a?"border-gray-200 dark:border-gray-700":"border-red-300 dark:border-red-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:`w-5 h-5 ${a?"text-green-500":"text-red-500"}`}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:[s.location," ",s.name]}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:s.ip})]})]}),a?e.jsx(W,{className:"w-4 h-4 text-green-500"}):e.jsx(z,{className:"w-4 h-4 text-red-500"})]}),s.resources?e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{children:"CPU"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:`text-xl font-bold ${x?"text-red-500":""}`,children:[s.resources.cpu_pct,"%"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.resources.cpu_load,"/",s.resources.cpu_cores,"核"]})]}),e.jsx("div",{className:"mt-1 h-1.5 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${x?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(100,s.resources.cpu_pct)}%`}})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-1",children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:"内存"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsxs("span",{className:`text-xl font-bold ${d?"text-red-500":""}`,children:[s.resources.mem_used_pct,"%"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.resources.mem_free_gb,"GB 可用"]})]}),e.jsx("div",{className:"mt-1 h-1.5 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${d?"bg-red-500":"bg-green-500"}`,style:{width:`${s.resources.mem_used_pct}%`}})})]})]}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 mb-4 text-center text-gray-500",children:"无法获取资源数据"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 mb-2",children:[e.jsxs("span",{children:["席位 (",s.slots.used,"/",s.slots.max,")"]}),e.jsx("span",{className:"text-xs",children:s.task_types.join(", ")})]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from({length:s.slots.max},(l,t)=>{const c=t<s.slots.used,i=t>=s.slots.max-s.slots.reserved;return e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center transition-all text-sm
                  ${c?"bg-blue-500 text-white shadow-md shadow-blue-500/30":i?"bg-amber-100 text-amber-600 border-2 border-dashed border-amber-300 dark:bg-amber-900/30":"bg-gray-100 text-gray-400 dark:bg-gray-700"}`,children:c?e.jsx(X,{className:"w-4 h-4"}):i?e.jsx(F,{className:"w-4 h-4"}):t+1},t)})})]}),s.slots.processes.length>0&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"运行中的进程"}),e.jsx("div",{className:"space-y-1.5 max-h-32 overflow-y-auto",children:s.slots.processes.map((l,t)=>e.jsxs("div",{className:"flex items-center justify-between text-xs bg-gray-50 dark:bg-gray-700/50 rounded px-2 py-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsxs("span",{className:"font-mono text-gray-400 shrink-0",children:["PID ",l.pid]}),e.jsxs("span",{className:"truncate text-gray-600 dark:text-gray-300",title:l.command,children:[l.command.slice(0,40),"..."]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 text-gray-500",children:[e.jsxs("span",{children:["CPU ",l.cpu]}),e.jsxs("span",{children:["MEM ",l.memory]})]})]},t))})]})]})}function Q(){var p,u,y,N,f,w,v,k,_,C;const[s,g]=n.useState(null),[a,x]=n.useState(null),[d,l]=n.useState(null),[t,c]=n.useState(!0),[i,h]=n.useState(""),[b,j]=n.useState(!1),m=async()=>{try{c(!0);const[r,$,P]=await Promise.all([fetch("/api/brain/tick/status"),fetch("/api/brain/status"),fetch("/api/brain/cluster/status")]);if(r.ok&&g(await r.json()),$.ok&&x(await $.json()),P.ok){const E=await P.json();E.success&&l(E.cluster)}h("")}catch{h("加载失败")}finally{c(!1)}};n.useEffect(()=>{m();const r=setInterval(m,5e3);return()=>clearInterval(r)},[]);const T=async()=>{if(s){j(!0);try{const r=s.enabled?"/api/brain/tick/disable":"/api/brain/tick/enable";await fetch(r,{method:"POST"}),await m()}finally{j(!1)}}};if(t&&!s)return e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx(o,{className:"w-6 h-6 animate-spin text-gray-400"})});const q=((u=(p=a==null?void 0:a.task_digest)==null?void 0:p.stats)==null?void 0:u.queued)||0,M=((N=(y=a==null?void 0:a.task_digest)==null?void 0:y.stats)==null?void 0:N.in_progress)||0;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-6 h-6 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Cluster Seats"}),d&&e.jsxs("span",{className:"text-sm text-gray-500",children:[d.total_used,"/",d.total_slots," 席位使用中"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:m,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800",children:e.jsx(L,{className:`w-4 h-4 ${t?"animate-spin":""}`})}),e.jsxs("button",{onClick:T,disabled:b,className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition
              ${s!=null&&s.enabled?"bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400":"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400"}`,children:[b?e.jsx(o,{className:"w-4 h-4 animate-spin"}):s!=null&&s.enabled?e.jsx(B,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}),s!=null&&s.enabled?"暂停派发":"启动派发"]})]})]}),i&&e.jsx("div",{className:"p-3 bg-red-50 text-red-600 rounded-lg dark:bg-red-900/20",children:i}),d&&e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:d.servers.map(r=>e.jsx(J,{server:r,tickEnabled:(s==null?void 0:s.enabled)||!1},r.id))}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"队列等待"})]}),e.jsx("div",{className:"text-2xl font-semibold",children:q})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"运行中"})]}),e.jsx("div",{className:"text-2xl font-semibold",children:M})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Tick 间隔"})]}),e.jsxs("div",{className:"text-2xl font-semibold",children:[((s==null?void 0:s.dispatch_cooldown_ms)||5e3)/1e3,"s"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 mb-1",children:[s!=null&&s.loop_running?e.jsx(R,{className:"w-4 h-4 text-green-500"}):e.jsx(D,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:"Tick Loop"})]}),e.jsx("div",{className:`text-2xl font-semibold ${s!=null&&s.loop_running?"text-green-600":"text-red-600"}`,children:s!=null&&s.loop_running?"运行中":"已停止"})]})]}),e.jsxs("div",{className:"flex gap-6 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-blue-500"}),e.jsx("span",{children:"自动任务 (auto)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-gray-200 dark:bg-gray-600"}),e.jsx("span",{children:"空闲"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-dashed border-amber-400 bg-amber-100"}),e.jsx("span",{children:"预留手动 (manual)"})]})]}),(s==null?void 0:s.last_dispatch)&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:"最近派发"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.last_dispatch.task_title}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(s.last_dispatch.dispatched_at).toLocaleString("zh-CN")})]}),s.last_dispatch.success?e.jsx(R,{className:"w-5 h-5 text-green-500"}):e.jsx(D,{className:"w-5 h-5 text-red-500"})]})]}),(w=(f=a==null?void 0:a.task_digest)==null?void 0:f.p0)!=null&&w.length||(k=(v=a==null?void 0:a.task_digest)==null?void 0:v.p1)!=null&&k.length?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:"待处理任务"}),e.jsx("div",{className:"space-y-2",children:[...((_=a==null?void 0:a.task_digest)==null?void 0:_.p0)||[],...((C=a==null?void 0:a.task_digest)==null?void 0:C.p1)||[]].map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded
                    ${r.priority==="P0"?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:r.priority}),e.jsx("span",{children:r.title})]}),e.jsx("span",{className:`text-sm
                  ${r.status==="queued"?"text-gray-500":r.status==="in_progress"?"text-blue-500":"text-green-500"}`,children:r.status==="queued"?"排队中":r.status==="in_progress"?"执行中":r.status})]},r.id))})]}):null]})}export{Q as default};
