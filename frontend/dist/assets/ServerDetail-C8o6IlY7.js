import{al as D,am as P,r as o,j as e,L as M,a0 as w,ad as S,ae as B,af as I,R as L,ag as k,ah as y,m as R,a1 as _,e as A,aQ as E}from"./index-BhHU9tw7.js";function H(){const{serverId:h}=D(),b=P(),[s,$]=o.useState(null),[u,C]=o.useState(!0),d=async()=>{try{const t=await fetch("/api/brain/cluster/status");if(t.ok){const a=await t.json();if(a.success){const l=a.cluster.servers.find(r=>r.id===h);$(l||null)}}}catch(t){console.error("Fetch error:",t)}finally{C(!1)}};if(o.useEffect(()=>{d();const t=setInterval(d,5e3);return()=>clearInterval(t)},[h]),u)return e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-slate-400"})});if(!s)return e.jsxs("div",{className:"p-6",children:[e.jsxs("button",{onClick:()=>b("/brain/cecelia"),className:"flex items-center gap-2 text-slate-500 hover:text-slate-700 mb-4",children:[e.jsx(w,{className:"w-4 h-4"}),"返回总览"]}),e.jsx("div",{className:"text-center text-slate-500 py-12",children:"服务器不存在"})]});const c=s.status==="online",n=s.resources&&s.resources.cpu_pct>80,i=s.resources&&s.resources.mem_used_pct>80,j=s.slots.processes.filter(t=>{var a;return(a=t.command)==null?void 0:a.includes("-p")}),g=s.slots.processes.filter(t=>t.command&&!t.command.includes("-p"));return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b("/brain/cecelia"),className:"p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700",children:e.jsx(w,{className:"w-5 h-5 text-slate-500"})}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${c?"bg-gradient-to-br from-emerald-500 to-emerald-600":"bg-gradient-to-br from-red-500 to-red-600"}`,children:e.jsx(S,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:s.location}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-500",children:[e.jsx("span",{className:"font-mono",children:s.ip}),e.jsxs("span",{className:"flex items-center gap-1",children:[c?e.jsx(B,{className:"w-3 h-3 text-emerald-500"}):e.jsx(I,{className:"w-3 h-3 text-red-500"}),c?"在线":"离线"]})]})]})]}),e.jsx("button",{onClick:d,className:"p-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-700",children:e.jsx(L,{className:`w-4 h-4 text-slate-600 ${u?"animate-spin":""}`})})]}),s.resources&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${n?"bg-red-100 dark:bg-red-900/30":"bg-blue-100 dark:bg-blue-900/30"}`,children:e.jsx(k,{className:`w-5 h-5 ${n?"text-red-500":"text-blue-500"}`})}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300 font-medium",children:"CPU"})]}),e.jsxs("div",{className:"text-4xl font-bold text-slate-800 dark:text-white mb-2",children:[s.resources.cpu_pct,"%"]}),e.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:["负载 ",s.resources.cpu_load," / ",s.resources.cpu_cores," 核心"]}),e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${n?"bg-red-500":"bg-blue-500"}`,style:{width:`${Math.min(100,s.resources.cpu_pct)}%`}})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i?"bg-red-100 dark:bg-red-900/30":"bg-emerald-100 dark:bg-emerald-900/30"}`,children:e.jsx(y,{className:`w-5 h-5 ${i?"text-red-500":"text-emerald-500"}`})}),e.jsx("span",{className:"text-slate-600 dark:text-slate-300 font-medium",children:"内存"})]}),e.jsxs("div",{className:"text-4xl font-bold text-slate-800 dark:text-white mb-2",children:[s.resources.mem_used_pct,"%"]}),e.jsxs("div",{className:"text-sm text-slate-500 mb-3",children:[s.resources.mem_free_gb,"GB 空闲 / ",s.resources.mem_total_gb,"GB 总计"]}),e.jsx("div",{className:"h-3 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${i?"bg-red-500":"bg-emerald-500"}`,style:{width:`${s.resources.mem_used_pct}%`}})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"席位状态"}),e.jsxs("div",{className:"text-sm text-slate-500",children:[s.slots.used,"/",s.slots.dynamic_max," 使用中（最大 ",s.slots.max,"）"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:j.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"无头 (auto)"})]}),e.jsxs("div",{className:"text-center p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"有头 (manual)"})]}),e.jsxs("div",{className:"text-center p-3 bg-slate-50 dark:bg-slate-700/50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-600 dark:text-slate-300",children:s.slots.available}),e.jsx("div",{className:"text-xs text-slate-500",children:"可用"})]}),e.jsxs("div",{className:"text-center p-3 bg-amber-50 dark:bg-amber-900/20 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:s.slots.reserved}),e.jsx("div",{className:"text-xs text-slate-500",children:"预留"})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[j.map((t,a)=>e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 text-white flex items-center justify-center shadow-sm",children:e.jsx(R,{className:"w-4 h-4"})},`hl-${a}`)),g.map((t,a)=>e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 text-white flex items-center justify-center shadow-sm",children:e.jsx(_,{className:"w-4 h-4"})},`hd-${a}`)),Array.from({length:Math.max(0,s.slots.dynamic_max-s.slots.used-s.slots.reserved)},(t,a)=>e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-700 text-slate-400 flex items-center justify-center text-sm",children:s.slots.used+a+1},`av-${a}`)),s.slots.reserved>0&&e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-50 dark:bg-amber-900/20 text-amber-500 border-2 border-dashed border-amber-300 flex items-center justify-center",children:e.jsx(_,{className:"w-4 h-4"})}),Array.from({length:Math.max(0,s.slots.max-s.slots.dynamic_max)},(t,a)=>e.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-50 dark:bg-slate-800 text-slate-300 dark:text-slate-600 flex items-center justify-center text-sm border border-slate-200 dark:border-slate-700 opacity-50",children:s.slots.dynamic_max+a+1},`dis-${a}`))]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white mb-4",children:"运行中的进程"}),s.slots.processes.length>0?e.jsx("div",{className:"space-y-3",children:s.slots.processes.map((t,a)=>{var N,p,v;const l=!((N=t.command)!=null&&N.includes("-p")),r=(p=t.command)==null?void 0:p.match(/PRD - ([^#]+)/),x=r?r[1].trim():null,f=(v=t.command)==null?void 0:v.match(/dev\/([^/\s]+)/),m=f?f[1]:null;return e.jsxs("div",{className:`p-4 rounded-xl border ${l?"bg-emerald-50 border-emerald-200 dark:bg-emerald-900/20 dark:border-emerald-800":"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium ${l?"bg-emerald-100 text-emerald-700 dark:bg-emerald-800 dark:text-emerald-300":"bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-300"}`,children:l?"manual":"auto"}),e.jsxs("span",{className:"font-mono text-sm text-slate-500",children:["PID ",t.pid]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"})," ",t.cpu]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-3 h-3"})," ",t.memory]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," ",t.startTime]})]})]}),(x||m)&&e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[m&&e.jsxs("span",{className:"flex items-center gap-1.5 text-slate-600 dark:text-slate-400",children:[e.jsx(E,{className:"w-3.5 h-3.5"}),m]}),x&&e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:x})]})]},a)})}):e.jsx("div",{className:"text-center text-slate-400 py-8",children:"暂无运行中的进程"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white mb-4",children:"支持的任务类型"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:s.task_types.map(t=>e.jsx("span",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-xl text-sm font-medium text-slate-600 dark:text-slate-300",children:t},t))})]})]})}export{H as default};
