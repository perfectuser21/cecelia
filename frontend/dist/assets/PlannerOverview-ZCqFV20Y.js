import{r as c,j as e,R as N,a8 as $,B as T,O as w,ad as C,ag as L,A as b,ah as B,bv as E,U as k,ao as m,aF as v,bw as _,a4 as u,e as S,a9 as I,aQ as M,ac as O}from"./index-BhHU9tw7.js";import{a as f}from"./index-B9ygI19o.js";const z="/semantic-brain";f.create({baseURL:z,headers:{"Content-Type":"application/json"}});const P=f.create({baseURL:"/api",headers:{"Content-Type":"application/json"}});async function A(t=20){return(await P.get(`/cecelia/overview?limit=${t}`)).data}async function G(t){try{return{success:!0,message:(await f.post("/n8n/webhook/cecelia-start",t)).data.message||"Task triggered"}}catch(r){return{success:!1,message:r.message||"Failed to trigger task"}}}async function V(){return(await P.get("/panorama/command-center")).data.data}function q(){const[t,r]=c.useState(null),[s,n]=c.useState(null),[i,d]=c.useState(!0),[p,g]=c.useState(null),[x,D]=c.useState(null),[F,j]=c.useState(!1),[R,y]=c.useState(!1),h=async()=>{try{const[a,o]=await Promise.all([A(20),V()]);r(a),n(o),g(null),D(new Date)}catch(a){g(a.message)}finally{d(!1)}};c.useEffect(()=>{h();const a=setInterval(h,5e3);return()=>clearInterval(a)},[]);const U=async(a,o)=>{y(!0);try{const l=await G({project:a,prd_content:o});l.success?(alert("任务已触发！"),h()):alert(`触发失败: ${l.message}`)}finally{y(!1)}};return i&&!s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(N,{className:"w-8 h-8 text-blue-500 animate-spin"})}):p&&!s?e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx($,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",p]}),e.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl",children:e.jsx(T,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Command Center"}),e.jsx("p",{className:"text-gray-400",children:"VPS 状态 · Claude 会话 · 任务调度"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsx("span",{className:"text-sm text-gray-500",children:x.toLocaleTimeString("zh-CN")}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors",children:[e.jsx(w,{className:"w-4 h-4"}),"新建任务"]}),e.jsx("button",{onClick:h,disabled:i,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(N,{className:`w-5 h-5 ${i?"animate-spin":""}`})})]})]}),s&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-cyan-400"}),"VPS 状态"]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["运行时间: ",s.vps.uptime]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(L,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"CPU"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[s.vps.cpu.usage.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.vps.cpu.cores," 核 · 负载 ",s.vps.cpu.load.map(a=>a.toFixed(2)).join(" / ")]}),e.jsx("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s.vps.cpu.usage>80?"bg-red-500":s.vps.cpu.usage>50?"bg-amber-500":"bg-blue-500"}`,style:{width:`${Math.min(s.vps.cpu.usage,100)}%`}})})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(b,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"内存"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[s.vps.memory.percent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.vps.memory.used_gb," / ",s.vps.memory.total_gb," GB"]}),e.jsx("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s.vps.memory.percent>80?"bg-red-500":s.vps.memory.percent>50?"bg-amber-500":"bg-purple-500"}`,style:{width:`${s.vps.memory.percent}%`}})})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(B,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"磁盘"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[s.vps.disk.percent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.vps.disk.used_gb," / ",s.vps.disk.total_gb," GB"]}),e.jsx("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s.vps.disk.percent>80?"bg-red-500":s.vps.disk.percent>50?"bg-amber-500":"bg-green-500"}`,style:{width:`${s.vps.disk.percent}%`}})})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(E,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"并发容量"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[s.capacity.current_load," / ",s.capacity.max_concurrent]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["剩余 ",s.capacity.available_slots," 个槽位"]}),e.jsx("div",{className:"mt-2 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s.capacity.available_slots===0?"bg-red-500":s.capacity.available_slots===1?"bg-amber-500":"bg-cyan-500"}`,style:{width:`${s.capacity.current_load/s.capacity.max_concurrent*100}%`}})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-blue-400"}),"Claude 会话",e.jsxs("span",{className:`ml-2 px-2 py-0.5 text-xs rounded-full ${s.claude.active_sessions>0?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-gray-400"}`,children:[s.claude.active_sessions," 活跃"]})]}),s.claude.sessions.length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(s.claude.by_repository||{}).map(([a,o])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{to:a!=="other"?`/ops/panorama/repo/${a}`:"#",className:`text-sm font-medium ${a!=="other"?"text-cyan-400 hover:underline":"text-gray-400"}`,children:[a==="other"?"其他":a,e.jsxs("span",{className:"ml-2 text-gray-500",children:["(",o.length,")"]})]}),o.map(l=>e.jsxs("div",{className:`p-4 rounded-lg border ${l.status==="active"?"border-blue-500/30 bg-blue-500/5":"border-slate-700 bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-white",children:l.project})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 font-mono truncate max-w-md",children:l.cwd})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"CPU"}),e.jsxs("div",{className:`text-sm font-medium ${l.cpu>50?"text-amber-400":"text-white"}`,children:[l.cpu.toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-gray-400",children:"内存"}),e.jsxs("div",{className:"text-sm font-medium text-white",children:[l.memory.toFixed(1),"%"]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${l.status==="active"?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-gray-400"}`,children:l.status==="active"?"活跃":"空闲"})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["PID: ",l.pid," · 运行: ",l.runtime]})]},l.pid))]},a))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"没有运行中的 Claude 会话"}),e.jsx("p",{className:"text-sm mt-1",children:"VPS 空闲，可以开始新任务"})]})]}),t&&t.recent_runs.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-purple-400"}),"Cecelia 任务",t.running>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-purple-500/20 text-purple-400 animate-pulse",children:[t.running," 运行中"]})]}),e.jsx("div",{className:"space-y-3",children:t.recent_runs.slice(0,8).map(a=>e.jsx(H,{run:a},a.id))})]})]}),e.jsxs("div",{className:"space-y-6",children:[s&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-400"}),"Docker 容器",e.jsxs("span",{className:"ml-2 text-xs text-gray-400",children:[s.docker.running," 运行中"]})]}),s.docker.containers.length>0?e.jsx("div",{className:"space-y-2",children:s.docker.containers.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a.status.startsWith("Up")?"bg-green-400":"bg-gray-500"}`}),e.jsx("span",{className:"text-sm text-white font-mono",children:a.name})]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.status.replace("Up ","").split(" ")[0]})]},a.name))}):e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(_,{className:"w-8 h-8 mx-auto mb-2 opacity-30"}),e.jsx("p",{className:"text-sm",children:"无容器运行"})]})]}),t&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"任务统计"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"总任务"}),e.jsx("span",{className:"text-white font-medium",children:t.total_runs})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-blue-400",children:"运行中"}),e.jsx("span",{className:"text-white font-medium",children:t.running})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-green-400",children:"已完成"}),e.jsx("span",{className:"text-white font-medium",children:t.completed})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-red-400",children:"失败"}),e.jsx("span",{className:"text-white font-medium",children:t.failed})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"导航"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(m,{to:"/ops/cecelia/runs",className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(b,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"text-white",children:"Cecelia Runs"}),e.jsx(u,{className:"w-4 h-4 text-gray-500 ml-auto"})]}),e.jsxs(m,{to:"/ops/panorama",className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(C,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-white",children:"Dev Panorama"}),e.jsx(u,{className:"w-4 h-4 text-gray-500 ml-auto"})]}),e.jsxs(m,{to:"/ops/cecelia",className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(v,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-white",children:"Cecelia Overview"}),e.jsx(u,{className:"w-4 h-4 text-gray-500 ml-auto"})]}),e.jsxs(m,{to:"/ops/system",className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition-colors",children:[e.jsx(S,{className:"w-5 h-5 text-amber-400"}),e.jsx("span",{className:"text-white",children:"System Status"}),e.jsx(u,{className:"w-4 h-4 text-gray-500 ml-auto"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"w-full flex items-center gap-3 p-3 bg-cyan-600/20 border border-cyan-600/30 rounded-lg hover:bg-cyan-600/30 transition-colors",children:[e.jsx(w,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-white",children:"创建新任务"})]})]})]})]})]}),F&&e.jsx(Q,{onClose:()=>j(!1),onSubmit:U,triggering:R})]})}function H({run:t}){const r={running:{color:"text-blue-400",bg:"bg-blue-500/20",icon:b,label:"运行中"},completed:{color:"text-green-400",bg:"bg-green-500/20",icon:I,label:"已完成"},failed:{color:"text-red-400",bg:"bg-red-500/20",icon:$,label:"失败"},pending:{color:"text-amber-400",bg:"bg-amber-500/20",icon:S,label:"等待中"}},s=r[t.status]||r.pending,n=s.icon,i=t.total_checkpoints>0?Math.round(t.completed_checkpoints/t.total_checkpoints*100):0;return e.jsxs(m,{to:`/ops/cecelia/runs/${t.id}`,className:`block p-4 rounded-lg border transition-colors ${t.status==="running"?"border-blue-500/30 bg-blue-500/5 hover:bg-blue-500/10":"border-slate-700 bg-slate-900/50 hover:bg-slate-800"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-white truncate",children:t.project})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(M,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-400 truncate",children:t.feature_branch})]}),t.current_step&&e.jsxs("div",{className:"text-xs text-cyan-400 mt-2",children:[t.current_step,": ",t.current_action||"处理中..."]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs ${s.bg} ${s.color}`,children:[e.jsx(n,{className:`w-3 h-3 ${t.status==="running"?"animate-spin":""}`}),s.label]}),t.pr_url&&e.jsx("a",{href:t.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:underline",onClick:d=>d.stopPropagation(),children:"查看 PR"})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[e.jsxs("span",{children:["进度 ",t.completed_checkpoints,"/",t.total_checkpoints]}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx("div",{className:"h-1.5 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${t.status==="failed"?"bg-red-500":"bg-cyan-500"}`,style:{width:`${i}%`}})})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:new Date(t.updated_at).toLocaleString("zh-CN")})]})}function Q({onClose:t,onSubmit:r,triggering:s}){const[n,i]=c.useState(""),[d,p]=c.useState(""),g=x=>{x.preventDefault(),n&&d&&r(n,d)};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6 w-full max-w-lg mx-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"创建新任务"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"项目名称"}),e.jsx("input",{type:"text",value:n,onChange:x=>i(x.target.value),placeholder:"例如: cecelia-workspace",className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"PRD 内容"}),e.jsx("textarea",{value:d,onChange:x=>p(x.target.value),placeholder:"描述你要实现的功能...",rows:6,className:"w-full px-3 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500 resize-none"})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"取消"}),e.jsx("button",{type:"submit",disabled:!n||!d||s,className:"flex items-center gap-2 px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50",children:s?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 animate-spin"}),"触发中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4"}),"触发执行"]})})]})]})]})})}export{q as default};
