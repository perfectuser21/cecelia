import{r as l,j as e,R as b,a8 as v,A as k,e as E,H as R,aE as m,aY as T,bu as A,a9 as q,aQ as o,aF as z,C as B,$ as F}from"./index-BhHU9tw7.js";const f=3e3;async function H(){const r=await(await fetch("/api/system/live")).json();if(!r.success)throw new Error(r.error||"Failed to fetch live data");return r.data}function Q(){var j;const[s,r]=l.useState(null),[c,y]=l.useState(!0),[h,g]=l.useState(null),[p,w]=l.useState(null),[d,_]=l.useState(new Set),n=async()=>{try{const t=await H();r(t),g(null),w(new Date)}catch(t){g(t.message)}finally{y(!1)}};l.useEffect(()=>{n();const t=setInterval(n,f);return()=>clearInterval(t)},[]);const S=t=>{_(i=>{const a=new Set(i);return a.has(t)?a.delete(t):a.add(t),a})};if(c&&!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(b,{className:"w-8 h-8 text-emerald-500 animate-spin"})});if(h&&!s)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(v,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",h]}),e.jsx("button",{onClick:n,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const C=t=>t==="ok"?"text-emerald-400":t==="degraded"?"text-amber-400":"text-red-400",D=t=>t==="ok"?"bg-emerald-500/20":t==="degraded"?"bg-amber-500/20":"bg-red-500/20",x=(s==null?void 0:s.tasks.filter(t=>t.status==="in_progress"||t.status==="running"))||[],u=((s==null?void 0:s.governance.assertions.passed)||0)+((s==null?void 0:s.governance.assertions.failed)||0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-emerald-500 to-cyan-600 rounded-xl",children:e.jsx(k,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Live Dashboard"}),e.jsxs("p",{className:"text-gray-400",children:["系统实时状态监控 · ",f/1e3,"秒刷新"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[p&&e.jsxs("span",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4"}),p.toLocaleTimeString("zh-CN")]}),e.jsx("button",{onClick:n,disabled:c,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(b,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-emerald-400"}),e.jsx("span",{className:"font-medium text-white",children:"System Health"})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${D((s==null?void 0:s.health.workspace)||"unavailable")} ${C((s==null?void 0:s.health.workspace)||"unavailable")}`,children:(s==null?void 0:s.health.workspace)||"unavailable"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(s==null?void 0:s.health.brain)==="ok"?"bg-emerald-400":(s==null?void 0:s.health.brain)==="degraded"?"bg-amber-400":"bg-red-400"}`}),e.jsx("span",{className:"text-gray-400",children:"Brain"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(s==null?void 0:s.health.quality)==="ok"?"bg-emerald-400":(s==null?void 0:s.health.quality)==="degraded"?"bg-amber-400":"bg-red-400"}`}),e.jsx("span",{className:"text-gray-400",children:"Quality"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(s==null?void 0:s.health.n8n)==="ok"?"bg-emerald-400":(s==null?void 0:s.health.n8n)==="degraded"?"bg-amber-400":"bg-red-400"}`}),e.jsx("span",{className:"text-gray-400",children:"N8N"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${(s==null?void 0:s.governance.degrade_status)==="normal"?"bg-emerald-400":"bg-amber-400"}`}),e.jsx("span",{className:"text-gray-400",children:"Degrade"})]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-medium text-white",children:"Running Tasks"})]}),e.jsx("span",{className:"text-2xl font-bold text-blue-400",children:x.length})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["总任务: ",(s==null?void 0:s.tasks.length)||0]}),x.length>0&&e.jsx("div",{className:"mt-2 text-xs text-gray-500 truncate",children:(j=x[0])==null?void 0:j.title})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-amber-400"}),e.jsx("span",{className:"font-medium text-white",children:"DLQ & Degrade"})]}),e.jsx("span",{className:`text-2xl font-bold ${(s==null?void 0:s.governance.dlq_count)===0?"text-emerald-400":"text-amber-400"}`,children:(s==null?void 0:s.governance.dlq_count)||0})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["状态: ",(s==null?void 0:s.governance.degrade_status)||"unknown"]}),(s==null?void 0:s.governance.degrade_reason)&&e.jsx("div",{className:"mt-2 text-xs text-amber-400 truncate",children:s.governance.degrade_reason})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-purple-400"}),e.jsx("span",{className:"font-medium text-white",children:"Assertions"})]}),e.jsx("span",{className:`text-2xl font-bold ${(s==null?void 0:s.governance.assertions.failed)===0?"text-emerald-400":"text-red-400"}`,children:(s==null?void 0:s.governance.assertions.failed)||0})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4 text-emerald-400"}),e.jsxs("span",{className:"text-gray-400",children:[(s==null?void 0:s.governance.assertions.passed)||0," passed"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-gray-400",children:[(s==null?void 0:s.governance.assertions.failed)||0," failed"]})]})]}),u>0&&e.jsx("div",{className:"mt-3 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-500",style:{width:`${((s==null?void 0:s.governance.assertions.passed)||0)/u*100}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-blue-400"}),"Recent Tasks",e.jsxs("span",{className:"ml-auto text-sm text-gray-400",children:[(s==null?void 0:s.tasks.length)||0," 个"]})]}),s!=null&&s.tasks&&s.tasks.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.tasks.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white truncate",children:t.title}),t.updated_at&&e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.updated_at).toLocaleString("zh-CN")})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${t.priority==="P0"?"bg-red-500/20 text-red-400":t.priority==="P1"?"bg-amber-500/20 text-amber-400":"bg-slate-700 text-gray-400"}`,children:t.priority}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${t.status==="completed"?"bg-emerald-500/20 text-emerald-400":t.status==="in_progress"||t.status==="running"?"bg-blue-500/20 text-blue-400":"bg-slate-700 text-gray-400"}`,children:t.status})]})]},t.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(m,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"暂无任务"})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-white mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5 text-purple-400"}),"Dev Sessions",e.jsxs("span",{className:"ml-auto text-sm text-gray-400",children:[(s==null?void 0:s.dev_sessions.length)||0," 个"]})]}),s!=null&&s.dev_sessions&&s.dev_sessions.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:s.dev_sessions.map(t=>{var i,a,N;return e.jsxs("div",{className:`rounded-lg border ${t.status==="running"?"border-blue-500/30 bg-blue-500/5":t.status==="completed"?"border-emerald-500/30 bg-emerald-500/5":"border-red-500/30 bg-red-500/5"}`,children:[e.jsxs("div",{className:"p-3 cursor-pointer flex items-center justify-between",onClick:()=>S(t.session_id),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-white truncate",children:t.project})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(o,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-400 truncate",children:t.branch})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${t.status==="running"?"bg-blue-500/20 text-blue-400":t.status==="completed"?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:t.status}),d.has(t.session_id)?e.jsx(B,{className:"w-4 h-4 text-gray-500"}):e.jsx(F,{className:"w-4 h-4 text-gray-500"})]})]}),d.has(t.session_id)&&t.summary&&e.jsx("div",{className:"px-3 pb-3 border-t border-slate-700/50 mt-1 pt-2",children:e.jsxs("div",{className:"text-xs text-gray-400 space-y-1",children:[e.jsxs("div",{children:["时长: ",Math.round(t.summary.duration_ms/1e3/60)," 分钟"]}),e.jsxs("div",{children:["修改文件: ",((i=t.summary.files_modified)==null?void 0:i.length)||0," 个"]}),(a=t.summary.files_modified)==null?void 0:a.slice(0,3).map(($,L)=>e.jsxs("div",{className:"text-xs text-gray-500 pl-2 truncate",children:["· ",$]},L)),((N=t.summary.files_modified)==null?void 0:N.length)>3&&e.jsxs("div",{className:"text-xs text-gray-500 pl-2",children:["... 还有 ",t.summary.files_modified.length-3," 个"]})]})}),!d.has(t.session_id)&&e.jsx("div",{className:"px-3 pb-2 text-xs text-gray-500",children:new Date(t.started_at).toLocaleString("zh-CN")})]},t.session_id)})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(o,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"暂无 Dev Session"})]})]})]}),(s==null?void 0:s.plan.last_plan_id)&&e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-gray-400",children:"最新计划:"}),e.jsx("span",{className:"text-white font-mono",children:s.plan.last_plan_id}),e.jsxs("span",{className:"text-gray-500",children:["(",s.plan.scope,")"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-gray-400",children:["已提交任务: ",e.jsx("span",{className:"text-emerald-400",children:s.plan.committed_count})]}),s.plan.next_run_time&&e.jsxs("span",{className:"text-gray-400",children:["下次运行: ",e.jsx("span",{className:"text-cyan-400",children:new Date(s.plan.next_run_time).toLocaleString("zh-CN")})]})]})]})})]})}export{Q as default};
