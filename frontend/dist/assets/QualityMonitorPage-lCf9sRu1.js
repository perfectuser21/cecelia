import{r as l,j as e,X as Q,t as S,a8 as T,bP as O,F as U,e as M,A as F,aY as q,bQ as _,ac as z,R as B,Y as X,a7 as Y,aZ as J}from"./index-BhHU9tw7.js";function V({runId:t,onClose:h}){var j,w,o;const[s,c]=l.useState(null),[i,n]=l.useState(null),[r,m]=l.useState([]),[x,p]=l.useState(!0),[u,N]=l.useState("summary");return l.useEffect(()=>{if(!t){p(!1);return}(async()=>{p(!0);try{const[g,v,k]=await Promise.all([fetch(`/api/quality/runs/${t}`),fetch(`/api/quality/runs/${t}/result`),fetch(`/api/quality/runs/${t}/evidence`)]);g.ok&&c(await g.json()),v.ok&&n(await v.json()),k.ok&&m(await k.json())}catch(g){console.error("Failed to fetch run details:",g)}finally{p(!1)}})()},[t]),t?e.jsxs("div",{className:"fixed inset-y-0 right-0 w-[600px] bg-slate-800 border-l border-slate-700 shadow-2xl z-50 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:["Run Detail: ",t.slice(0,8),"..."]}),e.jsx("button",{onClick:h,className:"text-slate-400 hover:text-white p-2 rounded-lg hover:bg-slate-700",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-slate-700",children:[e.jsx("button",{onClick:()=>N("summary"),className:`px-6 py-3 text-sm font-medium ${u==="summary"?"text-white border-b-2 border-blue-500":"text-slate-400 hover:text-white"}`,children:"Summary"}),e.jsx("button",{onClick:()=>N("tests"),className:`px-6 py-3 text-sm font-medium ${u==="tests"?"text-white border-b-2 border-blue-500":"text-slate-400 hover:text-white"}`,children:"Tests"}),e.jsx("button",{onClick:()=>N("evidence"),className:`px-6 py-3 text-sm font-medium ${u==="evidence"?"text-white border-b-2 border-blue-500":"text-slate-400 hover:text-white"}`,children:"Evidence"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:x?e.jsx("p",{className:"text-slate-400",children:"Loading..."}):e.jsxs(e.Fragment,{children:[u==="summary"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Intent"}),e.jsx("p",{className:"text-white font-medium",children:s==null?void 0:s.intent})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Source"}),e.jsx("p",{className:"text-white font-medium",children:(s==null?void 0:s.source)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Duration"}),e.jsxs("p",{className:"text-white font-medium",children:[s==null?void 0:s.duration,"s"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Status"}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${(s==null?void 0:s.status)==="completed"?"bg-emerald-900/50 text-emerald-300":"bg-red-900/50 text-red-300"}`,children:s==null?void 0:s.status})]}),(s==null?void 0:s.error)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Error"}),e.jsx("p",{className:"text-red-400 font-mono text-sm",children:s.error})]})]}),u==="tests"&&i&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-emerald-900/20 border border-emerald-700 rounded-lg p-4",children:[e.jsx(S,{className:"w-5 h-5 text-emerald-400 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-emerald-400",children:((j=i.tests)==null?void 0:j.passed)||0}),e.jsx("p",{className:"text-sm text-emerald-300",children:"Passed"})]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-lg p-4",children:[e.jsx(T,{className:"w-5 h-5 text-red-400 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-red-400",children:((w=i.tests)==null?void 0:w.failed)||0}),e.jsx("p",{className:"text-sm text-red-300",children:"Failed"})]}),e.jsxs("div",{className:"bg-yellow-900/20 border border-yellow-700 rounded-lg p-4",children:[e.jsx(O,{className:"w-5 h-5 text-yellow-400 mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:((o=i.tests)==null?void 0:o.skipped)||0}),e.jsx("p",{className:"text-sm text-yellow-300",children:"Skipped"})]})]}),i.skipped_details&&i.skipped_details.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Skipped Details"}),e.jsx("div",{className:"space-y-2",children:i.skipped_details.map((f,g)=>e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[e.jsx("p",{className:"text-white font-medium",children:f.id}),e.jsxs("p",{className:"text-sm text-slate-400 mt-1",children:["Reason: ",f.reason]})]},g))})]})]}),u==="evidence"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3",children:["Evidence Files (",r.length,")"]}),r.length===0?e.jsx("p",{className:"text-slate-400",children:"No evidence files"}):r.map(f=>e.jsxs("a",{href:`/api/quality/runs/${t}/logs/${f}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 bg-slate-700/50 rounded-lg hover:bg-slate-700 transition",children:[e.jsx(U,{className:"w-5 h-5 text-slate-400"}),e.jsx("span",{className:"text-white font-mono text-sm",children:f})]},f))]})]})})]}):null}function Z(){const[t,h]=l.useState([]),[s,c]=l.useState(!0);l.useEffect(()=>{const r=async()=>{try{const x=await fetch("/api/quality/queue");x.ok&&h(await x.json())}catch(x){console.error("Failed to fetch queue:",x)}finally{c(!1)}};r();const m=setInterval(r,5e3);return()=>clearInterval(m)},[]);const i=r=>r<60?`${r}s ago`:r<3600?`${Math.floor(r/60)}m ago`:`${Math.floor(r/3600)}h ago`,n={P0:"bg-red-900/30 border-red-700 text-red-300",P1:"bg-yellow-900/30 border-yellow-700 text-yellow-300",P2:"bg-blue-900/30 border-blue-700 text-blue-300"};return s?e.jsx("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700 p-6",children:e.jsx("p",{className:"text-slate-400",children:"Loading queue..."})}):e.jsxs("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-slate-700 flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold text-white flex items-center gap-2",children:["Task Queue",e.jsxs("span",{className:"text-sm text-slate-400",children:["(",t.length," pending)"]})]})}),t.length===0?e.jsx("div",{className:"p-8 text-center text-slate-400",children:"No pending tasks"}):e.jsx("div",{className:"divide-y divide-slate-700/50",children:t.map(r=>e.jsxs("div",{className:"p-4 hover:bg-slate-700/30 transition",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:`px-2 py-1 text-xs rounded border ${n[r.priority]||n.P2}`,children:r.priority}),e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-900/50 text-blue-300 rounded",children:r.intent}),e.jsx("span",{className:"text-sm text-slate-400",children:r.source})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[e.jsx(M,{className:"w-4 h-4"}),i(r.age)]})]}),e.jsxs("div",{className:"mt-2 text-xs text-slate-500 font-mono",children:[r.taskId.slice(0,16),"..."]})]},r.taskId))})]})}function G(){const[t,h]=l.useState(null);l.useEffect(()=>{const c=async()=>{try{const n=await fetch("/api/quality/worker");n.ok&&h(await n.json())}catch(n){console.error("Failed to fetch worker:",n)}};c();const i=setInterval(c,5e3);return()=>clearInterval(i)},[]);const s=(t==null?void 0:t.status)==="idle";return e.jsxs("div",{className:`${s?"bg-slate-800":"bg-blue-900/30 border border-blue-700"} rounded-lg p-6 text-white`,children:[s?e.jsx(S,{className:"w-8 h-8 mb-2 text-slate-400"}):e.jsx(F,{className:"w-8 h-8 mb-2 text-blue-400 animate-pulse"}),e.jsx("p",{className:"text-sm opacity-90",children:"Worker Status"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:(t==null?void 0:t.status)||"unknown"}),(t==null?void 0:t.currentTask)&&e.jsx("p",{className:"text-xs mt-2 text-blue-300",children:t.currentTask.intent})]})}function K(){const[t,h]=l.useState(0);l.useEffect(()=>{const c=async()=>{try{const n=await fetch("/api/quality/queue");if(n.ok){const r=await n.json();h(r.length)}}catch(n){console.error("Failed to fetch queue:",n)}};c();const i=setInterval(c,5e3);return()=>clearInterval(i)},[]);const s=t>5;return e.jsxs("div",{className:`${s?"bg-red-900/30 border border-red-700":"bg-slate-800"} rounded-lg p-6 text-white`,children:[s?e.jsx(q,{className:"w-8 h-8 mb-2 text-red-400"}):e.jsx(_,{className:"w-8 h-8 mb-2 text-slate-400"}),e.jsx("p",{className:"text-sm opacity-90",children:"Queue Length"}),e.jsx("p",{className:`text-2xl font-bold mt-1 ${s?"text-red-400":""}`,children:t})]})}function E({isOpen:t,title:h,message:s,details:c,confirmText:i,cancelText:n="Cancel",onConfirm:r,onCancel:m,variant:x="warning"}){if(!t)return null;const p={danger:"bg-red-600 hover:bg-red-700",warning:"bg-yellow-600 hover:bg-yellow-700",info:"bg-blue-600 hover:bg-blue-700"};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 shadow-2xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"w-6 h-6 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:h})]}),e.jsx("button",{onClick:m,className:"text-slate-400 hover:text-white p-1 rounded hover:bg-slate-700",children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-slate-300",children:s}),c&&e.jsx("p",{className:"text-sm text-slate-400 bg-slate-900/50 p-3 rounded",children:c}),e.jsx("p",{className:"text-sm text-slate-500",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-700",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-slate-300 hover:text-white rounded-lg hover:bg-slate-700 transition",children:n}),e.jsx("button",{onClick:r,className:`px-4 py-2 text-sm font-medium text-white rounded-lg transition ${p[x]}`,children:i})]})]})})}function ee({onRunQA:t,onSyncNotion:h,onHealthCheck:s,onClearQueue:c,onRestartWorker:i,queueLength:n=0,workerStatus:r="unknown"}){const[m,x]=l.useState(!1),[p,u]=l.useState(!1),N=()=>{x(!1),c()},j=()=>{u(!1),i()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700 p-6 mb-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition font-medium",children:[e.jsx(z,{className:"w-4 h-4"}),"Run QA Now"]}),e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium",children:[e.jsx(B,{className:"w-4 h-4"}),"Sync Notion"]}),e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition font-medium",children:[e.jsx(F,{className:"w-4 h-4"}),"Health Check"]}),e.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition font-medium",children:[e.jsx(X,{className:"w-4 h-4"}),"Clear Queue"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition font-medium",children:[e.jsx(Y,{className:"w-4 h-4"}),"Restart Worker"]})]})]}),e.jsx(E,{isOpen:m,title:"Clear Queue",message:"This will delete all pending tasks in the queue.",details:`Current queue: ${n} tasks`,confirmText:"Clear Queue",onConfirm:N,onCancel:()=>x(!1),variant:"danger"}),e.jsx(E,{isOpen:p,title:"Restart Worker",message:"This will restart the worker process.",details:`Current status: ${r}`,confirmText:"Restart",onConfirm:j,onCancel:()=>u(!1),variant:"warning"})]})}function te({message:t,type:h,onClose:s,duration:c=5e3}){l.useEffect(()=>{if(c>0){const x=setTimeout(s,c);return()=>clearTimeout(x)}},[c,s]);const i={success:{icon:S,bg:"bg-emerald-600",border:"border-emerald-500"},error:{icon:T,bg:"bg-red-600",border:"border-red-500"},warning:{icon:q,bg:"bg-yellow-600",border:"border-yellow-500"},info:{icon:J,bg:"bg-blue-600",border:"border-blue-500"}},{icon:n,bg:r,border:m}=i[h];return e.jsxs("div",{className:`fixed bottom-4 right-4 z-50 ${r} border ${m} rounded-lg shadow-lg p-4 flex items-center gap-3 min-w-[300px] max-w-md`,children:[e.jsx(n,{className:"w-5 h-5 text-white flex-shrink-0"}),e.jsx("p",{className:"text-white text-sm flex-1",children:t}),e.jsx("button",{onClick:s,className:"text-white/80 hover:text-white p-1 rounded hover:bg-white/10 transition flex-shrink-0",children:e.jsx(Q,{className:"w-4 h-4"})})]})}function ae(){var I,A;const[t,h]=l.useState(null),[s,c]=l.useState([]),[i,n]=l.useState(!0),[r,m]=l.useState(null),[x,p]=l.useState(0),[u,N]=l.useState("unknown"),[j,w]=l.useState(null);l.useEffect(()=>{const a=async()=>{try{const[b,y,C,P]=await Promise.all([fetch("/api/quality/state"),fetch("/api/quality/runs?limit=10"),fetch("/api/quality/queue"),fetch("/api/quality/worker")]);if(h(await b.json()),c(await y.json()),C.ok){const R=await C.json();p(R.length)}if(P.ok){const R=await P.json();N(R.status||"unknown")}}catch(b){console.error("Failed to fetch:",b)}finally{n(!1)}};a();const d=setInterval(a,1e4);return()=>clearInterval(d)},[]);const o=(a,d)=>{w({message:a,type:d})},f=async()=>{var a;try{const d=await fetch("/api/quality/trigger/runQA",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priority:"P1",payload:{project:"cecelia-workspace",branch:"develop",triggeredBy:"user"}})}),b=await d.json();d.ok?o(`QA task queued: ${(a=b.taskId)==null?void 0:a.slice(0,8)}`,"success"):o(`Failed to trigger QA: ${b.error||"Unknown error"}`,"error")}catch{o("Failed to trigger QA: Network error","error")}},g=async()=>{try{const a=await fetch("/api/quality/trigger/syncNotion",{method:"POST"}),d=await a.json();a.ok?o("Notion sync task queued","success"):o(`Failed to sync Notion: ${d.error||"Unknown error"}`,"error")}catch{o("Failed to sync Notion: Network error","error")}},v=async()=>{var a,d;try{const b=await fetch("/api/quality/trigger/healthCheck",{method:"POST"}),y=await b.json();if(b.ok){const C=`Worker: ${((a=y.worker)==null?void 0:a.status)||"unknown"}, Queue: ${((d=y.queue)==null?void 0:d.length)||0} tasks`;o(`Health check: ${C}`,"info")}else o(`Health check failed: ${y.error||"Unknown error"}`,"error")}catch{o("Health check failed: Network error","error")}},k=async()=>{try{const a=await fetch("/api/quality/queue/clear",{method:"DELETE"}),d=await a.json();a.ok?(o(`Queue cleared (${d.cleared||0} tasks deleted)`,"success"),p(0)):o(`Failed to clear queue: ${d.error||"Unknown error"}`,"error")}catch{o("Failed to clear queue: Network error","error")}},D=async()=>{try{const a=await fetch("/api/quality/worker/restart",{method:"POST"}),d=await a.json();a.ok?o(`Worker restarted (PID: ${d.pid||"N/A"})`,"success"):o(`Failed to restart worker: ${d.error||"Unknown error"}`,"error")}catch{o("Failed to restart worker: Network error","error")}};if(i)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:e.jsx("p",{className:"text-slate-400",children:"Loading..."})});const L={green:"bg-emerald-500",yellow:"bg-yellow-500",red:"bg-red-500"},W={green:S,yellow:q,red:T},$=(t==null?void 0:t.derivedHealth)||"green",H=W[$];return e.jsxs("div",{className:"min-h-screen -m-8 -mt-8 p-8 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3 mb-8",children:[e.jsx(F,{className:"w-8 h-8 text-slate-400"}),"Cecelia Quality Monitor"]}),e.jsxs("div",{className:"grid grid-cols-5 gap-6 mb-8",children:[e.jsxs("div",{className:`${L[$]} rounded-lg p-6 text-white`,children:[e.jsx(H,{className:"w-8 h-8 mb-2"}),e.jsx("p",{className:"text-sm opacity-90",children:"System Health"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:$})]}),e.jsx(G,{}),e.jsx(K,{}),e.jsxs("div",{className:"bg-emerald-900/30 border border-emerald-700 rounded-lg p-6 text-white",children:[e.jsx("p",{className:"text-sm text-emerald-400",children:"Succeeded"}),e.jsx("p",{className:"text-3xl font-bold mt-2 text-emerald-400",children:((I=t==null?void 0:t.stats)==null?void 0:I.succeeded)||0})]}),e.jsxs("div",{className:"bg-red-900/30 border border-red-700 rounded-lg p-6 text-white",children:[e.jsx("p",{className:"text-sm text-red-400",children:"Failed"}),e.jsx("p",{className:"text-3xl font-bold mt-2 text-red-400",children:((A=t==null?void 0:t.stats)==null?void 0:A.failed)||0})]})]}),e.jsx(ee,{onRunQA:f,onSyncNotion:g,onHealthCheck:v,onClearQueue:k,onRestartWorker:D,queueLength:x,workerStatus:u}),e.jsx(Z,{}),e.jsxs("div",{className:"bg-slate-800/50 rounded-lg border border-slate-700 overflow-hidden mt-8",children:[e.jsx("div",{className:"p-6 border-b border-slate-700",children:e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Recent Runs"})}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Run ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Intent"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Completed"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs text-slate-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700/50",children:s.map(a=>e.jsxs("tr",{className:"hover:bg-slate-700/30",children:[e.jsxs("td",{className:"px-6 py-4 text-sm font-mono text-slate-300",children:[a.runId.slice(0,8),"..."]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-900/50 text-blue-300 rounded",children:a.intent})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${a.status==="completed"?"bg-emerald-900/50 text-emerald-300":"bg-red-900/50 text-red-300"}`,children:a.status})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-300",children:[a.duration,"s"]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-400",children:new Date(a.completedAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>m(a.runId),className:"text-blue-400 hover:text-blue-300 text-sm",children:"View Details"})})]},a.runId))})]})]})]}),e.jsx(V,{runId:r,onClose:()=>m(null)}),j&&e.jsx(te,{message:j.message,type:j.type,onClose:()=>w(null)})]})}export{ae as default};
