import{r as a,j as e,R as v,E as k,aC as D,C as F}from"./index-BhHU9tw7.js";const E="",g={douyin:{name:"抖音",color:"#000000"},kuaishou:{name:"快手",color:"#FF6600"},xiaohongshu:{name:"小红书",color:"#FF2442"},toutiao:{name:"今日头条",color:"#D22828"},weibo:{name:"微博",color:"#E6162D"},channels:{name:"视频号",color:"#07C160"},zhihu:{name:"知乎",color:"#0084FF"},bilibili:{name:"B站",color:"#FB7299"}};function B(){const[r,w]=a.useState([]),[p,j]=a.useState(!0),[u,_]=a.useState(null),[d,S]=a.useState("scraped_at"),[x,y]=a.useState("desc"),[i,C]=a.useState("");a.useEffect(()=>{f()},[]);const f=async()=>{j(!0);try{const t=await(await fetch(`${E}/api/media/raw-scraping-data`)).json();t.success&&w(t.data)}catch(s){console.error("Failed to fetch raw scraping data:",s)}finally{j(!1)}},c=r.filter(s=>!(i&&s.platform!==i)).sort((s,t)=>{const l=s[d],n=t[d];if(l===n)return 0;const N=l>n?1:-1;return x==="asc"?N:-N}),o=s=>{d===s?y(x==="asc"?"desc":"asc"):(S(s),y("desc"))},h=({field:s})=>d!==s?null:x==="asc"?e.jsx(D,{className:"w-3 h-3"}):e.jsx(F,{className:"w-3 h-3"}),b=Array.from(new Set(r.map(s=>s.platform))),m=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-";return p?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(v,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"原始抓取数据"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"raw_scraping_data 表 · 爬虫抓取的最原始数据 · 未经任何处理"})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(v,{className:`w-4 h-4 ${p?"animate-spin":""}`}),"刷新"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"总抓取记录"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"筛选后"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"平台数"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:b.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"已处理"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.filter(s=>s.processed).length})]})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"平台筛选："}),e.jsxs("select",{value:i,onChange:s=>C(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"全部平台"}),b.map(s=>{var t;return e.jsx("option",{value:s,children:((t=g[s])==null?void 0:t.name)||s},s)})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{onClick:()=>o("id"),className:"flex items-center gap-1 font-medium text-gray-700 hover:text-gray-900",children:["ID",e.jsx(h,{field:"id"})]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{onClick:()=>o("platform"),className:"flex items-center gap-1 font-medium text-gray-700 hover:text-gray-900",children:["平台",e.jsx(h,{field:"platform"})]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsxs("button",{onClick:()=>o("scraped_at"),className:"flex items-center gap-1 font-medium text-gray-700 hover:text-gray-900",children:["抓取时间",e.jsx(h,{field:"scraped_at"})]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:"URL"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"原始文本预览"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"处理状态"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:c.map(s=>{var t,l,n;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.id}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-block px-2 py-1 rounded text-white text-xs font-medium",style:{backgroundColor:((t=g[s.platform])==null?void 0:t.color)||"#999"},children:((l=g[s.platform])==null?void 0:l.name)||s.platform})}),e.jsx("td",{className:"px-4 py-3 text-gray-700 text-xs",children:m(s.scraped_at)}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-xs max-w-xs truncate",children:s.url||"-"}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-xs max-w-md",children:e.jsx("div",{className:"truncate",children:((n=s.raw_text)==null?void 0:n.substring(0,100))||"-"})}),e.jsx("td",{className:"px-4 py-3",children:s.processed?e.jsx("span",{className:"inline-block px-2 py-1 bg-green-100 text-green-700 rounded text-xs",children:"已处理"}):e.jsx("span",{className:"inline-block px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs",children:"未处理"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:()=>_(u===s.id?null:s.id),className:"text-blue-600 hover:text-blue-700",children:e.jsx(k,{className:"w-4 h-4"})})})]},s.id),u===s.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-4 bg-gray-50",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"原始文本 (raw_text):"}),e.jsx("pre",{className:"bg-white p-3 rounded border border-gray-200 text-xs overflow-x-auto whitespace-pre-wrap max-h-96",children:s.raw_text})]}),s.metadata&&Object.keys(s.metadata).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"元数据 (metadata):"}),e.jsx("pre",{className:"bg-white p-3 rounded border border-gray-200 text-xs overflow-x-auto",children:JSON.stringify(s.metadata,null,2)})]}),s.browser_info&&Object.keys(s.browser_info).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"浏览器信息 (browser_info):"}),e.jsx("pre",{className:"bg-white p-3 rounded border border-gray-200 text-xs overflow-x-auto",children:JSON.stringify(s.browser_info,null,2)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Scraper版本:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.scraper_version||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"处理时间:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:s.processed_at?m(s.processed_at):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"创建时间:"}),e.jsx("span",{className:"ml-2 text-gray-900",children:m(s.created_at)})]})]}),s.processing_error&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-red-600 mb-2",children:"处理错误:"}),e.jsx("div",{className:"bg-red-50 p-3 rounded border border-red-200 text-xs text-red-700",children:s.processing_error})]})]})})})]})})})]})}),c.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无数据"})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["显示 ",c.length," / ",r.length," 条记录 · 点击眼睛图标查看完整原始数据"]})]})}export{B as default};
