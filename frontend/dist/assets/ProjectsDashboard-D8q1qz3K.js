import{r as l,aU as G,j as e,aO as x,R as M,a9 as U,n as R,aE as y,ao as z,$ as B,e as K}from"./index-BhHU9tw7.js";function O({status:t}){const r=t==="active"?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":t==="completed"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":t==="archived"?"bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-400":"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400";return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${r}`,children:t})}function q({project:t,linkedGoal:r,taskCount:m,activeTaskCount:o}){return e.jsxs(z,{to:`/projects/${t.id}`,className:"block bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4 hover:border-blue-300 dark:hover:border-blue-600 hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(x,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 line-clamp-1",children:t.description})]})]}),e.jsx(B,{className:"w-5 h-5 text-slate-400 group-hover:text-blue-500 transition-colors"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-slate-500 dark:text-slate-400",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsxs("span",{children:[m," tasks"]})]}),o>0&&e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 dark:text-amber-400",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[o," active"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsx(O,{status:t.status}),r&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-violet-600 dark:text-violet-400",children:[e.jsx(R,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"truncate max-w-[150px]",children:r.title})]})]})]})}function J(){const[t,r]=l.useState([]),[m,o]=l.useState([]),[d,T]=l.useState([]),[i,u]=l.useState(!0),[j,S]=l.useState(null),[c,p]=l.useState("all"),k=l.useRef(()=>{}),h=l.useCallback(s=>{(s==="all"||s==="active"||s==="completed")&&p(s)},[]),$=l.useMemo(()=>({refresh:()=>k.current(),setFilter:(s,a)=>h(a),setFilter_status:(s,a)=>h(a)}),[h]),{register:v,unregisterPage:N}=G("projects","Projects Dashboard",()=>t,()=>({filter:c,loading:i}),$,()=>{const s=t.filter(n=>n.status==="active").length,a=t.filter(n=>n.status==="completed").length,g=d.length;return`${t.length} projects (${s} active, ${a} completed), ${g} tasks`});l.useEffect(()=>(v(),()=>N()),[v,N,t,d,c,i]);const b=l.useCallback(async()=>{try{const[s,a,g]=await Promise.all([fetch("/api/tasks/projects"),fetch("/api/tasks/goals"),fetch("/api/tasks/tasks?limit=100")]),[n,A,E]=await Promise.all([s.json(),a.json(),g.json()]);r(n),o(A),T(E),S(new Date)}catch(s){console.error("Failed to fetch data:",s)}finally{u(!1)}},[]);l.useEffect(()=>{b()},[b]);const f=()=>{u(!0),b()};k.current=f;const w=t.filter(s=>c==="all"?!0:c==="active"?s.status==="active":c==="completed"?s.status==="completed":!0),_=s=>{if(s)return m.find(a=>a.id===s)},D=s=>d.filter(a=>a.project_id===s).length,L=s=>d.filter(a=>a.project_id===s&&a.status==="in_progress").length,C=t.filter(s=>s.status==="active").length,P=t.filter(s=>s.status==="completed").length;d.length;const F=d.filter(s=>s.status==="in_progress").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl",children:e.jsx(x,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Projects"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Manage your projects and tasks"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[j&&e.jsxs("span",{className:"text-xs text-slate-400",children:["Last: ",j.toLocaleTimeString("zh-CN")]}),e.jsx("button",{onClick:f,disabled:i,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(M,{className:`w-5 h-5 text-slate-500 ${i?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx(x,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.length}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Total Projects"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:C}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Active"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-100 dark:bg-violet-900/30 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-violet-600 dark:text-violet-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:P}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Completed"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-100 dark:bg-amber-900/30 rounded-lg",children:e.jsx(y,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:F}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Active Tasks"})]})]})})]}),e.jsx("div",{className:"flex items-center gap-2",children:["all","active","completed"].map(s=>e.jsxs("button",{onClick:()=>p(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===s?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),s==="all"&&e.jsxs("span",{className:"ml-1.5 text-xs",children:["(",t.length,")"]}),s==="active"&&e.jsxs("span",{className:"ml-1.5 text-xs",children:["(",C,")"]}),s==="completed"&&e.jsxs("span",{className:"ml-1.5 text-xs",children:["(",P,")"]})]},s))}),i?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-200 dark:bg-slate-700 rounded-lg"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-700 rounded w-2/3 mb-2"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded w-1/2"})]})]}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded w-1/4"})]},s))}):w.length===0?e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl p-8 text-center border border-slate-200 dark:border-slate-700",children:[e.jsx(x,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No projects found"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(s=>e.jsx(q,{project:s,linkedGoal:_(s.goal_id),taskCount:D(s.id),activeTaskCount:L(s.id)},s.id))})]})}export{J as default};
