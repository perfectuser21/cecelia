## PRD - Cortex Strategy Adjustment 生成

**需求来源**: 免疫系统断链修复 - Cortex RCA 不生成策略调整

**当前问题**: Cortex 执行 RCA 分析后，返回的结果中缺少 `strategy_adjustments` 字段，导致 Learning 循环无法应用策略调整

**功能描述**: 
让 Cortex 在 RCA 分析时生成具体的策略调整建议（strategy_adjustments），使 Brain 能够从失败中学习并自动调整系统参数

**实现方案**:

1. **Cortex Prompt 增强**
   - 在 `performRCA()` 的 Opus prompt 中要求生成 strategy_adjustments
   - 明确指定可调整的参数列表（参考 learning.js 的 ADJUSTABLE_PARAMS）
   - 要求输出符合 learning.js 期望的格式

2. **输出格式定义**
   ```javascript
   {
     task_id: 'xxx',
     analysis: '根因分析结果',
     recommended_actions: ['action1', 'action2'],
     learnings: ['learning1', 'learning2'],
     strategy_adjustments: [  // 新增字段
       {
         params: {
           param: 'FAILURE_THRESHOLD',      // 参数名（必须在白名单中）
           new_value: 5,                     // 新值
           current_value: 3,                 // 当前值（可选）
           reason: 'Reduce false positives' // 调整原因（可选）
         }
       }
     ],
     confidence: 0.85
   }
   ```

3. **可调整参数白名单**（已在 learning.js 中定义）
   - `FAILURE_THRESHOLD`: 失败阈值（范围 1-10）
   - `TICK_INTERVAL_MINUTES`: Tick 间隔（范围 1-60）
   - `MAX_CONCURRENT_TASKS`: 最大并发数（范围 1-20）
   - `QUARANTINE_TTL_HOURS`: 隔离 TTL（范围 0.5-48）

4. **Prompt 示例**
   ```
   You are analyzing a failed task. Based on the failure pattern:
   - Task: {task details}
   - Failure history: {history}
   
   Generate strategy_adjustments to prevent similar failures.
   Available parameters you can adjust:
   - FAILURE_THRESHOLD (1-10): Number of failures before quarantine
   - TICK_INTERVAL_MINUTES (1-60): How often to check for new tasks
   - MAX_CONCURRENT_TASKS (1-20): Maximum parallel executions
   - QUARANTINE_TTL_HOURS (0.5-48): Auto-release time for quarantined tasks
   
   Output format:
   {
     "analysis": "...",
     "recommended_actions": [...],
     "learnings": [...],
     "strategy_adjustments": [
       {
         "params": {
           "param": "PARAMETER_NAME",
           "new_value": VALUE,
           "reason": "Why this adjustment helps"
         }
       }
     ]
   }
   ```

5. **Learning 集成**
   - Cortex 生成的 strategy_adjustments 会被 `recordLearnings()` 保存
   - Learning 系统通过 `applyStrategyAdjustments()` 应用这些调整
   - 形成完整的学习闭环：RCA → Strategy → Apply → Monitor

**涉及文件**:
- `brain/src/cortex.js` - 增强 performRCA() prompt 和输出格式
- `brain/src/__tests__/cortex.test.js` - 测试 strategy_adjustments 生成
- `brain/src/learning.js` - 已有 applyStrategyAdjustments()，无需修改

**成功标准**:
- [ ] Cortex performRCA() 返回包含 strategy_adjustments 字段
- [ ] strategy_adjustments 格式符合 learning.js 期望
- [ ] 只调整白名单中的参数
- [ ] 调整值在允许范围内
- [ ] 测试覆盖所有场景（有调整、无调整、参数验证）
- [ ] 所有现有测试通过

**非目标**:
- 不修改 ADJUSTABLE_PARAMS 白名单（已定义好）
- 不修改 applyStrategyAdjustments() 逻辑（已实现）
- 不自动应用调整（需要人工审核）
