---
id: prd-fix-dispatch-null-goalid
version: 1.0.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复 dispatch 跳过 goal_id=null 任务

## 背景

`tick.js` 的 `selectNextDispatchableTask(goalIds)` 使用：
```sql
WHERE t.goal_id = ANY($1)
```
这导致 `goal_id IS NULL` 的任务永远不会被派发，包括：
- 欲望系统（desire/index.js）创建的 research/follow_up 任务
- codex_qa 等系统任务

队列里有 P0 research 任务（desire 创建）静止超过 91 小时，根本原因在此。

## 目标

修改 `selectNextDispatchableTask` 及任务统计查询的 WHERE 子句，
加入 `OR t.goal_id IS NULL`，使孤立任务可以正常参与派发和统计。

## 范围

- `packages/brain/src/tick.js`（2 处 SQL WHERE 子句）
- 版本 patch bump + 同步文件

## 不在范围

- 不改任何其他逻辑
- 不修改 desire 系统
