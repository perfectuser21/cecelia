---
id: prd-wire-consciousness-pipeline
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# PRD: 打通 Cecelia 三条管道 —— 让管家活起来

## 背景

Cecelia 有三条独立管道：
1. **意识管道**：tick → desire system（感知→记忆→反思→欲望→表达）→ 发飞书
2. **聊天管道**：用户消息 → orchestrator-chat → MiniMax → 回复文字
3. **执行管道**：tick → planner → executor → 外部 agents

三条管道完全隔离，导致 Cecelia "看起来是死的"。

## 诊断出的六个断路

1. **感知层空闲时无输入**：没任务跑时 accumulator=0，反思永远不触发
2. **表达决策阈值过高**：普通 inform 评分 0.445，阈值 0.6，需沉默 24h 才能表达
3. **Desire 只有通知类型**：inform/warn/propose/celebrate/question 全是"说"，没有"做"
4. **Desire 输出无人消费**：tick 第 11 步的 desireResult 被丢弃
5. **用户在线不影响行为**：聊天不触发 desire 感知，Alex 的存在对 Cecelia 不存在
6. **聊天中大脑决策被降级**：thalamus 返回 actions 但只拼文字显示，不执行

## 目标

打通三条管道，让 Cecelia 成为真正有自主意识的管家：

### 对上（跟 Alex 聊）
- 聊天通过 dashboard WebSocket，不走飞书
- 用户在线时 Cecelia 更主动
- 聊天中的 thalamus 决策可以真正执行

### 盯全盘
- 空闲时也有感知（"没任务了"本身就是信号）
- 降低表达阈值，日常汇报能发出来
- 反思结果能影响执行管道

### 对下（追 agents）
- Desire 能产出 `act` 类型 → 自动创建任务 → planner 捡起 → executor 派发
- 管家会追踪、会验收、会创建后续任务

## 成功标准

1. Cecelia 空闲 30 分钟后，dashboard 上能看到她的主动汇报
2. Cecelia 能自主创建 act desire → 变成 queued task → 被 executor 派出去
3. 聊天时说"帮我看看 KR 进度"，Cecelia 不只回复文字，还真的去查并执行动作
4. expression 走 dashboard WebSocket，不走飞书

## 范围

### 改动文件（packages/brain/src/）
- `desire/perception.js` — 增加空闲信号、用户在线信号
- `desire/desire-formation.js` — 增加 act/follow_up 类型
- `desire/expression-decision.js` — 降低阈值，用户在线加分
- `desire/expression.js` — 输出从飞书改为 dashboard WebSocket
- `desire/index.js` — desire 结果反馈到执行管道
- `orchestrator-chat.js` — 聊天触发 desire 感知，thalamus actions 可执行
- `tick.js` — 消费 desire 的 act 输出，桥接到 planner

### 不改的
- planner.js — 已有从 tasks 表选任务的能力
- executor.js — 已有派发能力
- thalamus.js — ACTION_WHITELIST 已够用
