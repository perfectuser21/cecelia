---
id: prd-rumination-loop
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

## PRD - 反刍回路（Rumination Loop）

**需求来源**: Cecelia 目前是"反应式管家"：用户说话 → 处理 → 回复 → 停。缺少人类大脑的"后台认知"能力 — 空闲时持续消化知识、关联已有 OKR、主动产生洞察。

**功能描述**: 让 Cecelia 能在空闲时自动消化用户分享的链接/文件/知识，与 OKR 关联后主动告知用户。反刍不是新系统，而是现有 Desire System 的前置增强。洞察写入 memory_stream → 自然触发 Desire 的反思层 → 形成欲望 → 表达给用户。

**涉及文件**:
- 新增: `packages/brain/src/rumination.js` (~150行) — 反刍核心
- 新增: `packages/brain/src/notebook-adapter.js` (~50行) — NotebookLM CLI 适配器
- 新增: `packages/brain/migrations/079_rumination.sql` — learnings 表加 digested 列
- 新增: `packages/brain/src/__tests__/rumination.test.js` — 单元测试
- 修改: `packages/brain/src/tick.js` — 步骤 10.5 插入 runRumination()
- 修改: `packages/brain/src/chat-action-dispatcher.js` — LEARN case 增加 URL 检测 + digested=false
- 修改: `packages/brain/src/model-registry.js` — 新增 rumination agent
- 修改: `packages/brain/src/desire/perception.js` — 新增 undigested_knowledge 信号

**成功标准**:
1. Migration 079 跑通，learnings 表有 digested 列和索引
2. LEARN 聊天记录自动设 digested=false，含 URL 时异步投递 NotebookLM
3. Tick Loop 空闲时执行反刍（每 tick 最多 3 条，每日最多 10 条）
4. 反刍洞察写入 memory_stream，Desire System 自然消费
5. NotebookLM 不可用时反刍照常运行（降级）
6. 所有单元测试通过

**非目标**:
- Dashboard "知识库"页面（Phase 2）
- API 端点 POST /api/brain/ruminate（Phase 2）
- actionable 洞察自动创建 task（Phase 2）
- 每日反刍计数器午夜自动重置（Phase 2）
- 知识归档（Phase 2）
