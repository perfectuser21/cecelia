# PRD - 实现 Progress Ledger inner loop（每步评估进展）

## 需求来源
任务来自 Brain 自动调度。

## 功能描述
创建 progress_ledger 表，记录每个任务执行过程中的步骤进展。在 tick 循环中增加进展评估引擎，检测偏差并自动调整策略。

具体包括：
1. **数据库设计**：创建 `progress_ledger` 表，记录任务执行中的每个步骤
2. **进展记录API**：提供记录任务步骤进展的接口
3. **评估引擎**：在 tick 循环中增加进展评估逻辑，检测任务是否按预期进展
4. **偏差检测**：识别任务执行偏差（超时、失败率高等）
5. **策略调整**：根据偏差自动调整任务优先级或执行策略

## 涉及文件
1. **数据库迁移**：`packages/brain/src/migrations/` - 新增 progress_ledger 表
2. **Brain API**：`packages/brain/src/server.js` - 新增 progress ledger 相关端点
3. **Tick 循环**：`packages/brain/src/tick.js` - 增加进展评估逻辑
4. **Progress 模块**：`packages/brain/src/progress/` - 新建进展管理模块
5. **测试文件**：对应的单元测试文件

## 成功标准
- [ ] progress_ledger 表创建成功，包含任务ID、步骤名称、开始时间、完成时间、状态等字段
- [ ] API 端点可以记录和查询任务步骤进展
- [ ] tick 循环中集成进展评估逻辑，每次 tick 都会检查任务进展
- [ ] 能检测出异常任务（超时、失败率高）
- [ ] 能自动调整异常任务的优先级或执行策略
- [ ] 所有功能有完整的单元测试
- [ ] CI 通过，代码质量检查通过

## 非目标
- 不实现前端界面展示（保留给后续任务）
- 不实现复杂的机器学习预测算法
- 不修改现有任务调度的核心逻辑，只是增加监控和调整功能