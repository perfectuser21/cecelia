---
id: prd-cp-02281400-branch-protect-worktree-check
version: 1.0.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
---

# PRD: branch-protect.sh 加 worktree 检测

## 问题

branch-protect.sh 只检查分支名（cp-*）和 PRD/DoD 文件，
不检查是否在 worktree 中。导致 Claude 可能在主仓库的残留 cp-* 分支上写代码，
污染主仓库状态，在 monorepo 中尤其危险。

## 修复

在 branch-protect.sh 开头加 worktree 检测：
不在 worktree 中 → exit 2 阻止写代码 + 输出清晰错误信息。

## 成功标准

- 在主仓库（非 worktree）写代码 → 被 hook 拦截，输出 [SKILL_REQUIRED: dev]
- 在 worktree 中写代码 → 正常通过，不影响现有流程
