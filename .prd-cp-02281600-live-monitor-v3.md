---
id: prd-live-monitor-v3
version: 1.0.0
created: 2026-02-28
---

# PRD: Live Monitor v3 重设计

## 背景
Live Monitor 当前存在以下问题：
1. HK VPS 状态未显示（数据在 100.86.118.99:3001/api/stats，但未接入）
2. OKR 总览只显示 3 个 area_okr 平铺，没有 Global/Area 分层
3. 活跃项目显示 Task 而非 Project→Initiative 层级
4. 实时 Agents 区块太大，等待队列割裂在底部

## 目标
重设计 Live Monitor 页面，使其真实反映系统状态层级。

## 功能需求

### 1. HK VPS 数据接入
- 在 frontend-proxy.js 添加代理路由：`/api/v1/vps-monitor/hk-stats` → `http://100.86.118.99:3001/api/stats`
- 基础设施栏改为 3 段：[US VPS 指标] | [HK VPS 指标] | [Account Rings]

### 2. OKR 总览重设计
当前数据：
- `area_okr` (parent_id=null): 3条 (Cecelia 质检97%, ZenithJoy 80%, Cecelia 24/7 72%)
- `area_okr` (有parent_id): 2条 (自媒体跑通77%, 自媒体产品化100%)，parent为ZenithJoy
- `kr`: 31条（各area_okr下的Key Results）

新展示方式：
- 左半：**全局汇总** - 显示 N个目标、整体平均进度、活跃KR数量
- 右半：**Area 分组** - 3个顶层area_okr，每个下面显示KR数量和平均进度

### 3. 活跃项目 → Project + Initiative 全宽列表
- API: `/api/tasks/projects` 返回所有项目（type=project/initiative）
- 展示 active/in_progress 的 project，每个project下显示其 active initiative 列表
- 孤儿 initiative（parent project不是active状态）也显示，grouped by parent project名
- 点击 initiative → navigate to `/work`

### 4. Agents + 队列 并排紧凑布局
- 实时 Agents：缩小为 2列紧凑 chip 风格
- 等待队列：从 Agents 内部移出，与 Agents 并排（3列布局）

## 技术方案

### frontend-proxy.js 修改
```js
if (req.url.startsWith('/api/v1/vps-monitor/hk-stats')) {
  // 代理到 HK VPS port 3001
  proxyTo('http://100.86.118.99:3001/api/stats', req, res);
}
```

### LiveMonitorPage.tsx 修改
- 新增 hkVps state + fetch('/api/v1/vps-monitor/hk-stats')
- 重写 infrastructure bar
- 重写 OKR section
- 用新的 ProjectInitiativeList 组件替换 ActiveProjects
- 重写 Agents + Queue 布局

## 成功标准
- HK VPS CPU/RAM/Disk 显示在基础设施栏
- OKR 总览显示全局汇总 + Area 分组（3个area）
- 活跃项目显示 2 个 project + 各自下的 initiative 列表
- 页面布局紧凑，无割裂感
