# DoD - 实现 Suggestion 队列+triage（新 DB 表，定期评估）

## 验收标准

### 数据库和迁移验收
- [ ] suggestions 表已创建，包含必要字段（id, content, priority_score, source, agent_id, status, created_at, updated_at, metadata）
      Test: packages/brain/migrations/087_suggestions_table.sql
- [ ] 迁移脚本可以成功执行且可以回滚
      Test: tests/migrations/087-suggestions.test.js
- [ ] 数据库索引已创建用于查询性能优化
      Test: tests/migrations/087-suggestions.test.js

### API 端点验收
- [ ] POST /api/brain/suggestions 端点可以接收新的 suggestions
      Test: tests/suggestion-api.test.js
- [ ] GET /api/brain/suggestions 端点可以查询 suggestions（支持状态过滤）
      Test: tests/suggestion-api.test.js
- [ ] PUT /api/brain/suggestions/:id/status 端点可以更新 suggestion 状态
      Test: tests/suggestion-api.test.js
- [ ] API 响应格式符合现有约定，包含正确的错误处理
      Test: tests/suggestion-api.test.js

### Triage 逻辑验收
- [ ] triage 算法可以对 suggestions 进行优先级评分（基于源、类型、时效性）
      Test: tests/suggestion-triage.test.js
- [ ] 去重逻辑能识别相似的 suggestions 避免重复处理
      Test: tests/suggestion-triage.test.js
- [ ] triage 结果可以持久化到数据库中
      Test: tests/suggestion-triage.test.js

### Tick 循环集成验收
- [ ] tick 循环能定期处理 suggestions 队列（每个 tick 周期处理）
      Test: tests/tick-suggestion-integration.test.js
- [ ] 处理逻辑不会影响现有的 tick 性能（执行时间控制在合理范围内）
      Test: tests/tick-suggestion-integration.test.js
- [ ] 异常情况下 suggestion 处理失败不会中断整个 tick 循环
      Test: tests/tick-suggestion-integration.test.js

### 事件系统集成验收
- [ ] suggestion 处理结果能通过事件系统发布（suggestion_processed 事件）
      Test: tests/suggestion-events.test.js
- [ ] 事件包含必要的元数据（suggestion_id, action_taken, timestamp）
      Test: tests/suggestion-events.test.js

### 测试验收
- [ ] 所有新功能都有对应的单元测试且覆盖率达到要求
      Test: npm run test
- [ ] npm run qa 通过（包括 lint、test、type check）
      Test: contract:C2-001
- [ ] 集成测试验证端到端流程正常工作
      Test: tests/suggestion-integration.test.js

### 文档和类型验收
- [ ] 新增的 API 端点有 JSDoc 文档
      Test: manual:代码审查确认文档完整性
- [ ] TypeScript 类型定义正确，没有 any 类型
      Test: npm run type-check
- [ ] README 或相关文档更新说明新功能的使用方法
      Test: manual:文档更新确认