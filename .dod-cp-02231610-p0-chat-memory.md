---
id: dod-p0-chat-memory
version: 1.0.0
created: 2026-02-23
updated: 2026-02-23
changelog:
  - 1.0.0: 初始版本
---

# DoD: P0 Cecelia 聊天记忆修复

## 验收清单

- [ ] `chat` 模式下 `loadActiveProfile` 不再直接返回空，而是查询 DB 获取 OKR goals
  - Test: `memory-retriever.test.js` — "chat 模式也应注入 OKR 焦点"
- [ ] `buildMemoryContext({mode:'chat'})` 返回的 block 包含 OKR 信息（goals 非空时）
  - Test: `memory-retriever.test.js` — "mode=chat 时 profile 包含 OKR"
- [ ] goals DB 为空时 chat 模式返回空字符串（不报错）
  - Test: `memory-retriever.test.js` — "chat 模式 goals 为空时返回空字符串"
- [ ] 多轮历史：`handleChat(msg, ctx, messages)` 将 messages 传给 MiniMax API
  - Test: `orchestrator-chat-memory.test.js` 已有测试（PR #465）
- [ ] `buildStatusSummary` 每次对话都调用（无条件）
  - Test: `orchestrator-chat-memory.test.js` 已有测试（PR #465）
- [ ] `npm test` in brain/ 全部通过

## 文件改动

| 文件 | 改动 |
|------|------|
| `brain/src/memory-retriever.js` | 删除 `if (mode === 'chat') return ''` |
| `brain/src/__tests__/memory-retriever.test.js` | 更新 chat 模式相关测试（2 条改 + 1 条新增）|
