---
id: cicd-auto-deploy-dod
version: 1.0.0
created: 2026-02-19
updated: 2026-02-19
changelog:
  - 1.0.0: 初始版本
---

# DoD: CI/CD 自动部署

## 验收清单

| # | 验收标准 | Test | 优先级 |
|---|---------|------|--------|
| 1 | ci.yml 新增 deploy job | YAML 语法检查 + 人工确认 job 存在 | P0 |
| 2 | deploy job 仅在 push to develop 时触发（PR 不触发） | 检查 `if:` 条件包含 `github.event_name == 'push'` | P0 |
| 3 | deploy 依赖 brain-test 和 facts-check 通过（`needs:` 正确） | 检查 `needs:` 字段 | P0 |
| 4 | 使用 DEPLOY_SSH_KEY / DEPLOY_HOST / DEPLOY_USER secrets | 检查 secrets 引用 | P0 |
| 5 | deploy 命令包含 git pull + brain-deploy.sh | 检查 script 内容 | P0 |
| 6 | facts-check 本地通过 | `node scripts/facts-check.mjs` | P1 |
| 7 | check-version-sync 通过 | `bash scripts/check-version-sync.sh` | P1 |
| 8 | YAML 语法有效 | `python3 -c "import yaml; yaml.safe_load(open('.github/workflows/ci.yml'))"` | P0 |

## 非目标

- 不测试实际 SSH 连接（需要生产 secrets，CI 环境无法测试）
- 不修改 deploy.sh 本身
