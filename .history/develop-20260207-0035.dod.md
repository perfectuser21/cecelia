---
id: dod-failure-classification
version: 1.0.0
created: 2026-02-06
updated: 2026-02-06
changelog:
  - 1.0.0: 初始版本
---

# DoD: 失败分类与智能重试机制

QA: 无需独立 QA（L0 脑干纯代码逻辑，无用户界面变更）

## 验收清单

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|-----------|----------|
| 1 | "Spending cap reached resets 11pm" 分类为 BILLING_CAP | `npx vitest run src/__tests__/failure-classification.test.js` | 测试通过 |
| 2 | BILLING_CAP 解析 reset 时间 → next_run_at | `npx vitest run src/__tests__/failure-classification.test.js` | parseResetTime 测试 |
| 3 | BILLING_CAP 触发 billing pause，跳过派发 | `npx vitest run src/__tests__/failure-classification.test.js` | billingPause 测试 |
| 4 | RATE_LIMIT 429 用指数退避 next_run_at | `npx vitest run src/__tests__/failure-classification.test.js` | retryStrategy 测试 |
| 5 | AUTH/RESOURCE 不重试，标记 needs_human_review | `npx vitest run src/__tests__/failure-classification.test.js` | noRetry 测试 |
| 6 | BILLING_CAP/RATE_LIMIT 不升级 alertness | `npx vitest run src/__tests__/failure-classification.test.js` | alertness 测试 |
| 7 | 现有 611 测试不回归 | `cd brain && npx vitest run` | >= 611 pass |
| 8 | DevGate 全绿 | `node scripts/facts-check.mjs && bash scripts/check-version-sync.sh` | 退出码 0 |

## 测试验收

- [ ] `cd brain && npx vitest run src/__tests__/failure-classification.test.js` 新测试全通过
- [ ] `cd brain && npx vitest run` 无回归 (>= 611 pass)
- [ ] `node scripts/facts-check.mjs` 全绿
- [ ] `bash scripts/check-version-sync.sh` 全绿
