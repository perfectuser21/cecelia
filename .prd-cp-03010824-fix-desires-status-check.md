---
id: prd-fix-desires-status-check
version: 1.0.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复 desires_status_check 约束缺少 acted 状态

## 背景

PR #192 修复了 `desires_type_check` 约束，使 act/follow_up 类型欲望可以正常插入。
但随即暴露了另一个 bug：`desires/index.js` 在执行 act/follow_up 欲望后会执行
`UPDATE desires SET status = 'acted'`，而 `desires_status_check` 约束不包含 `'acted'`。

**现象**：Brain 日志报错：
```
[desire] act/follow_up task creation error: new row for relation "desires" violates check constraint "desires_status_check"
```

## 目标

添加 migration 096，将 `desires_status_check` 约束更新为包含 `'acted'` 状态：
`pending`, `expressed`, `expired`, `suppressed`, `acknowledged`, `acted`

## 范围

- 新增 `packages/brain/migrations/096_fix_desires_status_check.sql`
- 更新 `packages/brain/src/selfcheck.js` EXPECTED_SCHEMA_VERSION：095 → 096
- 更新相关测试文件中的 schema 版本断言（3 个文件）
- 更新 DEFINITION.md Brain 版本和 Schema 版本
- 更新版本文件（package.json patch bump）

## 不在范围

- 不改 desire/index.js（代码已正确用 'acted'，是 DB 约束缺失）
- 不改其他任何逻辑代码

## 成功标准

- migration 096 应用后，desires 表可以更新 status 为 'acted'
- facts-check 通过（schema_version=096 与 DEFINITION.md 一致）
- version-sync 通过
- Brain CI 通过
