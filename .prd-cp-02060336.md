---
id: prd-cp-02060336
version: 1.0.0
created: 2026-02-06
updated: 2026-02-06
changelog:
  - 1.0.0: 初始版本
---

# PRD - 实现执行状态实时展示组件

## 背景

任务来自 Brain 自动调度。当 Cecelia Brain 派发任务执行时，需要在 Core 前端实时展示执行状态，让用户能够看到：
- 当前正在执行的任务
- 执行进度（哪个步骤）
- 实时日志输出
- 执行结果

## 目标

在 Core 前端添加实时显示 Cecelia 执行状态的组件，通过 WebSocket 接收后端推送的状态更新。

## 功能描述

### 1. 实时状态展示组件

创建一个可复用的 React 组件，用于展示任务执行状态：

**位置**: `frontend/src/components/execution/ExecutionStatusDisplay.tsx`

**功能**:
- 展示任务基本信息（ID、标题、状态）
- 展示当前执行步骤
- 实时更新日志输出
- 展示执行进度条
- 支持展开/折叠详细日志

### 2. WebSocket 集成

利用现有的 WebSocket 连接接收实时状态：

**订阅事件**:
- `task:started` - 任务开始执行
- `task:step` - 步骤更新
- `task:log` - 日志输出
- `task:completed` - 任务完成
- `task:failed` - 任务失败

### 3. 状态管理

**Store**: `frontend/src/stores/executionStore.ts`

**State**:
```typescript
interface ExecutionState {
  activeExecutions: Map<string, ExecutionStatus>
  logs: Map<string, LogEntry[]>
  isConnected: boolean
}

interface ExecutionStatus {
  taskId: string
  runId: string
  title: string
  status: 'running' | 'completed' | 'failed'
  currentStep: string
  progress: number
  startedAt: Date
  completedAt?: Date
}

interface LogEntry {
  timestamp: Date
  level: 'info' | 'error' | 'warning'
  message: string
}
```

### 4. UI 展示位置

在 Command Center 添加"执行监控"入口：

**路由**: `/command-center/execution-monitor`

**布局**:
- 左侧：活动执行列表
- 右侧：选中执行的详细信息和日志

## 技术方案

### 组件结构

```
components/execution/
├── ExecutionStatusDisplay.tsx   # 主展示组件
├── ExecutionCard.tsx            # 单个执行卡片
├── ExecutionLogs.tsx            # 日志展示
└── ExecutionProgress.tsx        # 进度条
```

### WebSocket 消息格式

后端已通过 `core/routes/websocket.ts` 推送以下格式的消息：

```typescript
{
  type: 'task:step',
  data: {
    runId: string,
    taskId: string,
    step: number,
    stepName: string,
    timestamp: string
  }
}

{
  type: 'task:log',
  data: {
    runId: string,
    taskId: string,
    level: 'info' | 'error' | 'warning',
    message: string,
    timestamp: string
  }
}
```

### API 端点

使用现有的 API：
- `GET /api/brain/runs` - 获取执行历史
- `GET /api/brain/runs/:id` - 获取单个执行详情
- WebSocket `/ws` - 实时状态推送

## 成功标准

- [ ] 创建 ExecutionStatusDisplay 组件及相关子组件
- [ ] 实现 executionStore 状态管理
- [ ] 集成 WebSocket 接收实时状态
- [ ] 在 Command Center 添加执行监控页面
- [ ] 支持展示多个并发执行任务
- [ ] 日志自动滚动到最新
- [ ] 执行完成后显示结果摘要
- [ ] 响应式设计，移动端友好

## 验收清单

1. 启动一个任务执行，能看到实时状态更新
2. 多个任务并发执行时，能分别展示状态
3. 日志实时追加，自动滚动
4. 任务完成后显示最终状态（成功/失败）
5. 断线重连后能恢复状态
6. UI 美观，符合 Core 设计风格

## 技术依赖

- React 18
- Zustand (状态管理)
- 现有 WebSocket 连接
- TailwindCSS (样式)
- Lucide React (图标)

## 参考文件

- `core/routes/websocket.ts` - WebSocket 实现
- `core/routes/brain.ts` - Brain API
- `frontend/src/stores/` - 现有 Store 示例
- `frontend/src/components/CommandCenter/` - 现有页面结构
