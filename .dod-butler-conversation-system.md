---
id: dod-butler-conversation-system
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# DoD: Cecelia "真正管家" 对话系统

## 验收清单

### PR 1: 对话记忆持久化
- [ ] memory-retriever.js: RELEVANT_EVENT_TYPES 包含 orchestrator_chat
- [ ] memory-retriever.js: HALF_LIFE 包含 conversation: 7
- [ ] memory-retriever.js: MODE_WEIGHT 包含 conversation 条目
- [ ] memory-retriever.js: chat 模式时间窗口扩大到 72h
- [ ] memory-retriever.js: loadConversationHistory 函数
- [ ] orchestrator-chat.js: memory_stream expires_at 改为 7 天
- [ ] orchestrator-chat.js: tokenBudget 从 600 提到 1000
- [ ] 测试: memory-retriever-chat.test.js 通过

### PR 2: LLM 意图理解 + 翻译层
- [ ] orchestrator-chat.js: llmParseIntent 函数（callLLM + JSON 解析）
- [ ] orchestrator-chat.js: handleChat 流程改为"先执行后回复"
- [ ] chat-action-dispatcher.js: 接受 llmIntent 参数
- [ ] chat-action-dispatcher.js: LEARN/RESEARCH 意图处理
- [ ] 测试: orchestrator-chat-intent.test.js 通过

### PR 3: OKR/Task 实体链接
- [ ] entity-linker.js: findRelatedGoal + findRelatedProject + linkEntities
- [ ] chat-action-dispatcher.js: 创建时调用 linkEntities
- [ ] 测试: entity-linker.test.js 通过

### PR 4: 用户画像修复
- [ ] user-profile.js: EXTRACT_PROMPT 明确标注角色
- [ ] user-profile.js: conversationText 构建标记角色
- [ ] 测试: user-profile-extraction.test.js 通过

### PR 5: 系统 Prompt 增强
- [ ] orchestrator-chat.js: 重写 MOUTH_SYSTEM_PROMPT

### 通用
- [ ] npm test 在 packages/brain 下通过
- [ ] 无新增 lint 错误
