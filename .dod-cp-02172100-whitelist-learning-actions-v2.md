---
id: dod-cp-02172100-whitelist-learning-actions-v2
version: 1.1.0
created: 2026-02-17
updated: 2026-02-18
changelog:
  - 1.0.0: 初始版本
  - 1.1.0: 添加 Test 映射列，补充 decision-executor handler 测试
---

# DoD: 扩展白名单 - 知识/学习类 Actions (v2)

## 背景

v1 (b2d2cf6) 已实现 3 个 learning Actions 和对应 handler，但缺少 decision-executor.js 的 handler 单元测试。
v2 任务目标：补充这部分测试覆盖。

## 验收清单

- [ ] create_learning handler 单元测试通过（INSERT INTO learnings）
- [ ] update_learning handler 单元测试通过（UPDATE learnings WHERE id）
- [ ] trigger_rca handler 单元测试通过（创建 task_type=analysis 任务）
- [ ] 所有现有测试无回归
- [ ] facts-check 通过

## DoD 验收表格

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|----------|---------|
| 1 | ACTION_WHITELIST 包含 `create_learning`（dangerous=false） | thalamus.test.js: "should include create_learning action with dangerous=false" | npm test |
| 2 | ACTION_WHITELIST 包含 `update_learning`（dangerous=false） | thalamus.test.js: "should include update_learning action with dangerous=false" | npm test |
| 3 | ACTION_WHITELIST 包含 `trigger_rca`（dangerous=false） | thalamus.test.js: "should include trigger_rca action with dangerous=false" | npm test |
| 4 | create_learning handler 执行 INSERT INTO learnings（mock pool.query） | decision-executor.test.js: "should insert learning into DB on create_learning" | npm test |
| 5 | update_learning handler 执行 UPDATE learnings SET WHERE id（mock pool.query） | decision-executor.test.js: "should update learning in DB on update_learning" | npm test |
| 6 | trigger_rca handler 创建 task_type=analysis 任务（mock createTask） | decision-executor.test.js: "should create analysis task on trigger_rca" | npm test |
| 7 | create_learning 缺少 content 时返回 error | decision-executor.test.js: "should return error when create_learning missing content" | npm test |
| 8 | update_learning 缺少 id 时返回 error | decision-executor.test.js: "should return error when update_learning missing id" | npm test |
| 9 | facts-check 通过（action_count=27） | node scripts/facts-check.mjs | CI DevGate |
| 10 | 所有现有测试通过（无回归） | npm test | npm test |
