## PRD - 最后 20% 稳定性硬护栏

**需求来源**: ChatGPT 审查反馈 - 让 Cecelia 能够 24/7 稳定运行

**功能描述**: 实施 6 个关键的自我保护硬护栏，补齐"最后 20%"的稳定性缺口

**详细需求**: 见 `docs/STABILITY_20_PERCENT_CHECKLIST.md`

### 6 个硬护栏

| # | 功能 | 优先级 | 文件变更 |
|---|------|--------|----------|
| 1 | 决策执行事务化 | P0 | decision-executor.js |
| 2 | 系统性 vs 任务性失败分流 | P1 | quarantine.js, tick.js |
| 3 | 事件风暴保护 | P2 | alertness.js, event-bus.js |
| 4 | Alertness 衰减规则 | P1 | alertness.js |
| 5 | 危险动作两阶段提交 | P0 | 007_pending_actions.sql, decision-executor.js, routes.js |
| 6 | LLM 错误分开处理 | P2 | thalamus.js, cortex.js, alertness.js |

### 涉及文件

**新增**：
- `brain/migrations/007_pending_actions.sql` - pending_actions 表

**修改**：
- `brain/src/decision-executor.js` - 事务化 + 危险动作入队
- `brain/src/quarantine.js` - 失败分类
- `brain/src/alertness.js` - 事件积压信号 + 衰减 + 恢复门槛
- `brain/src/tick.js` - 系统性失败时只派发诊断任务
- `brain/src/routes.js` - pending-actions API
- `brain/src/thalamus.js` - LLM 错误分类
- `brain/src/cortex.js` - LLM 错误分类
- `brain/src/selfcheck.js` - EXPECTED_SCHEMA_VERSION = '007'
- `docs/THREE_LAYER_BRAIN_ARCHITECTURE.md` - 添加运行策略章节

**成功标准**:
1. 所有 action 执行在事务中完成，失败时完全回滚
2. 系统性失败自动熔断，只允许诊断任务
3. 事件积压超过 50 触发 ALERT
4. Score 每 10 分钟衰减 20%，系统可自动恢复
5. dangerous=true 的 action 进入待审批队列
6. LLM API 错误和输出错误分别统计，触发不同保护行为
7. 所有测试通过

**非目标**:
- 不修改现有 API 接口签名
- 不改变 Alertness 的 4 级结构
- 不增加新的 LLM 调用
