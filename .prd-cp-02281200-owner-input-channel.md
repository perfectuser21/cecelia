---
id: prd-owner-input-channel
version: 1.0.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
---

# PRD: owner_input 渠道（对话生成 suggestions）（PR-C）

## 背景

当前 `orchestrator-chat.js` 对话结束后只做 `extractAndSaveUserFacts()`（提取长期事实）。用户在对话中表达的意图（"想做 X"、"希望 Y"）不会变成 Brain 的输入信号，直接丢失。

## 目标

对话结束后，fire-and-forget 提取可执行意图 → 创建 suggestion，让 Brain 感知到主人的声音。

## 具体需求

### 1. 新建 `owner-input-extractor.js`（packages/brain/src/）

职责：从用户消息中提取可执行意图，创建 suggestion。

规则：
- 只处理 ACTION_INTENTS（CREATE_TASK/CREATE_PROJECT/CREATE_GOAL/MODIFY/LEARN/RESEARCH/COMMAND）
- 不处理 CHAT/QUERY_STATUS（纯查询不需要 suggestion）
- 调用 `createSuggestion()` with `source='owner_input'`, `suggestion_type='owner_request'`
- 内容：`owner_request: ${message.slice(0, 200)}`
- `agent_id='owner-input-extractor'`
- limit=1：每次对话最多创建 1 个 suggestion（防洪峰）

### 2. 修改 `orchestrator-chat.js`

在步骤 9（`extractAndSaveUserFacts` 后面）添加 fire-and-forget：
```javascript
// ★NEW: 异步提取可执行意图 → suggestions（fire-and-forget）
import { extractSuggestionsFromChat } from './owner-input-extractor.js';
Promise.resolve().then(() =>
  extractSuggestionsFromChat(message, intentType)
).catch(() => {});
```

### 3. 函数签名

```javascript
// owner-input-extractor.js
export async function extractSuggestionsFromChat(message, intentType)
```

## 成功标准

1. ✅ ACTION_INTENTS 类型对话 → 创建 `owner_input` 来源的 suggestion
2. ✅ CHAT/QUERY_STATUS 类型 → 不创建 suggestion
3. ✅ suggestion score > 0.7（已由 PR-A 保证）
4. ✅ 不阻塞对话回复（fire-and-forget）
5. ✅ 所有测试通过
6. ✅ 不改数据库 schema
