---
id: prd-execution-logs-viewer
version: 1.0.0
created: 2026-02-06
updated: 2026-02-06
changelog:
  - 1.0.0: 初始版本
---

# PRD - 执行日志查看页面

## 需求来源

任务来自 Brain 自动调度（Retry），用户需求："添加执行日志流式展示和筛选功能"

## 功能描述

在 Core 前端添加一个执行日志查看页面，用于查看 Cecelia 任务执行的日志输出。主要功能包括：

1. **日志流式展示**：实时显示任务执行日志，类似终端输出
2. **日志筛选**：支持按任务 ID、状态、时间范围等条件筛选
3. **自动滚动**：新日志自动滚动到底部（可选开关）
4. **日志下载**：支持下载完整日志文件
5. **语法高亮**：对日志内容进行适当的语法高亮（错误/警告/信息）

## 涉及文件

**Frontend (React)**:
- `frontend/src/pages/ExecutionLogs/ExecutionLogsPage.tsx` - 新建日志页面
- `frontend/src/components/ExecutionLogs/LogViewer.tsx` - 日志查看器组件
- `frontend/src/components/ExecutionLogs/LogFilters.tsx` - 筛选器组件
- `frontend/src/api/cecelia.ts` - 添加日志 API 调用
- `frontend/src/types/cecelia.ts` - 添加日志相关类型定义

**Backend API**:
- API endpoint: `GET /api/cecelia/runs/:id/logs` - 获取任务日志
- API endpoint: `GET /api/cecelia/runs/:id/logs/stream` - 流式获取日志（WebSocket 或 SSE）
- 可能需要扩展现有的 Brain/Cecelia API

**路由集成**:
- 在 Core 前端路由中添加 `/execution-logs` 路径

## 成功标准

- [ ] 日志页面能够正确获取并展示任务日志
- [ ] 支持实时流式更新（任务运行时日志自动追加）
- [ ] 筛选功能正常工作（任务 ID、状态、时间范围）
- [ ] 自动滚动开关功能正常
- [ ] 日志下载功能正常
- [ ] 日志内容有基本的语法高亮（ERROR/WARN/INFO 不同颜色）
- [ ] UI 美观，符合 Core 前端设计风格
- [ ] 响应式设计（移动端友好）
- [ ] 无控制台错误
- [ ] TypeScript 类型安全

## 非目标

- 不实现日志搜索功能（文本搜索，后续版本）
- 不实现日志导出到云存储（仅本地下载）
- 不实现日志分析/统计功能
- 不实现多任务日志对比功能

## 技术方案

### 数据源

使用 Brain/Cecelia API：
- `/api/cecelia/runs/:id` - 获取任务基本信息
- `/api/cecelia/runs/:id/logs` - 获取日志内容（如果日志存储在数据库）
- 或直接读取文件系统中的日志文件（如 `/tmp/cecelia-<task_id>.log`）

### 更新策略

- **已完成任务**：一次性加载完整日志
- **运行中任务**：使用轮询（2-5 秒间隔）或 WebSocket/SSE 流式更新

### 组件层级

```
ExecutionLogsPage (页面容器)
  ├── LogFilters (筛选器)
  │     ├── 任务 ID 输入
  │     ├── 状态选择器
  │     ├── 时间范围选择器
  │     └── 应用/重置按钮
  ├── LogViewer (日志查看器)
  │     ├── 日志内容区域（虚拟滚动）
  │     ├── 自动滚动开关
  │     └── 下载按钮
  └── EmptyState (无日志时显示)
```

### UI 设计要点

- 使用等宽字体（Monospace）显示日志
- 暗色背景（类似终端风格）
- 日志级别颜色：
  - ERROR/❌: 红色
  - WARN/⚠️: 黄色
  - INFO/✅: 绿色/蓝色
  - DEBUG: 灰色
- 支持虚拟滚动（长日志性能优化）
- 日志行号显示（可选）

## 验收清单

1. 能够选择任务并查看其日志
2. 日志内容正确展示，无乱码
3. 运行中任务的日志能实时更新
4. 筛选条件能正确过滤日志
5. 自动滚动功能正常
6. 日志下载为完整文本文件
7. UI 符合设计规范
8. 无性能问题（长日志也流畅）
9. TypeScript 无类型错误
10. 响应式布局正常
