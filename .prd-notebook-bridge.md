---
id: prd-notebook-bridge
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# NotebookLM Bridge 集成

## 背景

Brain 运行在 `node:20-alpine` Docker 容器中，容器内没有 Python 运行时。
当前 `notebook-adapter.js` 使用 `execFile` 直接调用宿主机的 NotebookLM CLI (`/home/xx/.local/bin/notebooklm`)，
在容器内执行时必然失败（静默降级，不影响反刍，但 NotebookLM 功能完全不可用）。

## 方案

通过已有的 `cecelia-bridge.cjs`（宿主机 Node.js 进程，端口 3457）中转 NotebookLM CLI 调用：

```
容器内 notebook-adapter.js
  → HTTP fetch → localhost:3457/notebook/query
  → cecelia-bridge.cjs（宿主机）
  → execFile notebooklm CLI（宿主机 Python）
  → 返回结果
```

## 变更范围

1. **cecelia-bridge.cjs**（宿主机）— 新增 2 个端点：
   - `POST /notebook/query` — 查询 NotebookLM
   - `POST /notebook/add-source` — 添加源到 NotebookLM

2. **packages/brain/src/notebook-adapter.js**（容器内）— 从 `execFile` 改为 `fetch` 调用 bridge

## 成功标准

- `queryNotebook('some query')` 在容器内能正常返回结果
- `addSource(url)` 在容器内能正常添加源
- NotebookLM CLI 不可用时仍然安全降级（返回 `{ ok: false }`）
- 现有反刍流程不受影响
