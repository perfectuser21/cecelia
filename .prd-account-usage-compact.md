---
id: prd-account-usage-compact
version: 1.0.0
created: 2026-02-27
updated: 2026-02-27
changelog:
  - 1.0.0: 初始版本
---

# PRD: 账号用量 UI Compact + 调度优化

## 背景

AccountUsageCard 占地面积太大，用户希望它和 CPU/RAM/Disk 一样紧凑。
同时 Brain 调度逻辑仅看 five_hour_pct，忽略了 resets_at（重置时间），导致调度不够智能。

## 目标

### 1. UI Compact（Dashboard）

把 `AccountUsageCard` 大卡片改成嵌入「基础设施」那一行的小 Ring，与 CPU/RAM/DISK 同级。

**具体变化**：
- 删除独立的 `AccountUsageCard` 大卡片组件和其 JSX 占位
- 在「基础设施」行的 DISK ring 后面加一条竖线分隔符
- 新增 `AccUsageRings` 内联组件，渲染 3 个小 Ring（ACC1/ACC2/ACC3）
- 每个 Ring 下方显示重置时间（如 `↺19:00`），字体 8px
- 推荐账号（用量最低）的 Ring 用紫色 `#818cf8`（与原来大卡片一致）
- 加载中/出错时静默（不打断基础设施行）

### 2. Brain 调度优化

`selectBestAccount()` 当前仅按 `five_hour_pct` 升序选最低，忽略 resets_at。

**新逻辑**：若某账号将在 ≤30 分钟内重置，视其 `five_hour_pct` 为 0（即该账号很快就满血）。
这样调度器会优先消耗即将重置的账号额度，而不是保留它让别的账号持续消耗。

**例子**：
- acc1: 70%, resets in 10min → 等效 pct=0 → 优先选
- acc2: 5%, resets in 3h → 等效 pct=5 → 次选
- acc3: 90%, resets in 2h → 等效 pct=90 → 不选（若 ≥80% 则跳过）

## 成功标准

1. LiveMonitorPage 不再有独立的大 AccountUsageCard 卡片
2. 基础设施行出现 ACC1/ACC2/ACC3 小 Ring
3. 每个 Ring 下方显示 ↺HH:MM 重置时间
4. 推荐账号 Ring 为紫色
5. Brain selectBestAccount 正确处理即将重置的账号
6. TypeScript 编译无报错
7. Brain tests 通过
