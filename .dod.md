---
id: dod-dual-capacity-model
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

# DoD: 双层容量模型 — 真实 CPU% + 物理/预算分离

## 验收清单

- [ ] D1-1: sampleCpuUsage() 读取 /proc/stat 计算真实 CPU% → cpu-sampler.test.js
- [ ] D1-2: sampleCpuUsage() 第一次调用返回 null（需要两次采样计算 delta）→ cpu-sampler.test.js
- [ ] D1-3: sampleCpuUsage() 第二次调用返回 0-100 整数 → cpu-sampler.test.js
- [ ] D1-4: checkServerResources() cpuPressure 使用真实 CPU%（非 load average）→ cpu-sampler.test.js
- [ ] D1-5: metrics 保留 load_avg_1m 新增 cpu_usage_pct → cpu-sampler.test.js
- [ ] D1-6: /proc/stat 不可读时 graceful fallback → cpu-sampler.test.js
- [ ] D2-1: PHYSICAL_CAPACITY = 基于 CPU/Memory 的自动计算值 → dual-capacity.test.js
- [ ] D2-2: CECELIA_BUDGET_SLOTS 环境变量设置 budget cap → dual-capacity.test.js
- [ ] D2-3: 向后兼容 CECELIA_MAX_SEATS → dual-capacity.test.js
- [ ] D2-4: MAX_SEATS = min(physical, budget) → dual-capacity.test.js
- [ ] D2-5: getBudgetCap() 返回 { budget, physical, effective } → dual-capacity.test.js
- [ ] D2-6: setBudgetCap(n) 运行时修改 budget cap → dual-capacity.test.js
- [ ] D3-1: GET /api/brain/slots 返回双层容量数据 → dual-capacity.test.js
- [ ] D3-2: PUT /api/brain/budget-cap 端点 → dual-capacity.test.js
- [ ] D4-1: selfcheck EXPECTED_SCHEMA_VERSION 保持不变 → selfcheck.test.js
