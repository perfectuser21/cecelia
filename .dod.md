# DoD - M1 Database Connection + Focus Migration

QA: docs/QA-DECISION.md

## 验收标准

### 数据库连接

- [ ] asyncpg 依赖已添加到 requirements.txt
      Test: grep asyncpg requirements.txt
- [ ] Database 类能连接 PostgreSQL
      Test: tests/test_db.py
- [ ] 连接池正常工作（acquire/release）
      Test: tests/test_db.py
- [ ] 能读写 goals 表
      Test: tests/test_db.py
- [ ] 能读写 working_memory 表
      Test: tests/test_db.py

### Focus 迁移

- [ ] select_daily_focus() 函数实现
      Test: tests/test_focus.py
- [ ] 手动覆盖焦点（FOCUS_OVERRIDE_KEY）正常工作
      Test: tests/test_focus.py
- [ ] 自动选择焦点（优先级排序）正常工作
      Test: tests/test_focus.py
- [ ] set_focus_override() 函数实现
      Test: tests/test_focus.py
- [ ] clear_focus_override() 函数实现
      Test: tests/test_focus.py

### API 路由

- [ ] GET /api/brain/focus 返回当前焦点
      Test: tests/test_state_api.py
- [ ] POST /api/brain/focus/set 设置手动焦点
      Test: tests/test_state_api.py
- [ ] POST /api/brain/focus/clear 清除手动焦点
      Test: tests/test_state_api.py

### 测试验收

- [ ] pytest tests/test_db.py 通过
      Test: PYTHONPATH=. pytest tests/test_db.py -v
- [ ] pytest tests/test_focus.py 通过
      Test: PYTHONPATH=. pytest tests/test_focus.py -v
- [ ] pytest tests/test_state_api.py 通过
      Test: PYTHONPATH=. pytest tests/test_state_api.py -v
