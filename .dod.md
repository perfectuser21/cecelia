---
id: dod-phase4-metrics
version: 1.0.0
created: 2026-01-22
updated: 2026-01-22
changelog:
  - 1.0.0: 初始版本
---

# DoD - Phase 4: DevGate Metrics 指标面板

## 验收标准

### 1. 快照 meta 增强
- [x] snapshot-prd-dod.sh 添加 priority 字段
  Test: tests/hooks/metrics.test.ts
- [x] snapshot-prd-dod.sh 添加 title 字段
  Test: tests/hooks/metrics.test.ts
- [x] snapshot-prd-dod.sh 添加 head/merged SHA
  Test: tests/hooks/metrics.test.ts
- [x] Meta 格式：`<!-- pr:N base:X priority:Y head:Z merged:W created:T title:"..." -->`
  Test: tests/hooks/metrics.test.ts

### 2. metrics.sh 入口
- [x] 默认输出本月指标
  Test: tests/hooks/metrics.test.ts
- [x] --month YYYY-MM 指定月份
  Test: tests/hooks/metrics.test.ts
- [x] --since/--until 指定时间范围
  Test: tests/hooks/metrics.test.ts
- [x] --format json 输出 JSON
  Test: tests/hooks/metrics.test.ts

### 3. 核心指标
- [x] P0/P1 PR 数统计
  Test: tests/hooks/metrics.test.ts
- [x] P0/P1 RCI 覆盖率计算
  Test: tests/hooks/metrics.test.ts
- [x] 新增 RCI 数统计
  Test: tests/hooks/metrics.test.ts
- [x] DoD 条目数统计（可选）
  Test: tests/hooks/metrics.test.ts

### 4. Nightly 集成
- [x] nightly.yml 添加 metrics 步骤
  Test: contract:C7-001

### 5. 回归契约更新
- [x] 新增 H4-001（DevGate Metrics）
  Test: manual:rci-review

### 6. 质量验收
- [x] npm run qa 通过
  Test: contract:C2-001
- [x] bash -n 所有 .sh 文件通过
  Test: contract:C3-001
