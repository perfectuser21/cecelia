---
id: dod-model-profile-switch
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: 初始版本
---

# DoD: 模型 Profile 运行时切换系统

## 验收清单

- [ ] D1: loadActiveProfile 从 DB 加载 active profile → model-profile.test.js
- [ ] D2: loadActiveProfile DB 无结果时使用 FALLBACK → model-profile.test.js
- [ ] D3: loadActiveProfile DB 错误时使用 FALLBACK → model-profile.test.js
- [ ] D4: getActiveProfile 未加载返回 FALLBACK → model-profile.test.js
- [ ] D5: getActiveProfile 加载后返回缓存 → model-profile.test.js
- [ ] D6: switchProfile 事务安全切换 → model-profile.test.js
- [ ] D7: switchProfile 不存在 profile 报错 → model-profile.test.js
- [ ] D8: switchProfile 事务失败 ROLLBACK → model-profile.test.js
- [ ] D9: listProfiles 列出所有 profile → model-profile.test.js
- [ ] D10: FALLBACK_PROFILE 三层配置完整 → model-profile.test.js
- [ ] D11: executor model_map 覆盖所有 task_type → model-profile.test.js
- [ ] D12: _resetProfileCache 重置缓存 → model-profile.test.js
- [ ] D13a: executor MiniMax profile → minimax provider → model-profile-dispatch.test.js
- [ ] D13b: executor Anthropic profile → anthropic provider → model-profile-dispatch.test.js
- [ ] D13c: codex_qa 固定 openai → model-profile-dispatch.test.js
- [ ] D13d: getModelForTask 返回 profile 模型 → model-profile-dispatch.test.js
- [ ] D13e: codex_qa getModelForTask 返回 null → model-profile-dispatch.test.js
- [ ] D14a: thalamus MiniMax profile → callThalamLLM → model-profile-dispatch.test.js
- [ ] D14b: thalamus Anthropic profile → callHaiku → model-profile-dispatch.test.js
- [ ] D15a: cortex profile 指定 opus → model-profile-dispatch.test.js
- [ ] D15b: cortex profile 指定 sonnet → model-profile-dispatch.test.js
- [ ] D16: 所有现有测试通过（零回归）→ vitest run
