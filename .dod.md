---
id: dod-concurrency-optimization
version: 1.0.0
created: 2026-02-01
prd: .prd-concurrency-optimization.md
---

# Definition of Done - 并发配置优化和清理

## 功能验收

### 1. 并发配置统一
- [ ] `.env` 包含 `CECELIA_MAX_CONCURRENT=5`
- [ ] `.env` 包含 `MAX_CONCURRENT=5`
- [ ] `.env.docker` 配置一致（`CECELIA_MAX_CONCURRENT=5`）
- [ ] `.env.docker` 移除废弃变量 `MAX_CONCURRENT_TASKS`

### 2. 环境变量清理
- [ ] 合并 `.env.example` 和 `brain/.env.example` 到统一的 `.env.example`
- [ ] 删除 `brain/.env.example`
- [ ] `.env.example` 包含完整配置（Brain + Intelligence）

### 3. 文档更新
- [ ] `README.md` 明确说明启动方式（手动为主，Docker 可选）
- [ ] `DOCKER.md` 标记为"可选部署方式"
- [ ] 快速开始指南清晰准确

## 功能验证

### 4. 配置生效验证
- [ ] Brain 服务重启后读取 `CECELIA_MAX_CONCURRENT=5`
- [ ] `curl http://localhost:5221/api/brain/tick/status | jq .max_concurrent` 返回 5
- [ ] `/tmp/cecelia-locks/` 最多 5 个锁文件

### 5. 服务健康检查
- [ ] Intelligence Service (5220) 正常运行
- [ ] Node Brain (5221) 正常运行
- [ ] Tick 循环正常工作（`enabled=true`, `loop_running=true`）
- [ ] Circuit Breaker 正常工作

## 性能验证

### 6. 资源监控（可选，5 个并发任务时）
- [ ] CPU Load < 6.4（80% 阈值）
- [ ] 可用内存 > 3GB（20% 阈值）
- [ ] Swap 使用 < 50%

## 回归验证

### 7. 现有功能不受影响
- [ ] Tick 循环正常运行
- [ ] 任务派发和执行正常
- [ ] 数据库连接正常
- [ ] 现有环境变量保持有效

## 清理确认

### 8. 文件清理
- [ ] 临时文件已删除或归档
- [ ] 无遗留的 `.env.example.new` 等临时文件
- [ ] Git 状态干净（只有预期的修改）

## 风险缓解

- 保留原配置的备份（如需回滚）
- 所有修改通过 PR 审查
- CI 通过后再合并

## 参考

**QA**: docs/QA-DECISION.md
**Audit**: docs/AUDIT-REPORT.md
