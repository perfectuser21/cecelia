# DoD - 免疫系统完整连接

## 验收标准

### 功能验收

#### 1. Feature Tick 自动运行
- [ ] server.js 启动时调用 startFeatureTick()
      Test: brain/src/__tests__/server-startup.test.js
- [ ] Feature Tick 每 30 秒自动执行
      Test: brain/src/__tests__/feature-tick.test.js
- [ ] 通过日志或 API 可验证 Feature Tick 在运行
      Test: manual:查看日志或调用 /api/brain/features

#### 2. 策略调整效果监控
- [ ] Migration 016 创建 strategy_effectiveness 表
      Test: brain/src/__tests__/migration-016.test.js
- [ ] evaluateStrategyEffectiveness() 函数正确计算成功率
      Test: brain/src/__tests__/learning-effectiveness.test.js
- [ ] 策略调整后自动评估并记录效果
      Test: brain/src/__tests__/learning-effectiveness.test.js
- [ ] is_effective 字段正确判断（成功率提升 >5%）
      Test: brain/src/__tests__/learning-effectiveness.test.js

#### 3. Quality Feedback 循环
- [ ] cortex_analyses 表添加 user_feedback, reoccurrence_count 等列
      Test: brain/src/__tests__/migration-016.test.js
- [ ] recordQualityFeedback() 函数正确保存反馈
      Test: brain/src/__tests__/cortex-quality-feedback.test.js
- [ ] updateEffectivenessScore() 基于反馈和重现率更新分数
      Test: brain/src/__tests__/cortex-quality-feedback.test.js
- [ ] effectiveness 分数计算公式正确（5星=40分，重现惩罚）
      Test: brain/src/__tests__/cortex-quality-feedback.test.js

#### 4. API 端点
- [ ] POST /api/brain/cortex/feedback 接收反馈
      Test: manual:使用 curl 测试
- [ ] POST /api/brain/learning/evaluate-strategy 评估策略
      Test: manual:使用 curl 测试
- [ ] API 端点返回预期数据结构
      Test: manual:使用 curl 测试

### 代码质量验收
- [ ] 所有新增函数有 JSDoc 注释
      Test: manual:代码审查
- [ ] 所有新增代码通过 ESLint 检查
      Test: contract:C2-001
- [ ] 所有新增 SQL 遵循 migration 规范
      Test: manual:代码审查

### 测试验收
- [ ] Migration 016 测试通过（表结构、列定义）
      Test: brain/src/__tests__/migration-016.test.js
- [ ] Learning effectiveness 测试通过（8+ tests）
      Test: brain/src/__tests__/learning-effectiveness.test.js
- [ ] Cortex quality feedback 测试通过（8+ tests）
      Test: brain/src/__tests__/cortex-quality-feedback.test.js
- [ ] Feature Tick 启动测试通过
      Test: brain/src/__tests__/feature-tick.test.js
- [ ] 所有现有测试仍然通过（802 tests）
      Test: contract:C2-001

### 文档验收
- [ ] EXPECTED_SCHEMA_VERSION 更新为 '016'
      Test: brain/src/__tests__/selfcheck.test.js
- [ ] DEFINITION.md 更新版本号和 schema 版本
      Test: contract:C3-001
- [ ] LEARNINGS.md 记录开发经验
      Test: manual:文档审查

### 版本同步验收
- [ ] brain/package.json 版本 1.21.0 → 1.22.0
      Test: contract:C3-001
- [ ] brain/package-lock.json 版本同步
      Test: contract:C3-001
- [ ] .brain-versions 版本同步
      Test: contract:C3-001
- [ ] brain/VERSION 文件同步
      Test: contract:C3-001
