---
id: dod-planner-content-aware-score
version: 1.0.0
created: 2026-02-18
updated: 2026-02-18
changelog:
  - 1.0.0: 初始版本
---

# DoD: planner.js 内容感知排序

## 验收清单

- [ ] planner.js 增加 applyContentAwareScore() 函数
  - Test: planner-content-aware.test.js "applyContentAwareScore is a function"
- [ ] exploratory task 评分 +10
  - Test: planner-content-aware.test.js "exploratory task gets +10 bonus"
- [ ] wait_for_exploratory=true dev task 评分 -20
  - Test: planner-content-aware.test.js "dev task with wait_for_exploratory gets -20 penalty"
- [ ] decomposition_mode=known dev task 评分 +5
  - Test: planner-content-aware.test.js "dev task with decomposition_mode=known gets +5 bonus"
- [ ] 无 payload 的 task 不受影响（bonus=0）
  - Test: planner-content-aware.test.js "task without payload gets 0 bonus"
- [ ] 可观测性日志（debug 级别）包含 content-aware scores
  - Test: planner-content-aware.test.js "logs content-aware scores at debug level"
- [ ] node scripts/facts-check.mjs 全通过（无 FAIL）
- [ ] bash scripts/check-version-sync.sh 全通过
- [ ] 所有现有测试通过（无回归）：npm test
- [ ] version bump patch

## Test 映射

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|-----------|---------|
| 1 | applyContentAwareScore 函数存在 | brain/src/__tests__/planner-content-aware.test.js - applyContentAwareScore is a function | 单元测试 |
| 2 | exploratory task +10 bonus | brain/src/__tests__/planner-content-aware.test.js - exploratory task gets +10 bonus | 单元测试 |
| 3 | wait_for_exploratory -20 penalty | brain/src/__tests__/planner-content-aware.test.js - dev task with wait_for_exploratory gets -20 penalty | 单元测试 |
| 4 | decomposition_mode=known +5 bonus | brain/src/__tests__/planner-content-aware.test.js - dev task with decomposition_mode=known gets +5 bonus | 单元测试 |
| 5 | 无 payload task bonus=0 | brain/src/__tests__/planner-content-aware.test.js - task without payload gets 0 bonus | 单元测试 |
