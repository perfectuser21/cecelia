# DoD - 任务执行状态零漂移

QA: docs/QA-DECISION.md

## 验收标准

### 功能验收
- [ ] 每次 tick 主动验证所有 in_progress 任务的进程是否存活（通过 run_id 匹配系统进程）
      Test: brain/tests/liveness-probe.test.js
- [ ] 探测到进程死亡后标记 suspect，下次 tick 确认后才标 failed（双次确认避免误判）
      Test: brain/tests/liveness-probe.test.js
- [ ] Brain 启动时扫描所有 in_progress 任务，无匹配进程的标记 failed（orphan_detected）
      Test: brain/tests/startup-sync.test.js
- [ ] execution-callback 处理在 DB 事务内完成，removeActiveProcess 与 status update 原子执行
      Test: brain/tests/callback-atomic.test.js
- [ ] POST /api/brain/heartbeat 端点接收 task_id + run_id，更新 last_heartbeat
      Test: brain/tests/heartbeat.test.js

### 测试验收
- [ ] vitest run 通过
      Test: contract:LIVENESS-001, SYNC-001, CALLBACK-001
