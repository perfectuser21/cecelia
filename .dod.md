# Definition of Done - Worker 可观测性增强

基于 PRD: Worker 可观测性增强

---

## 验收标准

### 1. Worker 时间记录

- [ ] worker.sh 记录 startedAt（ISO 8601 格式）
- [ ] worker.sh 计算 duration（秒）
- [ ] summary.json 包含 startedAt 字段
- [ ] summary.json 包含 duration 字段

### 2. 错误记录

- [ ] worker.sh 捕获执行错误
- [ ] summary.json 包含 error 字段（成功时为 null）
- [ ] 失败的 run 在 summary.json 中记录错误详情

### 3. State 动态更新

- [ ] worker.sh 更新 state.json 时刷新 updatedAt
- [ ] updatedAt 使用当前时间（ISO 8601 格式）
- [ ] 每次 run 完成都会更新 updatedAt

### 4. Evidence 记录

- [ ] summary.json 包含 evidence 数组
- [ ] evidence 列出该 run 产生的所有文件
- [ ] 至少包含基础文件：task.json, result.json

### 5. QA Result 详情

- [ ] orchestrator/qa-run.sh 产生详细 test results
- [ ] result.json 包含 tests.total
- [ ] result.json 包含 tests.passed
- [ ] result.json 包含 tests.failed
- [ ] result.json 包含 tests.skipped
- [ ] result.json 包含 tests.skipped_details 数组（id + reason）

---

## 验收测试

手动运行：
```bash
# 1. 清理旧数据
rm -rf runs/* queue/queue.jsonl

# 2. 入队测试任务
bash gateway/gateway.sh add system runQA P0 '{}'

# 3. 执行 worker
bash worker/worker.sh

# 4. 验证数据
cat state/state.json | jq '.updatedAt'
cat runs/*/summary.json | jq '{startedAt, duration, error, evidence}'
cat runs/*/result.json | jq '.tests'
```

预期结果：
- state.json 的 updatedAt 是最近时间
- summary.json 包含所有 5 个字段
- result.json 包含 tests 对象及 skipped_details
