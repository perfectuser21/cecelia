# DoD - 修复 decisions 表 schema 不匹配

QA: 无需独立 QA（DB schema 修复 + selfcheck 版本更新）

## 验收清单

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|-----------|----------|
| 1 | decisions 表新增 trigger 列 | manual:psql `\d decisions` 含 trigger | DB schema |
| 2 | decisions 表新增 context (jsonb) 列 | manual:psql `\d decisions` 含 context | DB schema |
| 3 | decisions 表新增 actions (jsonb) 列 | manual:psql `\d decisions` 含 actions | DB schema |
| 4 | decisions 表新增 confidence (numeric) 列 | manual:psql `\d decisions` 含 confidence | DB schema |
| 5 | decisions 表新增 executed_at 列 | manual:psql `\d decisions` 含 executed_at | DB schema |
| 6 | 旧 NOT NULL 列 (category, topic, decision) 改为 nullable | manual:psql `\d decisions` 显示 nullable | DB schema |
| 7 | 现有 3 条战略决策数据保留 | manual:psql `SELECT count(*) FROM decisions` = 3 | 数据完整 |
| 8 | schema_version 升级到 009 | `psql SELECT version FROM schema_version` | DB 版本 |
| 9 | selfcheck EXPECTED_SCHEMA_VERSION = '009' | `grep EXPECTED_SCHEMA_VERSION brain/src/selfcheck.js` | 代码同步 |
| 10 | Brain 测试不回归 | `cd brain && npx vitest run` | 通过 |
| 11 | DevGate 全绿 | `node scripts/facts-check.mjs && bash scripts/check-version-sync.sh` | 退出码 0 |

## 测试验收

- [ ] 迁移脚本执行无报错
- [ ] `cd brain && npx vitest run` 无回归
- [ ] `node scripts/facts-check.mjs` 全绿
- [ ] `bash scripts/check-version-sync.sh` 全绿
