# DoD - Cortex Quality Assessment System

## 验收标准

### 数据库变更
- [ ] Migration 015 创建成功，包含所有新列和表
      Test: brain/src/__tests__/migration-015.test.js
- [ ] cortex_analyses 表增加 4 个新列（quality_score, quality_dimensions, similarity_hash, duplicate_of）
      Test: brain/src/__tests__/migration-015.test.js
- [ ] cortex_quality_reports 表创建成功
      Test: brain/src/__tests__/migration-015.test.js
- [ ] strategy_adoptions 表创建成功
      Test: brain/src/__tests__/migration-015.test.js

### 质量评估功能
- [ ] evaluateQualityInitial() 正确计算质量分数（100 分制）
      Test: brain/src/__tests__/cortex-quality.test.js
- [ ] 完整性维度计算正确（30 分）
      Test: brain/src/__tests__/cortex-quality.test.js
- [ ] 时效性维度计算正确（15 分）
      Test: brain/src/__tests__/cortex-quality.test.js
- [ ] 独特性维度计算正确（15 分）
      Test: brain/src/__tests__/cortex-quality.test.js

### 相似度检测
- [ ] generateSimilarityHash() 生成 SHA256 哈希值
      Test: brain/src/__tests__/cortex-quality.test.js
- [ ] checkShouldCreateRCA() 检测到 >80% 相似度时返回 should_create=false
      Test: brain/src/__tests__/cortex-quality.test.js
- [ ] 相似度 <80% 时允许创建新 RCA
      Test: brain/src/__tests__/cortex-quality.test.js

### Cortex 集成
- [ ] performRCA() 调用 checkShouldCreateRCA() 检查重复
      Test: brain/src/__tests__/cortex.test.js
- [ ] saveCortexAnalysis() 生成 similarity_hash 并保存
      Test: brain/src/__tests__/cortex-memory.test.js
- [ ] 质量评估异步触发（fire-and-forget）
      Test: brain/src/__tests__/cortex-quality.test.js

### API 端点
- [ ] POST /api/brain/cortex/evaluate-quality 返回质量评估结果
      Test: manual:使用 curl 测试
- [ ] POST /api/brain/cortex/check-similarity 返回相似度检查结果
      Test: manual:使用 curl 测试
- [ ] GET /api/brain/cortex/quality-stats 返回质量统计数据
      Test: manual:使用 curl 测试

### 版本同步
- [ ] package.json 版本升级到 1.21.0
      Test: contract:C1-001
- [ ] .brain-versions 同步到 1.21.0
      Test: contract:C1-001
- [ ] DEFINITION.md 中 Brain 版本更新到 1.21.0
      Test: scripts/facts-check.mjs
- [ ] selfcheck.js 中 EXPECTED_SCHEMA_VERSION 更新到 '015'
      Test: brain/src/__tests__/selfcheck.test.js

### 测试验收
- [ ] 所有新增测试通过（19 个测试）
      Test: contract:C2-001
- [ ] 现有测试不被破坏（783 个测试保持通过）
      Test: contract:C2-001
- [ ] Facts check 通过（无版本/schema 不一致）
      Test: scripts/facts-check.mjs
