---
id: cleanup-legacy-tables-dod
version: 1.1.0
created: 2026-01-30
updated: 2026-01-30
changelog:
  - 1.1.0: 标记已完成的清理工作
  - 1.0.0: 初始版本
---

# DoD: 清理旧表，完成数据统一

## 验收清单

### 删除旧表（orchestrator_* 系列）
- [x] 删除 orchestrator_tasks 表创建代码 → 改用 tasks 表
- [x] 删除 orchestrator_runs 表创建代码 → 改用 tasks 表 (task = run)
- [x] 删除 orchestrator_workers 表创建代码 → 改用 seats (动态)
- [ ] trds 表 → 保留（未来迁移到 Project.trd_content）

### API 重构
- [ ] /trd 端点改用 projects 表 → 保留当前实现（未来迁移）
- [x] /tasks 端点改用 tasks 表 ✓
- [x] /runs 端点改用 tasks 表 (run = task) ✓
- [x] /workers 端点改用 seats ✓
- [x] 保留 /seats 和 /resources ✓

### 验证
- [x] orchestrator_* 表代码已删除
- [x] API 正常工作 (Import OK)
- [ ] 集成测试通过

## 改动清单

1. `ensure_tables()` - 删除 orchestrator_* 表创建，保留统一表扩展
2. `_save_run()` - 改为更新 tasks 表的执行字段
3. `/runs` endpoints - 改为查询 tasks 表 (run_id 字段)
4. `/workers` endpoints - 改为使用 executor.get_seats()
5. `tick()` - 从 tasks 表派生 runs 信息
6. `/summary` - 使用 seats 替代 workers 统计
