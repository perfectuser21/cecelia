---
id: dedup-drain-dod
version: 1.0.0
created: 2026-02-07
updated: 2026-02-07
changelog:
  - 1.0.0: 初始版本
---

# DoD - Task dedup + Graceful drain mode

## 验收标准

### 功能验收

- [ ] createTask() 精确匹配去重：同 title + goal_id + project_id 不创建重复
      Test: brain/src/__tests__/actions-dedup.test.js
- [ ] createTask() 去重返回 deduplicated: true 标志
      Test: brain/src/__tests__/actions-dedup.test.js
- [ ] createTask() 允许不同 title/goal_id 创建
      Test: brain/src/__tests__/actions-dedup.test.js
- [ ] createTask() 24h 后允许重新创建
      Test: brain/src/__tests__/actions-dedup.test.js
- [ ] drain 模式启动后 dispatchNextTask 跳过派发
      Test: brain/src/__tests__/tick-drain.test.js
- [ ] drain 状态查询返回 in_progress 任务列表
      Test: brain/src/__tests__/tick-drain.test.js
- [ ] cancel drain 恢复正常派发
      Test: brain/src/__tests__/tick-drain.test.js
- [ ] drain 完成后自动停止 tick
      Test: brain/src/__tests__/tick-drain.test.js

### 测试验收

- [ ] npm run qa 通过
      Test: contract:C2-001
- [ ] 全量测试不回归
      Test: cd brain && npx vitest run
- [ ] DevGate 全绿
      Test: node scripts/facts-check.mjs && bash scripts/check-version-sync.sh
