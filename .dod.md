---
id: dod-quickroute-task-events
version: 1.0.0
created: 2026-02-17
updated: 2026-02-17
changelog:
  - 1.0.0: 初始版本
---

# DoD: 扩展 quickRoute - 任务状态类事件

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|----------|-----------|---------|
| 1 | quickRoute 对 TASK_FAILED（无复杂原因/重试次数未超限）返回 retry_task action | thalamus.test.js: "should retry task on simple task failed (no complex reason)" | vitest 单元测试 |
| 2 | quickRoute 对 TASK_FAILED（有复杂原因/重试次数超限）返回 null（交给 Sonnet） | thalamus.test.js: "should return null for task failed with complex reason (needs Sonnet)" | vitest 单元测试 |
| 3 | quickRoute 对 TASK_FAILED（重试次数超限）返回 null | thalamus.test.js: "should return null for task failed when retry exceeded (needs Sonnet)" | vitest 单元测试 |
| 4 | quickRoute 对 TASK_TIMEOUT 返回 log_event + retry_task（降级重试） | thalamus.test.js: "should log and retry on task timeout" | vitest 单元测试 |
| 5 | quickRoute 对 TASK_CREATED 返回 no_action（事件驱动下游消费） | thalamus.test.js: "should return no_action for task created event" | vitest 单元测试 |
| 6 | 现有测试（TASK_FAILED null 基础测试）更新为 simple 场景验证 | thalamus.test.js: 更新现有 "should return null for task failed" | vitest 单元测试 |
| 7 | 不破坏现有 quickRoute 测试（heartbeat/tick/task_completed） | thalamus.test.js: 现有测试通过 | vitest 全量测试 |
| 8 | facts-check 通过（action_count 更新） | node scripts/facts-check.mjs | 自动化检查 |
| 9 | 所有现有测试通过（无回归） | npm test | vitest 全量测试 |
