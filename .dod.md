---
id: fix-dept-heartbeat-dispatch-dod
version: 1.0.0
created: 2026-02-23
updated: 2026-02-23
changelog:
  - 1.0.0: 初始版本（覆盖旧 migration-070 DoD）
---

# DoD: dept-heartbeat dispatch 两处修复

- [ ] dept-heartbeat.js 导出 `lookupDeptPrimaryGoal(pool, dept_name)` 函数
  - Test: 单元测试调用该函数，返回 goal_id 或 null
- [ ] createDeptHeartbeatTask INSERT 包含 `description` 字段
  - Test: 捕获 INSERT SQL，含 description 列及对应参数
- [ ] createDeptHeartbeatTask INSERT 包含 `goal_id` 字段（从 lookupDeptPrimaryGoal 获取）
  - Test: 当 goals 表有匹配时，goal_id = 查询结果；无匹配时为 null
- [ ] pre-flight-check.js 对 dept_heartbeat 任务跳过 description 检查
  - Test: dept_heartbeat task 无 description 时 preFlightCheck 通过
- [ ] pre-flight-check.js 对 codex_qa / initiative_verify 同样豁免
  - Test: 对应任务类型无 description 时 preFlightCheck 通过
- [ ] 系统任务类型仍检查 title 和 priority
  - Test: dept_heartbeat task 空 title 时 preFlightCheck 失败
- [ ] npm test 全部通过
  - Test: `cd brain && npm test`
