# DoD - Brain PR Plans 调度集成

## 验收标准

### 功能验收

#### PR Plans 查询与状态管理
- [ ] `getNextPrPlan()` 能正确返回下一个可执行的 PR Plan
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] `isPrPlanCompleted()` 能准确判断 PR Plan 是否完成
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] `updatePrPlanStatus()` 能更新 PR Plan 状态到数据库
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] `getPrPlansByInitiative()` 能查询 Initiative 的所有 PR Plans
      Test: brain/src/__tests__/pr-plans-dispatch.test.js

#### 调度集成
- [ ] `planNextTask()` 优先调度 Initiative 的 PR Plans
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] tick 循环自动检查 PR Plans 完成状态并更新
      Test: brain/src/__tests__/pr-plans-dispatch.test.js

#### 依赖处理
- [ ] 无依赖的 PR Plan 立即可执行
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] 有依赖的 PR Plan 等待依赖完成后才执行
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] 多个无依赖的 PR Plans 按 sequence 顺序执行
      Test: brain/src/__tests__/pr-plans-dispatch.test.js

### 测试验收

- [ ] 单元测试包含至少 4 个测试用例
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] 所有新增函数有测试覆盖
      Test: brain/src/__tests__/pr-plans-dispatch.test.js
- [ ] Golden Path 集成测试通过
      Test: manual:创建 Initiative + PR Plans → tick → 验证调度顺序
- [ ] 边界情况测试：空 Initiative、无 PR Plans、全部完成
      Test: brain/src/__tests__/pr-plans-dispatch.test.js

### 文档验收

- [ ] 更新 DEFINITION.md 添加 PR Plans 调度说明
      Test: manual:检查文件存在且包含 PR Plans 调度内容
- [ ] 添加 PR Plans 调度流程说明到相关文档
      Test: manual:检查文档完整性

### CI/CD 验收

- [ ] Version Check 通过
      Test: contract:CI-version-check
- [ ] Facts Consistency 通过
      Test: contract:CI-facts-check
- [ ] Brain (Node.js) 测试全部通过
      Test: contract:CI-brain-test
- [ ] Semantic Brain (Python) 测试全部通过
      Test: contract:CI-semantic-test

### 代码质量验收

- [ ] 新增文件符合 ESM 规范
      Test: manual:检查 import/export 语法
- [ ] 数据库查询使用 parameterized queries 防止 SQL 注入
      Test: manual:代码审查
- [ ] 错误处理完善（try-catch + 日志）
      Test: manual:代码审查
- [ ] 添加必要的索引优化查询性能
      Test: manual:检查是否需要添加 `CREATE INDEX idx_pr_plans_initiative`

## 成功标准

1. **功能完整**: 所有 F1-F5 功能点实现并通过测试
2. **依赖正确**: D1-D3 依赖处理逻辑正确
3. **测试充分**: T1-T3 测试覆盖率达标
4. **文档完整**: Doc1-Doc2 文档更新
5. **CI 通过**: CI1-CI4 全部通过

## 非目标

- ❌ 不实现 PR Plans 优先级调度（留待后续 PR）
- ❌ 不支持动态依赖调整（留待后续 PR）
- ❌ 不实现可视化仪表板（留待前端 PR）
- ❌ 不实现 PR Plans 回滚功能（留待后续 PR）

## 回归契约

需要更新的 RCI（如有）：
- **无**：此功能是新增功能，不影响现有 RCI

需要新增的 RCI（如有）：
- **考虑新增**: PR Plans 调度的基本流程测试（可在后续 PR 添加）
