---
id: fix-trigger-source-dod
version: 1.0.0
created: 2026-02-07
updated: 2026-02-07
changelog:
  - 1.0.0: 初始版本
---

# DoD - Fix trigger_source 区分执行者

QA: 验证新建 task 带正确 trigger_source

## 验收清单

| # | DoD 条目 | Test 映射 | 验证方式 |
|---|---------|-----------|----------|
| 1 | actions.js createTask 支持 trigger_source 参数 | `grep trigger_source brain/src/actions.js` | 代码检查 |
| 2 | planner.js 传 brain_auto | `grep brain_auto brain/src/planner.js` | 代码检查 |
| 3 | proposal.js 传 proposal | `grep trigger_source brain/src/proposal.js` | 代码检查 |
| 4 | migration 011 更新旧数据 | `grep brain_auto brain/migrations/011` | 代码检查 |
| 5 | schema_version = 011 | `selfcheck.test.js: EXPECTED_SCHEMA_VERSION` | 单元测试 |
| 6 | Brain 测试不回归 | `cd brain && npx vitest run` | 通过 |
| 7 | DevGate 全绿 | `node scripts/facts-check.mjs && bash scripts/check-version-sync.sh` | 退出码 0 |

## 测试验收

- [ ] `cd brain && npx vitest run` 全部通过
- [ ] `node scripts/facts-check.mjs` 全绿
- [ ] `bash scripts/check-version-sync.sh` 全绿
- [ ] `node scripts/devgate/check-dod-mapping.cjs` 全绿
