# Definition of Done - P1 轮询循环（正确的两阶段分离）

QA: docs/QA-DECISION.md

## 验收标准

### 功能完成

- [x] Step 8 创建 PR 后不调用 Step 9
  Test: manual:code-review
  Evidence: `C1`
  - 08-pr.md 结尾不包含 Step 9 调用
  - PR 创建后直接结束

- [x] Stop Hook 在 PR 创建后能够触发 exit 0
  Test: manual:hook-test
  Evidence: `T1`
  - hooks/stop.sh 检测到 PR 已创建
  - 返回 exit 0 结束会话

- [x] Step 9 包含完整的 while 轮询循环
  Test: manual:code-review
  Evidence: `C2`, `C3`
  - 09-ci.md 包含 while true 循环
  - 三个状态分支：运行中/失败/成功
  - 失败后 continue 继续循环（不退出）

- [x] P1 阶段能够持续循环直到成功
  Test: manual:e2e-test
  Evidence: `T2`, `C7`
  - 模拟 CI 失败 → 修复 → 继续轮询
  - 模拟 CI 成功 → 自动合并
  - 超时保护机制（1小时）

### 质量检查

- [x] npm run typecheck 通过
  Test: manual:typecheck-output
  Evidence: `T3`

- [x] npm run test 通过
  Test: manual:test-output
  Evidence: `T4`

- [x] 文档更新完整
  Test: manual:doc-review
  Evidence: `C5`, `C6`
  - SKILL.md 流程图更新
  - 08-pr.md 和 09-ci.md 更新
  - CHANGELOG.md 添加 v10.4.0

### RCI 更新

- [x] regression-contract.yaml 更新
  Test: manual:rci-review
  Evidence: `C4`
  - 新增 W1-008（P1 轮询循环）
  - 更新 W1-004（Step 8 不调用 Step 9）

- [x] feature-registry.yml 更新
  Test: manual:registry-review
  Evidence: `C4`, `C5`, C5
  - W1 feature 描述更新
  - 版本号更新至 10.4.0

### 文档

- [x] .prd.md 存在且完整
  Test: manual:file-exists
  Evidence: `C5`

- [x] .dod.md 存在且完整（本文件）
  Test: manual:file-exists
  Evidence: `C5`

### 上线

- [x] PR 创建
  Test: manual:pr-link
  Evidence: `P1`

- [x] CI 通过
  Test: manual:ci-screenshot
  Evidence: `P2`

- [x] PR 合并
  Test: manual:pr-merged
  Evidence: `P1`
