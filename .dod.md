---
id: desire-system
version: 1.0.0
created: 2026-02-24
updated: 2026-02-24
changelog:
  - 1.0.0: 初始版本
---

# DoD：Cecelia 欲望系统（Desire System）验证

**基于 Step 4 探索发现：欲望系统已完全实现，这是验证任务而非开发任务**

## 验收清单

- [ ] D1: brain/migrations/073-desire-system.sql 存在且创建 memory_stream + desires 表
  - Test: desire-system.test.js 验证表结构

- [ ] D2: runPerception(pool) 收集信号并写入 memory_stream（任务趋势、KR 进度、沉默时长）
  - Test: mock DB，验证 memory_stream INSERT 被调用

- [ ] D3: runMemory(pool, observations) 调用 MiniMax 打分 1-10 并更新 desire_importance_accumulator
  - Test: mock MiniMax response，验证 accumulator 更新

- [ ] D4: accumulator >= 30 时触发 runReflection，洞察写入 memory_stream，accumulator 重置为 0
  - Test: accumulator=35 触发反思；accumulator=20 不触发

- [ ] D5: runDesireFormation(pool, insights) 插入 desires 表，type 字段为枚举之一
  - Test: mock insights，验证 desires INSERT

- [ ] D6: runExpressionDecision 综合评分，silence_penalty = min(hours/24, 1)，score > 0.6 才表达
  - Test: 高urgency + 长沉默 → score > 0.6；低urgency → score <= 0.6

- [ ] D7: runExpression(pool, desire) 调用 sendFeishu，更新 working_memory last_feishu_at
  - Test: mock sendFeishu，验证调用且 working_memory 更新

- [ ] D8: tick.js executeTick() return 前调用 await runDesireSystem(pool)，try/catch 隔离
  - Test: desire-system.test.js 集成测试

- [ ] D9: selfcheck.js EXPECTED_SCHEMA_VERSION → '073'，DEFINITION.md schema_version 同步
  - Test: facts-check.mjs 通过

- [ ] D10: brain/package.json minor version bump，.brain-versions 和 package-lock.json 同步
