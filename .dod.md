---
id: dod-thalamus-memory-inject
version: 1.0.0
created: 2026-02-19
updated: 2026-02-19
changelog:
  - 1.0.0: 初始版本
---

# DoD: thalamus 决策前注入 Memory API 语义搜索结果

## 验收清单

| # | DoD 条目 | Test 映射 |
|---|---------|----------|
| 1 | analyzeEvent() 在构建 prompt 前调用 Memory 语义搜索 | thalamus-memory-injection.test.js: buildMemoryBlock 成功返回格式化 block |
| 2 | prompt 中包含 Memory 搜索结果段落（最多 3 条，每条 150 字符） | thalamus-memory-injection.test.js: 结果最多返回 3 条 |
| 3 | Memory 搜索失败时不影响主流程（graceful fallback） | thalamus-memory-injection.test.js: Memory API 网络超时/异常时应优雅降级 |
| 4 | 搜索 query 从 event payload 提取（task.title/payload.title/payload.description） | thalamus-memory-injection.test.js: extractMemoryQuery 各字段提取 |
| 5 | 单元测试全部通过（11 个用例） | npx vitest run src/__tests__/thalamus-memory-injection.test.js |
| 6 | facts-check.mjs 通过（action_count 未变） | node scripts/facts-check.mjs |
| 7 | check-version-sync.sh 通过（patch bump: 1.50.2 → 1.50.3） | bash scripts/check-version-sync.sh |

## 版本变化

patch bump（新增内部功能，不增加 action）：1.50.2 → 1.50.3
