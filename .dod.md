---
id: cp-02240015-code-review-task-type-dod
version: 1.0.0
created: 2026-02-24
updated: 2026-02-24
changelog:
  - 1.0.0: 初始版本
---

# DoD: code_review task type + 每日自动调度

## 验收清单

- [ ] task-router.js: LOCATION_MAP 含 `code_review: 'us'`
- [ ] task-router.js: isValidTaskType 支持 `'code_review'`
- [ ] migration 072 SQL 文件存在且语法正确
- [ ] executor.js skillMap: `code_review` → `'/code-review'`
- [ ] executor.js permissionMode: `code_review` → `'bypassPermissions'`
- [ ] executor.js preparePrompt: 处理 code_review，传入 repo_path
- [ ] daily-review-scheduler.js 实现 isInDailyWindow (02:00 UTC, 5min)
- [ ] daily-review-scheduler.js 实现 hasTodayReview 去重
- [ ] daily-review-scheduler.js 实现 getActiveRepoPaths 从 projects 表
- [ ] daily-review-scheduler.js Fallback repos 列表
- [ ] tick.js 调用 triggerDailyReview()
- [ ] selfcheck.js EXPECTED_SCHEMA_VERSION = '072'
- [ ] DEFINITION.md 版本/schema/task_types 同步
- [ ] 测试：daily-review-scheduler.test.js 全部通过
- [ ] 测试：task-router-code-review.test.js 全部通过
- [ ] npm test 本地全通过
- [ ] CI 通过
