# Definition of Done: 修复 Token Bucket Rate Limiting 配置

## 功能验收

- [ ] Token Bucket 配置已更新（maxTokens=20, refillRate=15, tokens=20）
  - Test: 读取 brain/src/alertness.js，验证 `_tokenBucket.dispatch` 参数

- [ ] LEVEL_TOKEN_RATES 已同步更新（NORMAL=15, ALERT=8, EMERGENCY=4）
  - Test: 读取 brain/src/alertness.js，验证 `LEVEL_TOKEN_RATES` 各级别参数

- [ ] Brain 能够派发任务
  - Test: 重启 Brain → 等待 1 分钟 → 触发 Tick → 验证不再 rate_limited → 验证 queued 任务被派发

- [ ] Rate Limiting 仍然有效
  - Test: 快速触发 21 次 Tick → 验证第 21 次 rate_limited → 等待 1 分钟 → 验证 token 补充

- [ ] 代码无语法错误
  - Test: `node -c brain/src/alertness.js` 无错误

- [ ] 现有测试通过
  - Test: `npm test -- alertness` 所有测试通过

- [ ] 版本号已更新到 1.39.2
  - Test: `jq -r .version brain/package.json` 返回 1.39.2，`.brain-versions` 和 `DEFINITION.md` 同步

- [ ] LEARNINGS.md 已更新
  - Test: docs/LEARNINGS.md 包含 token bucket 配置的条目

- [ ] CI 所有检查通过
  - Test: PR 的 CI 状态为 SUCCESS

- [ ] 生产环境验证
  - Test: 部署后观察 30 分钟，验证任务正常派发，无异常 rate_limited
