# PRD: 瓶颈扫描记录的触发和收集逻辑

## 目标

实现瓶颈扫描的定时触发和结果收集逻辑，将扫描结果存储到 `bottleneck_scans` 表。

## 背景

系统已有 `bottleneck_scans` 表（migration 046），但缺少触发和收集逻辑。需要参考现有 `health-monitor.js` 的模式实现定时扫描。

## 功能需求

### 1. 瓶颈扫描触发器 (`brain/src/triggers/bottleneck-scan.js`)

- 定时触发瓶颈扫描（建议每小时一次，与 health-monitor 错开）
- 扫描类型：`system_performance`, `queue_depth`, `task_stuck`, `resource_usage`
- 每次扫描生成一条记录

### 2. 健康监控收集器 (`brain/src/services/health-monitor-collector.js`)

- 收集扫描结果并存储到 `bottleneck_scans` 表
- 支持多种扫描类型
- 返回扫描结果

### 3. Tick Loop 集成

- 在 tick.js 中集成瓶颈扫描
- 每小时运行一次（可配置间隔）

## 数据模型

```sql
bottleneck_scans (
  id UUID PRIMARY KEY,
  scan_type VARCHAR(50),      -- 扫描类型
  bottleneck_area VARCHAR(100), -- 瓶颈区域
  severity VARCHAR(20),       -- low/medium/high/critical
  details JSONB,              -- 扫描详情
  recommendations JSONB,      -- 建议
  created_at TIMESTAMPTZ
)
```

## 验收标准

1. 定时触发瓶颈扫描
2. 收集扫描结果并存储到数据库
3. 集成到 Tick Loop
4. 单元测试通过

## 测试计划

1. 单元测试：验证触发逻辑
2. 集成测试：验证数据收集和存储
