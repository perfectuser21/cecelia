---
id: prd-proactive-greeting
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# PRD: Cecelia 主动打招呼 — 用户到来即感知

## 背景

用户三次反馈同一个核心问题：**"打开前台还是没人理我"**。

当前状态：
- VoiceCard 显示的是客户端拼接的静态文本（"早上好。正在执行 X 个任务。"）
- 后端完全不知道用户打开了页面（`user_last_seen` 只在聊天时更新）
- Desire 系统需要 10-30 分钟才可能产出表达（反思累积器 ≥30 才触发）
- 用户必须主动点击聊天框才能和 Cecelia 对话

## 目标

**用户打开 Dashboard 的 3 秒内，Cecelia 主动说一段有意义的话，不需要用户点击任何东西。**

## 成功标准

1. 用户打开页面 → 3 秒内 VoiceCard 显示 Cecelia 生成的个性化问候
2. 问候内容包含当前系统状态（运行中任务、队列、异常等）
3. 问候不是静态模板，是 LLM 生成的自然语言
4. 5 分钟内重复打开不重复生成（防刷）
5. 后端记录 user_last_seen，让 desire 系统也能感知用户在线

## 实现方案

### 后端
1. 新端点 `POST /api/brain/greet` — 接收用户在线信号，生成问候
   - 调用 `callLLM('mouth', prompt)` 使用 Haiku（快 + 便宜）
   - 注入当前系统状态（briefing 数据）作为 context
   - 5 分钟冷却（working_memory `last_greet_at`）
   - 通过 WebSocket 广播 DESIRE_EXPRESSED 事件
   - 同时更新 `user_last_seen`

### 前端
1. CeceliaPage 挂载时自动调用 POST `/api/brain/greet`
2. VoiceCard 通过 WebSocket 接收 DESIRE_EXPRESSED → 显示问候
3. 不需要额外 UI 改动，复用现有 VoiceCard 表达机制

## 非目标

- 不改变 Desire 6 层管道（保持现有机制）
- 不改变 CommandPalette/聊天系统
- 不改变页面布局
