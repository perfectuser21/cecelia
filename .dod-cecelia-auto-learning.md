# DoD - Cecelia 自动学习回路

## 验收标准

### 功能验收

- [ ] 任务 status='completed' 时自动创建 execution_result 类型的 learning 记录
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 任务 status='failed' 时自动创建 failure_pattern 类型的 learning 记录
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 只记录有价值的 task_type（dev, feature, research），跳过高频低价值类型（code_review）
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 使用 content_hash 自动去重，相同内容不重复写入
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 实施每日上限 50 条，防止过度学习
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 新创建的 learning 记录 digested=false，等待反刍消化
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 不影响现有 execution-callback 的任务状态更新
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 不影响现有 execution-callback 的 WebSocket 广播功能
      Test: tests/execution-callback-auto-learning.test.js

### 边界条件验证

- [ ] task_type 为 code_review 时不创建 learning
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 相同 content_hash 的内容不重复写入（幂等性）
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 达到每日限制后停止创建新 learning
      Test: tests/execution-callback-auto-learning.test.js

- [ ] 在数据库事务失败时不影响主要的任务状态更新
      Test: tests/execution-callback-auto-learning.test.js

### 测试验收

- [ ] npm test 通过
      Test: contract:C2-001

- [ ] 单元测试覆盖所有成功和失败场景
      Test: manual:查看测试覆盖率报告