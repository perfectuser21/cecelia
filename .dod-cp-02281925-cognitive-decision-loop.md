---
id: dod-cp-02281925-cognitive-decision-loop
version: 1.2.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
  - 1.1.0: 补全 Test 字段
  - 1.2.0: 修复 Test 格式（grep -q + npm:test）
---

# DoD: Cecelia 认知-决策双闭环

## 验收清单

### 方向1：情绪 → 调度

- [x] 情绪评估：从 DB 获取 queueDepth（queued 任务数）和 successRate（最近成功率）
  Test: manual:bash -c "grep -q 'FROM tasks' packages/brain/src/tick.js"
- [x] `effectiveDispatchMax` 乘以 `emotion.dispatch_rate_modifier`
  Test: manual:bash -c "grep -q 'emotionDispatchModifier' packages/brain/src/tick.js"
- [x] `overloaded` 状态：log "情绪过载，跳过本轮派发" 并跳过
  Test: manual:bash -c "grep -q 'emotion_overloaded' packages/brain/src/tick.js"
- [x] `cognitive-core.js` importance 0.6 → 6（修复叙事写入）
  Test: manual:bash -c "grep -q 'importance, 6' packages/brain/src/cognitive-core.js"

### 方向3：反刍 → 计划

- [x] `planner.js` 新增 `buildInsightAdjustments(krIds)` 函数
  Test: manual:bash -c "grep -q 'buildInsightAdjustments' packages/brain/src/planner.js"
- [x] `scoreKRs()` 注入 insight 调整量
  Test: manual:bash -c "grep -q 'insightAdjustments' packages/brain/src/planner.js"

### 质量

- [x] 新增测试：emotion-dispatch.test.js（情绪门禁 + 修正系数）
  Test: npm:test:packages/brain -- --run src/__tests__/emotion-dispatch.test.js
- [x] 新增测试：planner-insight.test.js（buildInsightAdjustments 得分调整）
  Test: npm:test:packages/brain -- --run src/__tests__/planner-insight.test.js
- [x] Brain CI 通过（facts-check + version-sync）
  Test: manual:bash -c "node scripts/facts-check.mjs && bash scripts/check-version-sync.sh"
