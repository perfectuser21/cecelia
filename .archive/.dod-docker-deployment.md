# DoD: Cecelia 24/7 Docker 自主运行部署

## 验收标准

### 1. Docker 部署成功
- [ ] docker-compose.yml 配置完整
- [ ] .env.docker 包含所有必需的凭据
- [ ] .dockerignore 排除不必要的文件
- [ ] Dockerfile 优化（如需修改）

### 2. 服务正常运行
- [ ] `docker compose ps` 显示所有服务 healthy
- [ ] semantic-brain (5220) 健康检查通过
- [ ] node-brain (5221) 健康检查通过
- [ ] 服务依赖关系正确（node-brain 等待 semantic-brain）

### 3. Tick 循环运行
- [ ] `curl http://localhost:5221/api/brain/tick/status` 返回 enabled=true, loop_running=true
- [ ] Circuit Breaker 状态 CLOSED
- [ ] 无卡住的任务（in_progress 为空）

### 4. 配置正确
- [ ] 数据库连接成功（DB_HOST, DB_PORT, DB_NAME, DB_USER, DB_PASSWORD）
- [ ] OpenAI API Key 配置正确
- [ ] Tick 间隔配置：120000ms (2分钟)
- [ ] 并发限制配置：3 个任务
- [ ] 超时配置：60 分钟

### 5. 文件挂载正确
- [ ] `/home/xx/dev` → 代码库可访问（只读）
- [ ] `/home/xx/.claude` → Skills 可访问（只读）
- [ ] `/home/xx/bin/cecelia-run` → 可执行
- [ ] `./data/chroma` → 向量数据持久化
- [ ] `./logs` → 日志目录可写

### 6. 自动重启功能
- [ ] restart: unless-stopped 配置
- [ ] 健康检查失败后自动重启
- [ ] 手动 kill 容器后自动重启
- [ ] 服务器重启后自动启动

### 7. 日志管理
- [ ] 日志驱动：json-file
- [ ] 单文件大小限制：10MB
- [ ] 保留文件数：3 个
- [ ] `docker compose logs -f` 可查看实时日志

### 8. 功能验证
- [ ] 创建测试任务能被自动执行
- [ ] 任务状态正确同步到数据库
- [ ] Circuit Breaker 熔断保护正常工作
- [ ] 任务超时自动 fail

### 9. 性能要求
- [ ] 空闲时 CPU 使用率 < 50%
- [ ] 空闲时内存使用 < 2GB
- [ ] 并发 3 个任务时系统稳定

### 10. 文档完备
- [ ] README.md 更新启动命令
- [ ] 创建 DOCKER.md 运维手册
- [ ] ARCHITECTURE.md 更新 Docker 架构图

## QA 决策

根据 skills/qa/SKILL.md 规范，此任务为：

**测试等级**：L0（基础设施/部署配置）

**原因**：
- 纯部署配置变更
- 不涉及业务逻辑代码
- Docker Compose 配置可通过启动验证
- 健康检查自动验证服务状态

**测试策略**：
- 部署后手动验证（成功标准 1-10）
- 创建测试任务验证功能
- 模拟容器崩溃验证自动重启
- 无需编写单元测试或集成测试

## 完成条件

所有 10 项验收标准通过 ✅
