---
id: dod-cp-02212100-perf-observability
version: 1.0.0
created: 2026-02-21
updated: 2026-02-21
changelog:
  - 1.0.0: 初始版本
---

# DoD：性能优化与可观测性增强

## 验收清单

### D1：exploratory 任务改用 Haiku

- [ ] D1-1：getModelForTask() 对 task_type === 'exploratory' 返回 'claude-haiku-4-5-20251001'
- [ ] D1-2：其他任务类型返回 null（使用默认 Sonnet）
- [ ] Test: executor-model-select.test.js 覆盖 D1-1, D1-2

### D2：MAX_SEATS 环境变量控制

- [ ] D2-1：CECELIA_MAX_SEATS 存在且有效时，MAX_SEATS 不超过该值
- [ ] D2-2：CECELIA_MAX_SEATS 未设置时，原有自动计算逻辑不变
- [ ] D2-3：docker-compose.yml node-brain 服务添加 CECELIA_MAX_SEATS=6
- [ ] Test: executor-max-seats-override.test.js 覆盖 D2-1, D2-2

### D3：CPU 状态持续记录

- [ ] D3-1：monitor-loop 每次 runMonitorCycle() 写入一条 resource_snapshot 到 cecelia_events
- [ ] D3-2：payload 包含 cpu_percent、rss_mb、active_processes、max_seats、utilization
- [ ] D3-3：写入失败不影响 monitor 主流程（try/catch 处理）
- [ ] Test: monitor-resource-snapshot.test.js 覆盖 D3-1, D3-2, D3-3

### D4：Session 时长追踪

- [ ] D4-1：首次成功派发任务时记录 _sessionStart（仅首次，不覆盖）
- [ ] D4-2：setBillingPause 调用时记录 Session 结束，写入 cecelia_events（type='session_end'）
- [ ] D4-3：GET /api/brain/session/stats 返回当前 session 开始时间、已运行分钟数、历史（最近 10 条）
- [ ] Test: session-tracking.test.js 覆盖 D4-1, D4-2, D4-3
