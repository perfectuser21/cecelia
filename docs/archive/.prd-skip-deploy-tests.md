---
id: prd-skip-deploy-tests
version: 1.0.0
created: 2026-02-14
---

# PRD: Skip Local Tests During Brain Deployment

## 问题

Brain deployment script (`scripts/brain-deploy.sh`) runs tests at step 4/7, causing port conflicts:

- If Brain is running: `Error: listen EADDRINUSE: address already in use :::5221`
- If Brain is stopped: `Error: connect ECONNREFUSED 127.0.0.1:5221`

This blocks deployment even though all tests pass in CI.

## 解决方案

Skip local test execution during deployment. CI already validates all tests before merge.

## 修改文件

- `scripts/brain-deploy.sh` - Replace test step with skip message

## 安全性

- ✅ All tests run in CI before PR merge
- ✅ Migrations and selfcheck still run before deployment
- ✅ Health check still runs after deployment (with auto-rollback)
- ✅ No actual code logic changed, just deployment infrastructure

## 验收标准

- [ ] Deployment succeeds without port conflicts
- [ ] Brain 1.37.1 deploys successfully
- [ ] Health check passes after deployment
