---
id: prd-cp-02171900-cancel-task-test-coverage
version: 1.0.0
created: 2026-02-17
updated: 2026-02-17
changelog:
  - 1.0.0: 初始版本
---

# PRD: cancel_task action 测试覆盖

## 背景
thalamus.js quickRoute() 的 TASK_FAILED 分支已有 retry>=3 时的 cancel_task 逻辑，但 decision-executor.js 中 cancel_task action 的处理缺乏完整的端到端测试。

## 目标
1. 验证 decision-executor.js 中 cancel_task action 的处理逻辑
2. 确认 cancel_task 会将任务状态更新为 cancelled（而非 quarantined）
3. 在 decision-executor.test.js 新增对 cancel_task（retry>=3）的端到端测试

## 具体工作

### 检查 decision-executor.js
- 查找 executeAction() 对 cancel_task 的处理
- 确认任务状态变为 cancelled 而非 quarantined

### 新增测试
在 brain/src/__tests__/decision-executor.test.js 添加：
1. cancel_task action 执行后任务状态为 cancelled
2. cancel_task 携带 reason=retry_exceeded
3. cancel_task 不触发 retry 循环

## 验收标准
1. cancel_task 在 decision-executor.js 正确实现（status → cancelled）
2. 新增 3 个测试用例全部通过
3. npm test 全部通过
4. version bump (patch)
