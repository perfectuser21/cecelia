---
id: prd-cp-02181034-quickroute-user-command
version: 1.0.0
created: 2026-02-18
updated: 2026-02-18
changelog:
  - 1.0.0: 初始版本 - quickRoute USER_COMMAND 扩展
---

# PRD: quickRoute 扩展 - USER_COMMAND 简单指令快速路由

## 背景
当前 USER_COMMAND 和 USER_MESSAGE 事件全部落入 Sonnet 判断。
但部分简单指令（如 status 查询、tick 触发）可以通过规则快速路由，无需 LLM。

## 目标
为 USER_COMMAND 事件中的常见简单指令添加快速路由，减少 Sonnet 调用。

## 技术方案
修改 brain/src/thalamus.js，在 quickRoute 中添加：
```js
if (event.type === EVENT_TYPES.USER_COMMAND) {
  const cmd = (event.command || '').toLowerCase();
  // 查询类指令：直接 no_action（由 API 层处理）
  if (['status', 'health', 'version'].includes(cmd)) {
    return {
      level: 0,
      actions: [{ type: 'no_action', params: {} }],
      rationale: `用户查询指令 ${cmd}，API 层处理`,
      confidence: 1.0,
      safety: false
    };
  }
  // tick 触发：fallback_to_tick
  if (cmd === 'tick') {
    return {
      level: 0,
      actions: [{ type: 'fallback_to_tick', params: {} }],
      rationale: '用户手动触发 tick',
      confidence: 1.0,
      safety: false
    };
  }
  // 复杂指令 → 交给 Sonnet
  return null;
}
```

## 注意
- USER_MESSAGE 不做快速路由（内容复杂，需要 LLM 理解）
- USER_COMMAND 只对已知简单指令快速路由，未知指令 → null

## 验收标准
- USER_COMMAND(status/health/version) → no_action
- USER_COMMAND(tick) → fallback_to_tick
- USER_COMMAND(unknown) → null（Sonnet 处理）
- USER_MESSAGE → null（Sonnet 处理，不受影响）
- vitest 新增测试用例，全部通过
- facts-check.mjs 通过
