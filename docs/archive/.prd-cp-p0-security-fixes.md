# PRD: P0 安全紧急修复

## 背景

深度检测发现 4 个 CRITICAL 问题必须在上线前修复：
1. 数据库密码泄露到 Git 仓库历史
2. 代码中硬编码密码 fallback
3. tick.js 运行时错误导致 WebSocket 广播失败
4. 文档版本严重过期

## 目标

修复所有 P0 CRITICAL 问题，确保系统安全性和稳定性。

## 修复范围

### 1. 密码安全修复

**问题**: `.env.docker` 包含明文密码且被 Git 追踪（已在 7 个 commits 中泄露）

**修复**:
- 从 Git 追踪中移除 `.env.docker`
- 创建 `.env.docker.example` 模板
- 确保 `.gitignore` 正确配置
- 修复 `db-config.js` 硬编码密码 fallback

### 2. 运行时错误修复

**问题**: `tick.js:643` 引用不存在的变量 `activeCount` 和 `effectiveLimit`

**修复**:
- 删除错误的 `publishExecutorStatus` 调用
- 验证 WebSocket 广播不再抛异常

### 3. 文档版本同步

**问题**: MEMORY.md 和 DEFINITION.md 版本信息过期

**修复**:
- MEMORY.md: 更新版本 1.35.0 → 1.40.4, schema 029 → 035, 测试数 1158 → 1244
- DEFINITION.md: 更新内部版本引用、schema 版本、CORE_TABLES 列表

## 验收标准

- [ ] `.env.docker` 不在 Git 追踪中
- [ ] `.env.docker.example` 已创建且不包含真实密码
- [ ] `db-config.js` 的 password fallback 为空字符串
- [ ] `tick.js` 不再引用不存在的变量
- [ ] 所有测试通过
- [ ] MEMORY.md 所有版本引用正确
- [ ] DEFINITION.md 所有版本和 schema 引用正确
- [ ] CI 通过

## 优先级

P0 - 上线前必须完成

## 预计工作量

2-3 小时
