---
id: dod-cecelia-page-ws-briefing
version: 1.0.0
created: 2026-02-25
updated: 2026-02-25
changelog:
  - 1.0.0: 初始版本
---

# DoD: CeceliaPage V2 Phase 1 — WebSocket 增强 + Briefing API

## 验收清单

### WebSocket 新事件
- [ ] WS_EVENTS 新增 ALERTNESS_CHANGED, DESIRE_CREATED, DESIRE_UPDATED, TICK_EXECUTED
  - Test: websocket-events.test.js 验证事件常量存在
- [ ] alertness/index.js transitionToLevel() 中 broadcast alertness:changed
  - Test: alertness 等级变化时 broadcast 被调用
- [ ] desire/desire-formation.js INSERT 后 broadcast desire:created
  - Test: desire 创建时 broadcast 被调用
- [ ] routes.js PATCH /desires/:id 后 broadcast desire:updated
  - Test: desire 更新时 broadcast 被调用
- [ ] tick.js executeTick() return 前 broadcast tick:executed
  - Test: tick 完成时 broadcast 被调用

### 服务端心跳
- [ ] WebSocket 服务端每 30s 主动 ping 客户端
  - Test: 心跳间隔配置存在
- [ ] 超时 60s 无 pong 回复的连接被自动清理
  - Test: 僵尸连接清理逻辑

### Briefing API
- [ ] GET /api/brain/briefing 返回聚合简报数据
  - Test: briefing.test.js 验证返回格式
- [ ] 简报包含: greeting, since_last_visit, pending_decisions, today_focus, token_cost_usd
  - Test: 各字段存在且类型正确

### 质量
- [ ] 所有新功能有测试覆盖
- [ ] npm test 全部通过
- [ ] 版本号 bump (minor: 1.98.0)
