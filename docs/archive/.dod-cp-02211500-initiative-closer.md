---
id: dod-cp-02211500-initiative-closer
version: 1.0.0
created: 2026-02-21
updated: 2026-02-21
changelog:
  - 1.0.0: 初始版本
---

# DoD: Initiative 闭环检查器 (cp-02211500)

## 验收清单

- [ ] D1: 所有 tasks completed → initiative 被关闭
  - Test: initiative-completion.test.js - "D1: 所有 tasks completed 时关闭 initiative"
  - 验证：status='completed', completed_at 不为 null

- [ ] D2: 有 in_progress task → 不关闭
  - Test: initiative-completion.test.js - "D2: 有 in_progress task 时不关闭"
  - 验证：返回 closedCount=0

- [ ] D3: 有 queued task → 不关闭
  - Test: initiative-completion.test.js - "D3: 有 queued task 时不关闭"
  - 验证：返回 closedCount=0

- [ ] D4: tasks 全为空（total=0） → 不关闭（避免误关空 initiative）
  - Test: initiative-completion.test.js - "D4: 没有 tasks 时不关闭（避免空 initiative 误关）"
  - 验证：返回 closedCount=0

- [ ] D5: 已经 completed 的 initiative → 不重复处理
  - Test: initiative-completion.test.js - "D5: 已 completed 的 initiative 不重复处理"
  - 验证：只查 status='in_progress' 的

- [ ] D6: tick.js Section 0.8 集成调用
  - 验证：[TICK] Initiative 完成检查 日志出现

- [ ] D7: Migration 045 到位（projects.completed_at 字段）
  - 验证：selfcheck.js EXPECTED_SCHEMA_VERSION='045'
  - 验证：facts-check.mjs 通过

- [ ] D8: 全量测试通过（npm test）
  - 验证：所有现有测试 + 新增 5 个测试通过

## 产物

- brain/src/initiative-closer.js（新文件）
- brain/migrations/045_add_project_completed_at.sql（新 migration）
- brain/src/__tests__/initiative-completion.test.js（5 个测试）
- brain/src/tick.js（Section 0.8 集成）
- brain/src/selfcheck.js（EXPECTED_SCHEMA_VERSION='045'）
