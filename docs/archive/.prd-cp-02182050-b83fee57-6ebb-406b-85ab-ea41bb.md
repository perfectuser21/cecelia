## PRD - learnings 失败历史影响任务评分

**需求来源**: 用户提出，planner.js 的 generateNextTask() 未考虑同类型任务的历史失败率，learnings 表记录了失败分析（failure_class），可用于预防性调整评分。

**功能描述**: 在 generateNextTask() 中增加学习历史惩罚因子：
- 查询同 project_id + task_type 的近期 learnings（7天内）
- 若 failure_class 频繁出现（>=2次），给该任务添加 wait_before_retry 标记或将其评分降低
- 避免在同一坑上反复失败

**涉及文件**:
- brain/src/planner.js（核心修改：新增 applyLearningPenalty 函数）
- brain/src/learning.js（辅助：searchRelevantLearnings 函数）

**成功标准**:
1. planner.js 新增 applyLearningPenalty(tasks) 函数
2. 查询 learnings 表最近7天同 task_type 的失败记录
3. 失败>=2次的任务类型打 -20 分惩罚（可配置）
4. 测试：模拟相同 task_type 多次失败后优先级下降

**非目标**:
- 不修改 learnings 表结构
- 不影响其他评分因子
- 不实现 UI 界面展示
