## DoD - learnings 失败历史影响任务评分

### 验收清单

- [ ] **DoD 1**: `applyLearningPenalty(tasks, projectId)` 函数在 planner.js 中实现
  - Test: 函数存在，接受 tasks 数组和 projectId 参数，返回带惩罚分的 tasks

- [ ] **DoD 2**: 查询 learnings 表最近7天同 task_type 的失败记录（通过 metadata.task_type）
  - Test: 当无 learnings 时，任务评分不变

- [ ] **DoD 3**: 失败 >= 2 次的任务类型打 -20 分惩罚（LEARNING_PENALTY_SCORE 常量）
  - Test: 同 task_type 失败 2+ 次后，对应任务被惩罚 -20 分

- [ ] **DoD 4**: generateNextTask() 调用 applyLearningPenalty()，已惩罚的任务排序靠后
  - Test: 同 task_type 失败 2+ 次后，该类型任务优先级降低（排序靠后）

- [ ] **DoD 5**: 测试文件 `planner-learning-penalty.test.js` 覆盖上述 4 个场景
  - Test: 所有测试通过

### 技术说明

- 惩罚因子通过 `metadata->>task_type` 查询 learnings 表
- `LEARNING_PENALTY_SCORE = -20`（可配置常量）
- `LEARNING_LOOKBACK_DAYS = 7`（可配置常量）
- `LEARNING_FAILURE_THRESHOLD = 2`（可配置常量）
- applyLearningPenalty 是纯 async 函数，不修改 DB
- generateNextTask 在排序前调用，构建 task_type → penalty map
