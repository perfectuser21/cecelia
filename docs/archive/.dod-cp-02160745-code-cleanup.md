# DoD: 代码清理 - L3 审计问题修复

## 验收标准

### 1. 代码修改完成 ✅

- [ ] `brain/src/intent.js` - @deprecated 标记移除
- [ ] `.env.docker` - 废弃变量注释改进
- [ ] `docker-compose.yml` - 废弃变量注释改进

**Test**:
```bash
# 检查 @deprecated 标记不再存在
! grep -n "@deprecated.*generatePrdDraft" brain/src/intent.js

# 检查注释已更新
grep -n "auto-calculated" .env.docker docker-compose.yml
```

### 2. 代码一致性 ✅

- [ ] generatePrdDraft() 函数仍正常工作
- [ ] 注释清晰准确

**Test**:
```bash
# 检查函数仍在使用
grep -n "generatePrdDraft" brain/src/intent.js | wc -l
# 期望: 至少 2 行（定义 + 调用）
```

### 3. Facts 一致性 ✅

- [ ] Facts check 通过

**Test**:
```bash
node scripts/facts-check.mjs
```

### 4. 测试通过 ✅

- [ ] 所有测试通过

**Test**:
```bash
cd brain && npm test
```

### 5. 版本更新 ✅

- [ ] 版本：1.41.3 → 1.41.4 (patch)
- [ ] 所有版本文件同步

**Test**:
```bash
bash scripts/check-version-sync.sh
```

### 6. 部署验证 ✅

- [ ] Brain 重启正常
- [ ] Health check 通过

**Test**:
```bash
curl -s http://localhost:5221/api/brain/health | jq '.status'
# 期望: "healthy"
```

## 回滚计划

如果出现问题：
```bash
git revert <commit>
bash scripts/brain-deploy.sh
```
