# DoD: 全部任务改用 Sonnet（成本优化）

## 验收标准

### 1. 代码修改 ✅
- [ ] `brain/src/executor.js` 的 `getModelForTask()` 函数已修改
- [ ] 函数返回 `null`（全部使用 Sonnet 默认）
- [ ] 移除了 Opus 相关的条件判断

**Test**: 检查 executor.js 源码
```bash
grep -A 10 "function getModelForTask" brain/src/executor.js
```

### 2. 版本更新 ✅
- [ ] `brain/package.json` 版本：1.41.2 → 1.41.3
- [ ] `.brain-versions` 文件已同步
- [ ] `DEFINITION.md` 中 Brain 版本已更新

**Test**: 版本同步检查
```bash
bash scripts/check-version-sync.sh
```

### 3. Facts 一致性 ✅
- [ ] Facts check 通过（DEFINITION.md 与代码一致）

**Test**: Facts 检查
```bash
node scripts/facts-check.mjs
```

### 4. 部署成功 ✅
- [ ] Docker 镜像构建成功：cecelia-brain:1.41.3
- [ ] 容器启动正常
- [ ] Health check 通过

**Test**: 健康检查
```bash
curl -s http://localhost:5221/api/brain/health | jq '.status'
# 期望输出：healthy
```

### 5. 运行时验证 ✅
- [ ] Brain 日志不再显示 `model=opus`
- [ ] 新任务全部使用 Sonnet（日志中无 model 参数或 model=sonnet）
- [ ] 至少 1 个新任务成功派发并使用 Sonnet

**Test**: 日志检查
```bash
# 检查最近的派发日志
docker logs cecelia-node-brain --tail 100 | grep -i "dispatch\|model"

# 检查是否还有 opus
docker logs cecelia-node-brain --tail 100 | grep -i "opus"
# 期望：无输出或只有历史记录
```

### 6. 成本效果 ✅
- [ ] 新任务的模型配置为 Sonnet
- [ ] 系统状态正常，无异常错误

**Test**: 任务查询
```bash
curl -s 'http://localhost:5221/api/brain/tasks?status=queued&limit=5' | jq '.[] | {title, task_type}'
```

## 回滚计划

如果质量明显下降或出现异常：

1. **回滚到 1.41.2**
```bash
docker stop cecelia-node-brain
docker tag cecelia-brain:1.41.2 cecelia-brain:latest
docker start cecelia-node-brain
```

2. **恢复 Opus 配置**（如果需要混合策略）
```javascript
function getModelForTask(task) {
  const decomposition = task.payload?.decomposition;
  if (decomposition === 'true' || decomposition === 'continue') return 'opus';
  if (task.task_type === 'dev') return 'opus';
  return null;
}
```

3. **创建新 PR 恢复代码**
