# PRD: Three-Pool Slot Allocation System

## 功能描述

Replace the flat MAX_SEATS - INTERACTIVE_RESERVE model with a three-pool slot system:

- **Pool A (Cecelia Reserved, 1 slot)**: On-demand reserved for Cecelia internal tasks (OKR decomposition, cortex RCA). Falls back to Pool C when unused.
- **Pool B (User Reserved, 2 base + 2 headroom)**: Guaranteed for user headed sessions. System proactively keeps headroom. When 3+ headed sessions detected (team agents), enters user-priority mode: stops new auto-dispatch, lets running tasks drain.
- **Pool C (Dynamic Task Pool, remaining)**: Auto-dispatched tasks, further throttled by CPU/memory pressure.

## 成功标准

- [ ] New `slot-allocator.js` module with `detectUserSessions()`, `calculateSlotBudget()`, `getSlotStatus()`
- [ ] `detectUserSessions()` distinguishes headed (no -p) vs headless (with -p) claude processes
- [ ] `calculateSlotBudget()` computes per-pool budgets based on user presence and resource pressure
- [ ] `dispatchNextTask()` in tick.js uses slot budget instead of flat AUTO_DISPATCH_MAX
- [ ] GET /api/brain/slots endpoint returns pool allocation status
- [ ] User-priority mode: 3+ headed → Pool C budget = 0, tasks drain naturally
- [ ] Graceful wind-down: never kills running tasks, only stops new dispatches
- [ ] All existing tests pass + new tests for slot allocator
