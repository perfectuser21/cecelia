# PRD: Time-Aware Decomposition (v1.66.0)

## 功能描述

秋米 OKR 拆解 prompt 注入时间预算和顺序上下文，使拆解产出的 Project 自带 sequence_order 和 time_budget_days。

## 成功标准

- executor.js OKR 拆解 prompt 包含时间上下文 section
- decomposition-checker Check 5/6 description 包含时间预算信息
- okr-validation-spec 新增 sequence_order / time_budget_days WARNING

## 问题

秋米拆解 OKR 时没有时间维度信息：
- 不知道 KR 剩余多少天
- 不知道 Project 的 time_budget_days
- 不知道这是第几个 Project、前面的已完成还是进行中
- 没有前序 Project 的完成摘要

导致拆解结果缺乏时间约束，无法产出有 sequence_order 和 time_budget_days 的 Project。

## 目标

1. executor.js：OKR 拆解 prompt 注入时间预算和顺序上下文
2. decomposition-checker.js：Check 5/6 传入 time_budget 和 sequence 信息到 description
3. okr-validation-spec.yml：新增 sequence_order 和 time_budget_days 的 WARNING 规则

## 修改范围

### 1. executor.js — preparePrompt 增强

当 `decomposition === 'true'`（首次 OKR 拆解）时，在 prompt 中注入：
- `time_budget`: KR 的 target_date 距今天数 / Project 的 time_budget_days
- `sequence_hint`: "这是第 N/M 个 Project，前 N-1 个已完成"
- `previous_results`: 前序 Project 的完成摘要（名称 + 实际天数）
- `constraint`: "请标注 sequence_order 和 time_budget_days"

数据来源：查询 DB 获取 KR/Project 的时间信息（新增 helper 函数）。

### 2. decomposition-checker.js — Check 5/6 description 增强

- Check 5（Project → Initiative）：description 中追加 Project 的 deadline 和 time_budget_days
- Check 6（Initiative → Task）：description 中追加 Initiative 所属 Project 的 deadline

### 3. okr-validation-spec.yml

- projects.project: 新增 sequence_order WARNING
- projects.project: 新增 time_budget_days WARNING

## 不做什么

- 不新增 migration（字段已在 PR 1 migration 050 添加）
- 不修改 selfcheck.js（schema_version 不变）
- 不改动审查门控逻辑（PR 2 已完成）
- 不改动渐进验证逻辑（PR 3 已完成）
