---
id: quality-layers-visual
version: 1.0.0
created: 2026-01-26
updated: 2026-01-26
changelog:
  - 1.0.0: 初始版本 - Cecelia 质量体系可视化架构图
---

# Cecelia 质量体系 - 可视化架构图

## 四层金字塔（L1-L4）

```
                    ┌───────────────────────────────────────┐
                    │         L4 GoldenPath                 │
                    │     （端到端验证 E2E）                 │
                    │                                       │
                    │  Engine:  Hooks → Skills → PR → CI   │
                    │  Business: Flow → Publish → Website   │
                    │  App:     UI → Backend → Display      │
                    └───────────────────────────────────────┘
                                    ▲
                    ┌───────────────────────────────────────┐
                    │         L3 RCI                        │
                    │     （回归契约 Regression Contract）   │
                    │                                       │
                    │  Engine:   系统级 RCI                 │
                    │           ├─ Hooks 行为不变           │
                    │           ├─ Skills 契约稳定          │
                    │           └─ API 不漂移               │
                    │                                       │
                    │  Business: 业务能力级 RCI             │
                    │           ├─ Flow 输入/输出契约       │
                    │           ├─ Prompt 模板可复现        │
                    │           └─ 内容契约稳定             │
                    └───────────────────────────────────────┘
                                    ▲
                    ┌───────────────────────────────────────┐
                    │         L2 Static Rules               │
                    │     （静态规则 + 业务逻辑）            │
                    │                                       │
                    │  L2A: 静态业务规则                    │
                    │      ├─ 文件路径规范                  │
                    │      ├─ 命名规范                      │
                    │      ├─ Features Registry             │
                    │      └─ Impact 分析                   │
                    │                                       │
                    │  L2B: 构建业务路径                    │
                    │      ├─ Flow JSON 合法                │
                    │      ├─ Prompt Schema 合法            │
                    │      └─ Workflow 可编译               │
                    └───────────────────────────────────────┘
                                    ▲
                    ┌───────────────────────────────────────┐
                    │         L1 Syntax & Format            │
                    │        （基础质量）                    │
                    │                                       │
                    │  ├─ ESLint                            │
                    │  ├─ Prettier                          │
                    │  ├─ Typecheck                         │
                    │  ├─ Build Success                     │
                    │  └─ 无基础错误                        │
                    └───────────────────────────────────────┘
```

---

## RADNA 4层架构（L0-L3）

```
┌─────────────────────────────────────────────────────────────────────┐
│                          L0 - Rules                                 │
│                      （规则层 / 宪法）                               │
│                                                                     │
│  ┌─────────────────────┐  ┌─────────────────────┐                 │
│  │  P0/P1 定义         │  │  必须产物要求       │                 │
│  │  - CRITICAL → P0    │  │  - QA-DECISION.md   │                 │
│  │  - HIGH → P1        │  │  - AUDIT-REPORT.md  │                 │
│  │  - security: → P0   │  │  - .layer2-evidence │                 │
│  └─────────────────────┘  └─────────────────────┘                 │
│                                                                     │
│  ┌─────────────────────────────────────────────┐                  │
│  │  Gate/Regression 边界                        │                  │
│  │  - Gate: 安全边界（hooks/gates/ci）          │                  │
│  │  - Regression: 业务功能（src/skills/flows）  │                  │
│  └─────────────────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                          L1 - Contracts                             │
│                      （契约层 / 要求是什么）                          │
│                                                                     │
│  ┌────────────────────────────┐  ┌────────────────────────────┐   │
│  │   Gate Contract (GCI)      │  │  Regression Contract (RCI) │   │
│  │   ────────────────         │  │  ────────────────          │   │
│  │   6大红线：                 │  │  分类体系：                 │   │
│  │   G1: 空 DoD 不通过        │  │  H (Hooks)                 │   │
│  │   G2: 空 QA 不通过         │  │  W (Workflow)              │   │
│  │   G3: P0/P1 准确识别       │  │  C (Core)                  │   │
│  │   G4: Release 走 check     │  │  B (Business)              │   │
│  │   G5: 白名单不穿透         │  │                            │   │
│  │   G6: cleanup 安全         │  │  Golden Paths:             │   │
│  │                            │  │  - GP-001: 完整开发流程     │   │
│  │                            │  │  - GP-A01: 内容生成链路     │   │
│  └────────────────────────────┘  └────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                          L2 - Executors                             │
│                      （执行层 / 怎么检查）                            │
│                                                                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │
│  │   Hooks      │  │   DevGate    │  │   Skills     │            │
│  │  （触发器）   │  │  （检查器）   │  │  （决策器）   │            │
│  │              │  │              │  │              │            │
│  │ - branch-    │  │ - check-dod- │  │ - /audit     │            │
│  │   protect    │  │   mapping    │  │ - /qa        │            │
│  │ - pr-gate-v2 │  │ - require-   │  │ - /assurance │            │
│  │ - stop       │  │   rci-update │  │              │            │
│  │ - session-   │  │ - scan-rci-  │  │              │            │
│  │   start/end  │  │   coverage   │  │              │            │
│  │              │  │ - l2a-check  │  │              │            │
│  │              │  │ - l2b-check  │  │              │            │
│  │              │  │ - detect-    │  │              │            │
│  │              │  │   priority   │  │              │            │
│  │              │  │ - draft-gci  │  │              │            │
│  └──────────────┘  └──────────────┘  └──────────────┘            │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│                          L3 - Evidence                              │
│                      （证据层 / 检查后的产物）                        │
│                                                                     │
│  ┌──────────────────┐  ┌──────────────────┐  ┌─────────────────┐  │
│  │ QA-DECISION.md   │  │ AUDIT-REPORT.md  │  │ .layer2-        │  │
│  │ ────────────     │  │ ───────────      │  │ evidence.md     │  │
│  │ - Decision       │  │ - Target Level   │  │ ───────────     │  │
│  │ - Priority       │  │ - Findings       │  │ - 截图证据       │  │
│  │ - RepoType       │  │ - L1/L2/L3/L4    │  │ - 命令验证       │  │
│  │ - Tests          │  │ - Pass/Fail      │  │                 │  │
│  │ - RCI            │  │                  │  │                 │  │
│  └──────────────────┘  └──────────────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## RepoType 决策树

```
                        ┌─────────────┐
                        │   Repo      │
                        └──────┬──────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
        包含 regression-              不包含
        contract.yaml +
        hooks/skills?
                │                             │
                ▼                             ▼
        ┌───────────────┐           ┌─────────────────┐
        │  RepoType:    │           │  包含业务逻辑    │
        │  Engine       │           │  flows/ ?       │
        └───────────────┘           └────────┬────────┘
                                             │
                                  ┌──────────┴──────────┐
                                  │                     │
                                 是                     否
                                  │                     │
                                  ▼                     ▼
                        ┌─────────────────┐   ┌─────────────────┐
                        │  RepoType:      │   │  RepoType:      │
                        │  Business       │   │  App/Console    │
                        │  (Autopilot)    │   │                 │
                        └─────────────────┘   └─────────────────┘
```

---

## RCI 级别对比图

```
┌─────────────────────────────────────────────────────────────────────┐
│                        Engine RCI（系统级）                          │
│                                                                     │
│  ┌──────────────┐       ┌──────────────┐       ┌──────────────┐   │
│  │   Hooks      │──────▶│   Skills     │──────▶│  Workflow    │   │
│  │              │       │              │       │              │   │
│  │  入参不变    │       │  契约稳定    │       │  API 不漂移  │   │
│  │  出参不变    │       │  行为可预测  │       │  流程可复现  │   │
│  └──────────────┘       └──────────────┘       └──────────────┘   │
│                                                                     │
│  特点：                                                              │
│  - 强不变性（跨版本不变）                                            │
│  - 影响所有使用 Engine 的项目                                        │
│  - 系统集成测试验证                                                  │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                    Autopilot RCI（业务能力级）                       │
│                                                                     │
│  ┌──────────────┐       ┌──────────────┐       ┌──────────────┐   │
│  │  ContentSeed │──────▶│  DeepPost    │──────▶│  Publish     │   │
│  │              │       │              │       │              │   │
│  │  输入契约    │       │  模板可复现  │       │  内容契约    │   │
│  │  输出契约    │       │  JSON 稳定   │       │  格式稳定    │   │
│  └──────────────┘       └──────────────┘       └──────────────┘   │
│                                                                     │
│  特点：                                                              │
│  - 中不变性（可随版本升级）                                          │
│  - 影响当前业务流程                                                  │
│  - Flow 单元测试 + E2E 验证                                         │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 质量门控流程图

```
┌────────────────────────────────────────────────────────────────┐
│                      用户修改代码                               │
└────────────────┬───────────────────────────────────────────────┘
                 │
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  Hook: branch-protect.sh                                       │
│  检查：                                                         │
│  - 在正确分支？                                                 │
│  - PRD/DoD 存在？                                              │
│  - PRD/DoD 有效？                                              │
└────────────────┬───────────────────────────────────────────────┘
                 │ ✅ 通过
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  用户执行 Bash 命令（git commit / npm test / ...）             │
└────────────────┬───────────────────────────────────────────────┘
                 │
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  Hook: pr-gate-v2.sh                                           │
│  检查模式：                                                     │
│  - PR 模式：L1 + L2A + DoD + QA-DECISION                       │
│  - Release 模式：L1 + L2A + L2B + DoD + QA + Audit             │
└────────────────┬───────────────────────────────────────────────┘
                 │ ✅ 通过
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  DevGate 检查器执行                                             │
│  - check-dod-mapping.cjs                                       │
│  - require-rci-update-if-p0p1.sh                               │
│  - scan-rci-coverage.cjs                                       │
│  - l2a-check.sh                                                │
│  - l2b-check.sh                                                │
└────────────────┬───────────────────────────────────────────────┘
                 │ ✅ 通过
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  Skills 决策器生成证据                                          │
│  - /qa → QA-DECISION.md                                        │
│  - /audit → AUDIT-REPORT.md                                    │
│  - /assurance → GCI/RCI 更新                                   │
└────────────────┬───────────────────────────────────────────────┘
                 │ ✅ 通过
                 ▼
┌────────────────────────────────────────────────────────────────┐
│  CI 验证 Evidence                                              │
│  - QA-DECISION.md 存在且有效                                   │
│  - AUDIT-REPORT.md 存在且 L1+L2 清零                           │
│  - Release: .layer2-evidence.md 存在                           │
└────────────────┬───────────────────────────────────────────────┘
                 │ ✅ 通过
                 ▼
┌────────────────────────────────────────────────────────────────┐
│                      合并 PR                                    │
└────────────────────────────────────────────────────────────────┘
```

---

## 优先级映射流程

```
                    ┌─────────────┐
                    │  PR Title   │
                    │  Commit Msg │
                    └──────┬──────┘
                           │
                           ▼
              ┌────────────────────────┐
              │ detect-priority.cjs    │
              │ 自动检测优先级          │
              └────────┬───────────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
┌──────────┐   ┌──────────┐   ┌──────────┐
│CRITICAL  │   │  HIGH    │   │ MEDIUM   │
│security: │   │          │   │          │
└────┬─────┘   └────┬─────┘   └────┬─────┘
     │              │              │
     ▼              ▼              ▼
┌──────────┐   ┌──────────┐   ┌──────────┐
│   P0     │   │   P1     │   │   P2     │
└────┬─────┘   └────┬─────┘   └────┬─────┘
     │              │              │
     └──────┬───────┴──────────────┘
            │
            ▼
┌───────────────────────────┐
│ require-rci-update-if-    │
│ p0p1.sh                   │
│                           │
│ P0/P1 → 必须更新 RCI      │
└───────────────────────────┘
```

---

**Version**: 1.0.0
**Last Updated**: 2026-01-26
