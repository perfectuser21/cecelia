---
id: prd-brain-initiative-scanner
version: 1.0.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.0.0: 初始版本
---

# PRD: Brain Initiative 直连 KR 扫描修复

## 背景

`decomposition-checker.js` 的 `checkReadyKRInitiatives()` 使用 INNER JOIN 查找 Initiative：

```sql
FROM projects p
INNER JOIN projects parent ON p.parent_id = parent.id
INNER JOIN project_kr_links pkl ON pkl.project_id = parent.id
WHERE pkl.kr_id = $1
```

这会遗漏有直接 `p.kr_id` 但无 parent_id 的 Initiative（如 `dab60c16` 优化KR4任务派发策略）。
这些 Initiative 处于 `active` 状态、0 个活跃 task，但永远不会被扫描到。

## 目标

扩展 `checkReadyKRInitiatives` SQL，同时覆盖：
1. 通过 parent project → project_kr_links 链接的 Initiative（现有逻辑）
2. 有直接 `p.kr_id` 的 Initiative（新增）

## 成功标准

- `checkReadyKRInitiatives` 能找到有直接 `kr_id` 且无父 project 的 Initiative
- 为这类 Initiative 创建 `initiative_plan` 任务（带去重）
- 原有通过 parent project 链接的逻辑不受影响
- Brain tests 通过
