---
id: dod-wire-consciousness-pipeline
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# DoD: 打通 Cecelia 三条管道

## 断路 1: 感知层空闲时无输入
- [ ] perception.js 增加 `system_idle` 信号：无 in_progress 任务时产出"系统空闲"观察
- [ ] perception.js 增加 `user_online` 信号：检查 working_memory 中 `user_last_seen` 时间戳
- **Test**: 无任务运行时，runPerception 仍返回 >= 1 个 observation

## 断路 2: 表达决策阈值过高
- [ ] expression-decision.js 阈值从 0.6 降到 0.35
- [ ] 增加 `user_online_boost`：用户 5 分钟内在线时额外加 0.15
- [ ] `act` 类型 desire 跳过表达决策，直接进执行
- **Test**: urgency=5 的 inform desire + 用户在线 → 评分 > 0.35

## 断路 3: Desire 只有通知类型 → 增加行动类型
- [ ] desire-formation.js 增加 `act` 和 `follow_up` 类型
- [ ] desire-formation prompt 修改：允许 LLM 产出"我自己能做的事"
- **Test**: 给定"某任务卡了2小时"的 insight，生成 act 类型 desire

## 断路 4: Desire 输出 → 执行管道
- [ ] desire/index.js：act 类型 desire → 直接往 tasks 表插入 queued 任务
- [ ] tick.js：desireResult 中的 act 任务能被下一轮 planner 捡起
- **Test**: act desire 创建后，tasks 表中出现对应 queued 记录

## 断路 5: 用户在线影响 Cecelia 行为
- [ ] orchestrator-chat.js：收到消息时更新 working_memory `user_last_seen`
- [ ] orchestrator-chat.js：聊天消息写入 memory_stream（让 desire system 感知到对话）
- **Test**: 用户发消息后，working_memory 中 user_last_seen 更新

## 断路 6: 聊天中 thalamus 决策可执行
- [ ] orchestrator-chat.js：thalamus 返回 actions 时，对 safe actions 直接执行（create_task、adjust_priority）
- **Test**: 聊天发"帮我查 KR 进度"，thalamus 返回 log_event → 正常执行

## 表达渠道：飞书 → Dashboard WebSocket
- [ ] expression.js：输出从 sendFeishu 改为 WebSocket 广播 `desire:expressed` 事件
- [ ] 保留 sendFeishu 作为备用渠道（urgency >= 9 时同时发飞书）
- [ ] 更新 working_memory key 从 `last_feishu_at` 改为 `last_expression_at`
- **Test**: desire 表达后，WebSocket 收到 desire:expressed 事件
