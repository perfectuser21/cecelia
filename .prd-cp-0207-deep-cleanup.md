---
id: prd-cp-0207-deep-cleanup
version: 1.0.0
created: 2026-02-07
updated: 2026-02-07
changelog:
  - 1.0.0: 初始版本
---

# PRD: 深度清理 — Python 死代码 + Node.js 残留

## 需求来源

Brain 三层大脑架构（thalamus+cortex）设计完成后，仓库中仍残留大量旧代码：
1. Python Intelligence Service 的 parser/scheduler/planner/detector/core 已被 Node.js 完全替代
2. Node.js 侧有死文件（retry-analyzer.js）、死函数、死 mock
3. 旧配置文件指向不存在的路径
4. CI 还在测试已死的 Python 代码

## 功能描述

### A. Python 死代码删除
- 删除 `src/intelligence/` 目录（parser, scheduler, planner, detector）
- 删除 `src/core/` 目录（embedder, store, search, indexer, chunker, config）
- 删除 `src/cli/` 目录
- 删除对应测试：`tests/test_intelligence/`, `tests/test_db.py`, `tests/test_store.py`, `tests/test_search.py`, `tests/test_api.py`, `tests/test_chunker.py`, `tests/test_cli.py`, `tests/test_indexer.py`, `tests/test_performance.py`
- 删除 `src/api/semantic_routes.py`（依赖已删的 src/core/）
- 清理 `tests/conftest.py`（移除已删模块的 fixtures）
- 清理 `requirements.txt`（移除 chromadb, watchdog, langchain-text-splitters）
- 保留：patrol, agent_monitor, orchestrator_routes, cecelia_routes（仍在使用）

### B. Node.js 死代码清理
- 删除 `brain/src/retry-analyzer.js`（零 import）
- 清理 `callback-atomic.test.js` 中 5 个已删模块的 vi.mock
- ~~清理 `decision.js` 中死函数 `executeDecision()`~~ → 验证后发现仍在使用（routes.js + tick.js）
- ~~清理 `intent.js` 中死函数~~ → 验证后发现 `parseAndCreate()` 和 `getSuggestedAction()` 仍在使用

### C. 旧配置清理
- 删除 `sor/config.yaml`（全是错路径，无人引用）

### D. CI 更新
- 更新 `semantic-test` job 的 pytest 路径（排除已删测试目录）

## 成功标准

- 所有 Node.js 测试通过（npm test）
- 所有保留的 Python 测试通过（pytest）
- CI 通过
- facts-check + version-sync 通过
- 无残留 import 引用已删文件
