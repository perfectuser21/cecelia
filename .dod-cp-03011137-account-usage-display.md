# DoD: Account Usage 显示增强

## 验收清单

- [x] DB: account_usage_cache 新增 seven_day_sonnet_pct 和 seven_day_resets_at 列
  Test: manual:docker exec cecelia-postgres psql -U cecelia -d cecelia -c "\d account_usage_cache" | grep seven_day
- [x] account-usage.js: 缓存 TTL 从 10 分钟改为 3 分钟
  Test: manual:node -e "const src=require('fs').readFileSync('packages/brain/src/account-usage.js','utf8'); if(!src.includes('CACHE_TTL_MINUTES = 3')) throw new Error('TTL not 3 minutes');"
- [x] account-usage.js: 解析并存储 seven_day_sonnet_pct 和 seven_day_resets_at
  Test: manual:node -e "const src=require('fs').readFileSync('packages/brain/src/account-usage.js','utf8'); if(!src.includes('seven_day_sonnet_pct')) throw new Error('seven_day_sonnet_pct missing');"
- [x] account-usage.js: 返回对象包含两个新字段
  Test: manual:node -e "const src=require('fs').readFileSync('packages/brain/src/account-usage.js','utf8'); if(!src.includes('seven_day_resets_at')) throw new Error('seven_day_resets_at missing');"
- [x] Dashboard: AccountUsage 接口新增两个新字段
  Test: manual:node -e "const src=require('fs').readFileSync('apps/dashboard/src/pages/live-monitor/LiveMonitorPage.tsx','utf8'); if(!src.includes('seven_day_sonnet_pct')) throw new Error('interface field missing');"
- [x] Dashboard: 每个账号显示三行："5h:XX% ↺HH:MM"、"7d:XX% ↺M/D"、"son:XX%"
  Test: manual:node -e "const src=require('fs').readFileSync('apps/dashboard/src/pages/live-monitor/LiveMonitorPage.tsx','utf8'); if(!src.includes('son:')) throw new Error('son display missing');"
- [x] 测试：account-usage-scheduling 4 个测试全部通过
  Test: manual:npm --prefix packages/brain run test
- [x] Migration 097 文件已创建
  Test: manual:node -e "require('fs').statSync('packages/brain/migrations/097_account_usage_sonnet.sql'); console.log('migration 097 exists');"
