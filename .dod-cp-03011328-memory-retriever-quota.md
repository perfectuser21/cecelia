---
id: dod-memory-retriever-quota
version: 1.0.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.0.0: 初始版本
---

# DoD: 优化记忆检索系统（source 最小配额 + token 预算提升 + 动态权重调节）

## 验收清单

- [ ] **D1: Token 预算 2500（chat 模式）**
  - Test: `manual:bash -c "grep -q 'CHAT_TOKEN_BUDGET = 2500' packages/brain/src/memory-retriever.js"`

- [ ] **D2: fetchMemoryContext 传入 tokenBudget 2500**
  - Test: `manual:bash -c "grep -q 'tokenBudget: 2500' packages/brain/src/orchestrator-chat.js"`

- [ ] **D3: conversation 最多注入 4 条**
  - Test: `manual:npm run test --workspace packages/brain -- --run src/__tests__/memory-retriever-quota.test.js`

- [ ] **D4: tasks 至少注入 2 条（有候选时）**
  - Test: `manual:npm run test --workspace packages/brain -- --run src/__tests__/memory-retriever-quota.test.js`

- [ ] **D5: learnings 至少注入 2 条（有候选时）**
  - Test: `manual:npm run test --workspace packages/brain -- --run src/__tests__/memory-retriever-quota.test.js`

- [ ] **D6: 意图关键词分类正确**
  - Test: `manual:npm run test --workspace packages/brain -- --run src/__tests__/memory-retriever-quota.test.js`

- [ ] **D7: 动态权重调节影响候选排序**
  - Test: `manual:npm run test --workspace packages/brain -- --run src/__tests__/memory-retriever-quota.test.js`

- [ ] **D8: 所有现有测试通过**
  - Test: `manual:npm run test --workspace packages/brain`

- [ ] **D9: Brain patch 版本 bump**
  - Test: `manual:bash -c "cat packages/brain/package.json | grep version"`
