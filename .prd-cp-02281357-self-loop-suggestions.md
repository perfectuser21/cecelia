---
id: prd-self-loop-suggestions
version: 1.0.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
---

# PRD: PR-D — self_loop 渠道（rumination + desire → suggestion）

## 背景

PR-A/B/C 已完成 suggestion 管道的基础设施（scoring、loadActiveProfile 修复、owner_input 渠道）。
PR-D 打通 **self_loop 渠道**：让 Cecelia 内部的自主思考（rumination 反刍洞察、desire 愿望系统）
自动产生 suggestions，进入统一的 suggestion → triage → dispatch 管道。

## 目标

1. **rumination 渠道**：当洞察含 `[ACTION:]` 标记时，额外创建一条 suggestion（source='rumination', type='insight_action'），每次 tick 最多 2 条（limit 防洪峰）
2. **desire 渠道**：当 `act/propose/warn` 类型的 desire 通过 expression 决策时，额外创建一条 suggestion（source='desire_system'），不阻塞原有流程

## 范围

- **修改** `packages/brain/src/rumination.js` — 约 +15 行
- **修改** `packages/brain/src/desire/index.js` — 约 +20 行
- **无** 数据库变更（复用已有 suggestions 表）
- **新增** 测试文件覆盖两个新渠道

## 成功标准

- rumination.js 在检测到 `[ACTION:]` 洞察时调用 createSuggestion，limit=2
- desire/index.js 在 act/propose/warn desire 表达决策后调用 createSuggestion，不阻塞
- 所有已有测试通过（无回归）
- 版本号 minor bump（新增功能）
