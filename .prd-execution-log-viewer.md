# PRD - 执行日志查看页面

## 背景
任务来自 Brain 自动调度。
任务类型：dev

## 功能描述
为 Cecelia 系统添加执行日志查看页面，支持流式展示和筛选功能。用户可以实时查看任务执行过程中的日志输出，并通过筛选条件快速定位关键信息。

## 需求来源
用户需求："添加执行日志流式展示和筛选功能"

## 功能要点

### 1. 流式日志展示
- 实时展示任务执行日志
- 支持自动滚动到最新日志
- 支持暂停自动滚动（用户手动滚动时）
- 日志条目包含：时间戳、级别、来源、消息内容

### 2. 日志筛选
- 按日志级别筛选（DEBUG、INFO、WARN、ERROR）
- 按时间范围筛选
- 按关键字搜索
- 支持多条件组合筛选

### 3. 日志导出
- 支持导出当前筛选结果为文本文件
- 支持导出完整日志

### 4. 性能优化
- 虚拟滚动处理大量日志
- 懒加载历史日志
- 合理的日志缓存策略

## 涉及文件

### 前端（Frontend）
- `frontend/src/pages/ExecutionLogViewer.tsx` - 主页面组件（新建）
- `frontend/src/components/logs/LogViewer.tsx` - 日志展示组件（新建）
- `frontend/src/components/logs/LogFilter.tsx` - 筛选组件（新建）
- `frontend/src/components/logs/LogEntry.tsx` - 单条日志组件（新建）
- `frontend/src/services/logService.ts` - 日志服务（新建）
- `frontend/src/router.tsx` - 添加路由

### 后端（Backend）
- `backend/src/routes/logs.ts` - 日志路由（新建）
- `backend/src/services/LogService.ts` - 日志服务（新建或修改现有）
- `backend/src/types/log.types.ts` - 日志类型定义（新建）

### WebSocket（实时推送）
- `backend/src/websocket/logHandler.ts` - WebSocket 日志推送（新建或修改现有）

## 成功标准

### 功能完整性
- [ ] 页面能正确展示执行日志
- [ ] 支持实时流式更新
- [ ] 筛选功能正常工作
- [ ] 导出功能正常工作

### 性能要求
- [ ] 10000 条日志渲染流畅（<100ms 响应）
- [ ] WebSocket 连接稳定
- [ ] 内存占用合理（不超过 200MB）

### 用户体验
- [ ] 界面清晰易用
- [ ] 自动滚动体验流畅
- [ ] 筛选响应迅速
- [ ] 错误提示友好

### 代码质量
- [ ] TypeScript 类型完整
- [ ] 组件解耦合理
- [ ] 有基础单元测试
- [ ] 代码符合项目规范

## 非目标
- 不实现日志分析和统计功能（后期迭代）
- 不实现日志告警功能
- 不支持多任务日志对比查看
- 不实现日志持久化到数据库（使用现有机制）

## 技术方案建议

### 前端技术栈
- React + TypeScript
- WebSocket 或 EventSource 实现流式传输
- react-window 或 react-virtualized 实现虚拟滚动
- Tailwind CSS 样式

### 后端技术栈
- Express.js 路由
- WebSocket (ws 库) 或 Server-Sent Events
- 日志来源：现有的任务执行日志系统

### 数据流
```
任务执行 → 生成日志 → 后端日志服务 → WebSocket/SSE → 前端展示
                      ↓
                  存储到文件/数据库
```

## 依赖关系
- 依赖现有的任务执行系统
- 依赖 WebSocket 基础设施（如已有）
- 需要确认日志存储格式和位置

## 风险和注意事项
- 大量日志可能导致前端性能问题（需要虚拟滚动）
- WebSocket 连接稳定性（需要重连机制）
- 日志文件可能很大（需要分页或限制展示数量）
- 多用户同时查看可能增加服务器负载

## 预估工作量
- 前端开发：4-6 小时
- 后端开发：2-3 小时
- 测试和优化：2 小时
- 总计：8-11 小时
