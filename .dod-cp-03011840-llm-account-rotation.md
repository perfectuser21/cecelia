---
id: dod-llm-account-rotation
version: 1.4.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.4.0: 修正 Test 命令格式（用 node 代替 grep，修正测试路径）
  - 1.3.0: 使用 manual:curl 内联命令格式并标记验证
  - 1.2.0: 修正 Test 字段格式
  - 1.1.0: 补充 Test 字段
  - 1.0.0: 初始版本
---

# DoD: llm-caller 账号轮换

## 验收清单

- [x] 1. `llm-caller.js` 调用 `/llm-call` 时传入 `configDir` 字段
  Test: manual:node -e "const fs=require('fs');const c=fs.readFileSync('packages/brain/src/llm-caller.js','utf8');process.exit(c.includes('configDir')?0:1)"
- [x] 2. bridge `/llm-call` 支持 `configDir` 参数，传给 claude 的 `CLAUDE_CONFIG_DIR` 环境变量
  Test: manual:node -e "const fs=require('fs');const c=fs.readFileSync('/home/xx/bin/cecelia-bridge-new.js','utf8');process.exit(c.includes('CLAUDE_CONFIG_DIR')?0:1)"
- [x] 3. `selectBestAccount()` 失败时 fallback 到无 configDir（不阻塞）
  Test: manual:node -e "const fs=require('fs');const c=fs.readFileSync('packages/brain/src/llm-caller.js','utf8');process.exit(c.includes('catch')&&c.includes('fallback')?0:1)"
- [x] 4. Brain 测试通过
  Test: manual:cd packages/brain && npx vitest run --exclude=src/__tests__/blocks.test.js --reporter=verbose 2>&1 | grep -E "Test Files"
- [x] 5. 版本 patch bump v1.141.14 → v1.141.15
  Test: manual:node -e "const p=require('./packages/brain/package.json');process.exit(p.version==='1.141.15'?0:1)"
