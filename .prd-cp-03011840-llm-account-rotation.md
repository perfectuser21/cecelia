---
id: prd-llm-account-rotation
version: 1.0.0
created: 2026-03-01
updated: 2026-03-01
changelog:
  - 1.0.0: 初始版本
---

# PRD: llm-caller 接入账号轮换

## 背景

Brain 大脑思考调用（mouth/thalamus/cortex/emotion 等）通过 `llm-caller.js` 调用 bridge `/llm-call`。
当前 bridge 死绑使用 `~/.claude`（account1），不做账号轮换。

已有系统：
- `account-usage.js` 有 `selectBestAccount()` 函数，能选配额最低的账号
- `cecelia-run` 任务执行时通过 `CLAUDE_CONFIG_DIR` 切换账号
- `cecelia-bridge.js` 的 `/llm-call` endpoint 接受 `configDir` 参数（需确认）

问题：account1 的 sonnet 配额耗尽后，大脑思考调用全部失败，Cecelia 无法正常对话。

## 目标

`llm-caller.js` 在调用 bridge `/llm-call` 时，自动选择配额最优的账号，
通过在请求体中传入 `configDir` 参数，bridge 使用对应的 `CLAUDE_CONFIG_DIR` 执行 claude 命令。

## 成功标准

1. account1 sonnet 配额耗尽时，自动切换到 account2/account3
2. 不影响现有 haiku/sonnet/opus 调用
3. 若 `selectBestAccount()` 失败，fallback 到默认行为（不传 configDir）
4. Brain 测试全部通过
