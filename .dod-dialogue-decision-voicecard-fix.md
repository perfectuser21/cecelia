---
id: dod-dialogue-decision-voicecard-fix
version: 1.0.0
created: 2026-02-26
updated: 2026-02-26
changelog:
  - 1.0.0: 初始版本
---

# DoD: 对话式决策 + VoiceCard 智能简报

## 验收清单

### D1: VoiceCard 永远有内容
- [ ] VoiceCard 不再返回 null（去除空状态）
- [ ] 有 desire:expressed → 展示 desire 表达内容
- [ ] 无 desire 时 → 展示 briefing 智能简报（任务进展、运行中、排队中）
- [ ] briefing 数据来自 useBriefing hook 的 since_last_visit 和 running_tasks
- **Test**: VoiceCard 渲染测试 — 无 expression 无 greeting 时仍有 fallback 内容

### D2: DecisionInbox 对话式决策
- [ ] 每个 desire 决策项展开后有文字输入框（textarea）
- [ ] 用户输入意见后点"回复" → POST /api/brain/desires/:id/respond
- [ ] 回复后 desire 自动变为 acknowledged 并从列表移除
- [ ] 保留派发功能（queued tasks 部分不变）
- **Test**: 后端 respond API 测试 — 正常回复 + 空内容拒绝 + desire 不存在 404

### D3: 后端 Respond API
- [ ] 新增 POST /api/brain/desires/:id/respond
- [ ] 接收 body: { message: string }
- [ ] 将用户回复写入 memory_stream（event_type='user_desire_response'）
- [ ] 将 desire status 更新为 acknowledged
- [ ] 广播 WebSocket 事件 desire:updated
- **Test**: inner-life 和 respond API 单元测试

### D4: 前端构建 + 后端测试
- [ ] `cd apps/api && npx vite build` 成功
- [ ] `cd packages/brain && npm test -- --testPathPattern="inner-life|desire-respond"` 通过
