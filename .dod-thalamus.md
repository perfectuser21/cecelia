# DoD - Cecelia 丘脑 (Thalamus) 事件路由器

QA: docs/QA-DECISION.md

## 验收标准

### 功能验收

- [ ] thalamus.js 实现事件分析
      Test: brain/src/__tests__/thalamus.test.js

- [ ] decision-executor.js 实现决策执行
      Test: brain/src/__tests__/decision-executor.test.js

- [ ] Validator 验证 Decision 合法性
      Test: brain/src/__tests__/thalamus.test.js

- [ ] 快速路由处理简单事件（不调 LLM）
      Test: brain/src/__tests__/thalamus.test.js

- [ ] 降级机制：Sonnet 失败时回退到代码
      Test: brain/src/__tests__/thalamus.test.js

- [ ] 单元测试覆盖核心逻辑
      Test: brain/src/__tests__/thalamus.test.js, brain/src/__tests__/decision-executor.test.js

- [ ] 接入 Tick 事件流
      Test: manual:验证 Tick 事件能触发 Thalamus 处理

### 测试验收

- [ ] npm run test 通过
      Test: contract:C2-001

## 技术规格

### Decision Schema

```typescript
interface Decision {
  level: 0 | 1 | 2;  // 0=脑干, 1=快速判断, 2=深度思考
  actions: Action[];  // 要执行的动作列表
  rationale: string;  // 决策原因
  confidence: number; // 0-1 置信度
  safety: boolean;    // 是否需要人确认
}
```

### Action 白名单

- dispatch_task, create_task, cancel_task, retry_task, reprioritize_task
- create_okr, update_okr_progress, assign_to_autumnrice
- notify_user, log_event
- escalate_to_brain, request_human_review
- analyze_failure, predict_progress
- no_action, fallback_to_tick

### 三层处理

| 级别 | 处理者 | 触发条件 |
|------|--------|----------|
| 0 | 脑干 (代码) | 心跳、简单派发 |
| 1 | 快速反应 (Sonnet) | 需要判断但不复杂 |
| 2 | 深度思考 (Opus) | 复杂决策、异常分析 |
