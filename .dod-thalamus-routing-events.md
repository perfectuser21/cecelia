## DoD - Thalamus.js 路由决策事件记录

### 验收清单

- [ ] **DoD-1**: quickRoute 命中时（快速路由），fire-and-forget 写入 cecelia_events，event_type=routing_decision，payload 含 route_type="quick_route"
  - Test: 测试 processEvent 对 HEARTBEAT 事件调用后，pool.query 被调用并含 quick_route

- [ ] **DoD-2**: Sonnet LLM 路由成功时，fire-and-forget 写入 cecelia_events，event_type=routing_decision，payload 含 route_type="llm_route"
  - Test: mock analyzeEvent 返回 level=1 decision，验证 routing_decision 写入含 llm_route

- [ ] **DoD-3**: Cortex 升级时（level=2），fire-and-forget 写入 cecelia_events，event_type=routing_decision，payload 含 route_type="cortex_route"
  - Test: mock analyzeEvent 返回 level=2，mock cortex.js，验证写入含 cortex_route

- [ ] **DoD-4**: fallback 降级时（LLM 失败），fire-and-forget 写入 cecelia_events，event_type=routing_decision，payload 含 route_type="fallback_route"
  - Test: mock analyzeEvent 抛出错误，验证 routing_decision 写入含 fallback_route

- [ ] **DoD-5**: 每个 routing_decision 事件的 payload 包含必要字段：route_type, event_type, confidence, level, actions_count, latency_ms
  - Test: 验证 payload 结构符合规范

- [ ] **DoD-6**: 事件记录不阻塞主路径（fire and forget，Promise 不 await）
  - Test: processEvent 的 latency 不因 DB 写入延迟增加（mock pool.query 加 50ms delay，主路径不受影响）

- [ ] **DoD-7**: 测试文件 src/__tests__/thalamus-routing-events.test.js 存在且通过
  - Test: npm test -- thalamus-routing-events 全部通过

### 技术实现要点

1. 新增 `recordRoutingDecision(routeType, event, decision, latencyMs)` 辅助函数
2. 在 processEvent() 的四个路径插入 fire-and-forget 调用
3. 使用 `.catch(err => console.error(...))` 确保不阻塞
4. source 字段统一使用 'thalamus'
