# Redline Policies（红线策略）

**小审专用** - 违反任何一条立即打回。

## 一、安全红线

### 1. 密钥/凭据保护

- ❌ 禁止在代码中硬编码密钥
- ❌ 禁止在日志中输出密钥
- ❌ 禁止将密钥提交到 Git
- ❌ 禁止在 evidence 中包含密钥

**检查方式**：扫描 output 中是否包含 `API_KEY`, `SECRET`, `TOKEN`, `PASSWORD` 等模式

### 2. 隐私数据保护

- ❌ 禁止泄露用户隐私（手机号、身份证、地址）
- ❌ 禁止爬取需要登录的私密内容
- ❌ 禁止存储未脱敏的用户数据

### 3. 系统安全

- ❌ 禁止执行 `rm -rf /` 等危险命令
- ❌ 禁止删除关键数据（数据库、配置文件）
- ❌ 禁止未授权的端口暴露
- ❌ 禁止绕过认证

## 二、合规红线

### 1. 内容合规

- ❌ 禁止发布政治敏感内容
- ❌ 禁止发布色情/暴力内容
- ❌ 禁止发布虚假信息
- ❌ 禁止侵犯版权

**检查方式**：外发内容必须经过敏感词过滤

### 2. 平台合规

- ❌ 禁止违反平台 ToS（爬虫频率、自动化发布等）
- ❌ 禁止使用被封禁的账号
- ❌ 禁止伪造用户身份

### 3. 数据合规

- ❌ 禁止超出授权范围的数据采集
- ❌ 禁止将数据用于未授权用途
- ❌ 禁止向第三方泄露数据

## 三、运行红线

### 1. 任务追踪

- ❌ 禁止执行没有 task_id 的任务
- ❌ 禁止不写回执（evidence）的执行
- ❌ 禁止篡改 task_id 或 evidence

### 2. 资源保护

- ❌ 禁止单任务运行超过 1 小时
- ❌ 禁止并发超过 10 个相同类型任务
- ❌ 禁止占用超过 80% 系统资源

### 3. 成本控制

- ❌ 禁止单次 API 调用超过 $10
- ❌ 禁止无限重试（最多 3 次）
- ❌ 禁止死循环

## 四、打回级别

| 级别 | 说明 | 后果 |
|------|------|------|
| **L1** | 阻塞性 - 安全/合规红线 | 立即停止，通知用户 |
| **L2** | 功能性 - 任务未完成 | 打回重做 |
| **L3** | 最佳实践 - 质量问题 | 记录但不阻塞 |
| **L4** | 建议 - 可以更好 | 仅记录 |

## 五、打回模板

```json
{
  "rejected_by": "xiaoshen",
  "reason": "代码中包含硬编码的 API_KEY",
  "level": "L1",
  "policy_violated": "security.credential_protection",
  "action_required": "移除硬编码密钥，使用环境变量或 ~/.credentials/"
}
```

## 六、审计日志

每次审计必须记录：

```json
{
  "audit_id": "audit-xxx",
  "task_id": "task-xxx",
  "auditor": "xiaoshen",
  "timestamp": "2026-01-30T10:00:00Z",
  "policies_checked": [
    "security.credential_protection",
    "security.privacy_data",
    "compliance.content"
  ],
  "result": "pass" | "reject",
  "notes": "..."
}
```
