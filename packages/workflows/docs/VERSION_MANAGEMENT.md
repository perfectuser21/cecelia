# N8N Workflow 版本管理指南

## 命名规范

### 格式
```
[类型] 功能名 v版本号 (日期) [可选标签]
```

### 示例
```
✅ 正确：
[Flow] 数据采集调度器 v1.2 (20260126)
[Unit] 小红书数据爬取 v2.0 (20260120)
[Flow] 内容发布 v1.0-beta (20260125)

❌ 错误：
数据采集调度器-v1.2
flow_data_collector_v1.2
数据采集调度器（最新版）
```

## 版本号规则

### 语义化版本（推荐）

```
v主版本.次版本.修订号

v1.0.0 → v1.1.0 → v1.1.1 → v2.0.0
```

**何时增加**：
- **主版本**：重大变更，不兼容旧版（v1.x → v2.0）
- **次版本**：新增功能，向后兼容（v1.1 → v1.2）
- **修订号**：Bug 修复（v1.1.0 → v1.1.1）

### 简化版本（也可以）

```
v1 → v2 → v3

适合快速迭代，不需要那么详细
```

## 状态管理

### 利用 N8N 原生功能

| 状态 | N8N 操作 | 说明 |
|------|---------|------|
| 🟢 **激活中** | Active = ON | 当前运行版本 |
| ⚪ **待测试** | Active = OFF | 开发中或测试版本 |
| 📦 **已归档** | 移到 Archive 文件夹 | 旧版本，保留以备回滚 |

### 文件夹组织

```
📁 Cecelia
  🟢 [Flow] Cecelia 任务启动器 v2.1 (20260126)  ← 当前版本
  
📁 自媒体
  🟢 [Flow] 数据采集调度器 v1.2 (20260126)
  ⚪ [Flow] 数据采集调度器 v1.3-beta (20260126)  ← 测试版
  
📁 Archive
  ⚪ [Flow] Cecelia 任务启动器 v2.0 (20260120)  ← 旧版本
  ⚪ [Flow] 数据采集调度器 v1.1 (20260120)
  ⚪ [Flow] 数据采集调度器 v1.0 (20260115)
```

## 版本迭代流程

### 标准流程

```
1. 复制当前版本
   [Flow] 数据采集 v1.1 (20260120)
   复制为 →
   [Flow] 数据采集 v1.2 (20260126)

2. 修改新版本
   在 N8N 编辑器中修改 v1.2

3. 测试
   v1.2 保持 inactive
   手动触发测试

4. 上线
   激活 v1.2（自动停用 v1.1）

5. 归档旧版本
   将 v1.1 移到 Archive 文件夹
   （保留一段时间，以备回滚）
```

### 快速热修复流程

```
发现 Bug
  ↓
复制当前版本
  [Flow] 数据采集 v1.2 (20260126)
  复制为 →
  [Flow] 数据采集 v1.2.1 (20260126)  ← 修订号+1
  ↓
修复 Bug
  ↓
快速测试
  ↓
立即激活 v1.2.1
  ↓
归档 v1.2
```

## N8N 原生版本历史

### 查看历史
```
1. 打开任意 workflow
2. 点击右上角 "History" 或 "⏱️" 图标
3. 查看所有自动保存的版本
```

### 恢复历史版本
```
1. 在 History 中选择某个历史版本
2. 点击 "Restore" 或 "恢复"
3. N8N 会创建新版本（不会覆盖当前）
```

**提示**：N8N 的版本历史是**自动保存的额外保险**，不替代手动版本管理。

## 描述字段的使用

在 workflow 的 Settings 中添加描述：

```
版本：v1.2
日期：2026-01-26
变更：
- 新增抖音平台支持
- 优化错误重试逻辑
- 修复小红书数据格式问题

作者：Alex
测试：已通过 100 条数据测试
```

## 回滚策略

### 何时需要回滚

- 新版本出现严重 Bug
- 性能下降
- 数据错误

### 回滚步骤

```
方式 1：快速回滚（推荐）
  1. 停用有问题的版本
  2. 激活 Archive 中的旧版本
  3. 调查问题

方式 2：从 Git 恢复（如果旧版本被删除）
  1. git log 找到旧版本的 commit
  2. git checkout <commit> -- n8n/workflows/xxx.json
  3. ./scripts/import-to-n8n.sh
```

## 清理策略

### 何时清理

- 每季度或每半年
- 新版本稳定运行 1 个月后
- Archive 文件夹超过 20 个 workflows

### 清理规则

**保留**：
- 当前激活版本
- 最近 2 个旧版本
- 重要里程碑版本（v1.0, v2.0等）

**删除**：
- 3 个月前的测试版本
- 已被替代且无特殊价值的版本

## 版本命名速查表

| 场景 | 命名示例 |
|------|---------|
| 首次发布 | `[Flow] 数据采集 v1.0 (20260126)` |
| 新增功能 | `[Flow] 数据采集 v1.1 (20260201)` |
| Bug 修复 | `[Flow] 数据采集 v1.1.1 (20260202)` |
| 重大改版 | `[Flow] 数据采集 v2.0 (20260301)` |
| 测试版本 | `[Flow] 数据采集 v1.2-beta (20260126)` |
| 紧急修复 | `[Flow] 数据采集 v1.1.2-hotfix (20260126)` |

## 工具和自动化

### 定期备份到 Git

```bash
# 每周日凌晨 2 点自动备份
0 2 * * 0 ./scripts/backup-to-git.sh
```

### 批量重命名（如果需要）

可以用脚本批量添加版本号和日期到现有 workflows。
