# DoD - Initiative 4-Phase 编排系统 PR1: Migration + 数据层

## 验收标准

### D1: Migration 057 — initiative_orchestration
- [ ] projects 表新增 execution_mode TEXT DEFAULT 'simple'
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] projects 表新增 current_phase TEXT DEFAULT NULL
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] projects 表新增 dod_content JSONB DEFAULT NULL
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] tasks.task_type CHECK 扩展含 initiative_plan, initiative_verify
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] 索引 idx_projects_execution_mode (WHERE orchestrated)
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] 索引 idx_projects_current_phase (WHERE NOT NULL)
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js
- [ ] schema_version 插入 '057'
      Test: brain/src/__tests__/initiative-orchestration-migration.test.js

### D2: selfcheck.js
- [ ] EXPECTED_SCHEMA_VERSION = '057'
      Test: brain/src/__tests__/selfcheck.test.js

### D3: task-router.js 路由扩展
- [ ] LOCATION_MAP['initiative_plan'] === 'us'
      Test: brain/src/__tests__/task-router-initiative.test.js
- [ ] LOCATION_MAP['initiative_verify'] === 'us'
      Test: brain/src/__tests__/task-router-initiative.test.js
- [ ] isValidTaskType('initiative_plan') === true
      Test: brain/src/__tests__/task-router-initiative.test.js
- [ ] isValidTaskType('initiative_verify') === true
      Test: brain/src/__tests__/task-router-initiative.test.js

### D4: actions.js createInitiative 扩展
- [ ] 支持 execution_mode 参数（'simple' | 'orchestrated'）
      Test: brain/src/__tests__/actions-initiative-orchestration.test.js
- [ ] 支持 dod_content 参数（JSONB）
      Test: brain/src/__tests__/actions-initiative-orchestration.test.js
- [ ] orchestrated initiative: current_phase='plan', status='active'
      Test: brain/src/__tests__/actions-initiative-orchestration.test.js
- [ ] simple initiative: current_phase=NULL, status='active'（不变）
      Test: brain/src/__tests__/actions-initiative-orchestration.test.js
- [ ] 向后兼容：不传 execution_mode 默认 'simple'
      Test: brain/src/__tests__/actions-initiative-orchestration.test.js

### D5: CI/CD
- [ ] CI 通过
      Test: contract:C1-001
- [ ] Facts Check 通过
      Test: contract:C1-002
