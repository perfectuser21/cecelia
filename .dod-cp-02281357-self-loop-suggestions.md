---
id: dod-self-loop-suggestions
version: 1.0.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
---

# DoD: self_loop 渠道（PR-D）

## 验收清单

- [x] **DOD-1**: rumination.js [ACTION:] 洞察 → createSuggestion(source='rumination', type='insight_action')
  Test: manual: npx vitest run packages/brain/src/__tests__/rumination-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-1"

- [x] **DOD-2**: rumination suggestion limit=2（3 个 [ACTION:] → 最多 2 条 suggestion）
  Test: manual: npx vitest run packages/brain/src/__tests__/rumination-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-2"

- [x] **DOD-3**: rumination createSuggestion 失败不影响消化流程
  Test: manual: npx vitest run packages/brain/src/__tests__/rumination-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-3"

- [x] **DOD-4**: act desire → createSuggestion(source='desire_system')
  Test: manual: npx vitest run packages/brain/src/__tests__/desire-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-4"

- [x] **DOD-5**: warn desire → createSuggestion(source='desire_system')
  Test: manual: npx vitest run packages/brain/src/__tests__/desire-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-5"

- [x] **DOD-6**: propose desire → createSuggestion(source='desire_system')
  Test: manual: npx vitest run packages/brain/src/__tests__/desire-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-6"

- [x] **DOD-7**: follow_up desire → 不创建 suggestion（仅创建 task）
  Test: manual: npx vitest run packages/brain/src/__tests__/desire-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-7"

- [x] **DOD-8**: desire createSuggestion 失败不阻塞原有流程
  Test: manual: npx vitest run packages/brain/src/__tests__/desire-suggestions.test.js --reporter=verbose 2>&1 | grep "DOD-8"

- [x] **DOD-9**: 所有已有测试通过（无回归）
  Test: manual: npx vitest run packages/brain/src/__tests__/rumination.test.js packages/brain/src/__tests__/desire-system.test.js 2>&1 | grep "passed"

- [x] **DOD-10**: 版本号 bump（minor，新增功能，>= 1.132.0）
  Test: manual: node -e "const v=require('./packages/brain/package.json').version;process.exit(v>='1.132.0'?0:1)"
