---
id: prd-cp-02281925-cognitive-decision-loop
version: 1.0.0
created: 2026-02-28
updated: 2026-02-28
changelog:
  - 1.0.0: 初始版本
---

# PRD: Cecelia 认知-决策双闭环

## 背景

PR #164 实现了 8 个认知系统，但所有系统仍是"只读感知"——
`evaluateEmotion()` 返回的 `dispatch_rate_modifier` 从未被应用，
`rumination/cortex` 洞察写进 `learnings` 表但没有影响 KR 选择权重。

## 目标

**方向1：情绪 → 调度**（`tick.js`）
- 情绪评估时使用真实的 queueDepth + successRate（当前硬编码为 0/1.0）
- 将 `dispatch_rate_modifier` 乘入 `effectiveDispatchMax` 计算
- 硬门禁：`overloaded` 状态跳过本轮派发，`anxious` 限制最大派发数

**方向3：反刍 → 计划**（`planner.js`）
- 新增 `buildInsightAdjustments(krIds)` 函数：查询最近 7 天 learnings 表
  中 KR 相关的洞察（`cortex_insight`、`rumination`、`success_pattern`），
  返回 KR → 得分调整量的映射
- 在 `scoreKRs()` 中注入洞察调整量（success +5, failure_pattern -10,
  cortex_insight warning -8）

**顺带修复**
- `cognitive-core.js` 叙事 importance 0.6 → 6

## 成功标准

1. 当情绪为 `overloaded` 时，tick 日志出现"情绪过载，跳过派发"
2. `effectiveDispatchMax` 计算包含情绪修正系数
3. `scoreKRs()` 包含来自 learnings 的 insight 调整量
4. 所有现有测试继续通过
5. Brain CI 通过
