---
id: dod-okr-decomp-approval
version: 1.0.0
created: 2026-02-27
updated: 2026-02-27
changelog:
  - 1.0.0: 初始版本
---

# DoD: OKR 拆解确认门

## 验收清单

- [ ] **改动 1：decision-executor.js 添加 okr_decomp_review handler**
  - Test: actionHandlers 包含 `okr_decomp_review` 函数
  - Test: 调用 handler 时执行 `UPDATE goals SET status='ready'` where kr_id matches

- [ ] **改动 2：routes.js execution-callback 创建 pending_action**
  - Test: 秋米拆解完成（KR decomposing → reviewing）后，pending_actions 有 okr_decomp_review 记录
  - Test: pending_action.context 包含 kr_title、project_name、initiatives 数组、decomposed_at
  - Test: pending_action.params 包含 kr_id 和 project_id
  - Test: 签名去重：同一 kr_id 24h 内不重复创建

- [ ] **改动 3：orchestrator-chat.js 注入 pending reviews**
  - Test: handleChat system prompt 包含 "待用户确认的 OKR 拆解"（当有 okr_decomp_review pending 时）
  - Test: 无待确认拆解时，system prompt 不含该段落

- [ ] **改动 4：ProposalCard.tsx 支持 okr_decomp_review 类型**
  - Test: TYPE_CONFIG 包含 okr_decomp_review 条目
  - Test: 卡片显示 KR 标题和 Initiative 列表
  - Test: 按钮文本改为"确认放行"和"需要调整"

- [ ] **版本 bump**
  - Brain: patch bump (routes.js + decision-executor.js + orchestrator-chat.js)
  - Workspace: patch bump (ProposalCard.tsx)
