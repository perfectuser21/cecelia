---
id: prd-cp-02211139-alertness-recovery-fix
version: 1.0.0
created: 2026-02-21
updated: 2026-02-21
changelog:
  - 1.0.0: 初始版本
---

## PRD - Alertness 渐进式恢复 Bug 修复

**需求来源**: 观察到 Brain alertness 在 CPU 恢复正常后持续卡在 ALERT 状态 42+ 分钟，导致 escalation 批量取消真实 dev 任务，系统无法产出有效工作。

**功能描述**:
修复 `brain/src/alertness/index.js` 中 `evaluateAlertness()` 函数的渐进式恢复逻辑 bug。

当前 bug 流程：
1. CPU 高负载 → ALERT (3)
2. CPU 恢复正常 → healthScore = 100 → targetLevel = CALM (1)
3. `checkTransitionRules(ALERT=3, CALM=1)`: diff=2 > 1 → BLOCKED（渐进式恢复规则）
4. 代码不处理 blocked 情况 → 什么都不做 → 永远卡在 ALERT

**涉及文件**:
- `brain/src/alertness/index.js`（修改 `evaluateAlertness()` 函数）
- `brain/src/__tests__/alertness-recovery.test.js`（新增回归测试）

**成功标准**:
1. ALERT 状态下，若 targetLevel < currentLevel 但被跳级规则 block，自动降一级（ALERT → AWARE）
2. 下次 tick AWARE 再评估，若指标仍健康，降到 CALM
3. 新增测试覆盖：ALERT→AWARE→CALM 两步渐进恢复路径
4. 现有测试不回归

**非目标**:
- 不修改 `checkTransitionRules` 的逻辑
- 不修改 `determineTargetLevel` 的逻辑
- 不改变任何其他 alertness 行为
