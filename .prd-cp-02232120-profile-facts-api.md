# PRD: Profile Facts 管理 API

## 背景

`user_profile_facts` 表目前是黑箱，用户无法查看或管理 Cecelia 对自己的记忆。
需要提供 CRUD API，让 Workspace 做记忆管理界面。

## 目标

提供完整的 `/api/brain/profile/facts` REST API，支持：
1. 列出所有记忆条目
2. 手动添加一条记忆
3. 编辑记忆内容
4. 删除记忆
5. 批量导入（文本/文件 → LLM 拆解 → 入库）

## API 设计

### GET /api/brain/profile/facts
列出所有 facts，按创建时间倒序。

Query params: `?limit=50&offset=0&category=identity`

Response:
```json
{
  "facts": [
    {
      "id": "uuid",
      "category": "identity",
      "content": "姓名是徐啸，英文名 Alex Xu",
      "has_embedding": true,
      "created_at": "2026-02-23T13:00:00Z"
    }
  ],
  "total": 12
}
```

### POST /api/brain/profile/facts
手动添加一条 fact。

Body: `{ "content": "偏好简洁的中文回答", "category": "preference" }`

Response: `{ "id": "uuid", "content": "...", "category": "..." }`

添加后异步触发 embedding（fire-and-forget）。

### PUT /api/brain/profile/facts/:id
编辑 fact 内容。

Body: `{ "content": "新内容", "category": "work_style" }`

编辑后清空旧 embedding，异步重新生成。

### DELETE /api/brain/profile/facts/:id
删除一条 fact。

Response: `{ "deleted": true }`

### POST /api/brain/profile/facts/import
批量导入：接收文本内容 → MiniMax 拆解成 facts → 批量入库 + embedding。

Body: `{ "text": "我叫徐啸，是一个独立创业者...", "category": "auto" }`

Response: `{ "imported": 8, "facts": ["姓名是徐啸", "..."] }`

## Category 枚举

- `identity`：身份信息（姓名、背景）
- `preference`：偏好（回答风格、工具偏好）
- `work_style`：工作方式
- `focus`：当前重心/目标
- `other`：其他

## 技术约束

- user_id 固定为 `'owner'`（单用户系统）
- 所有端点挂在 `/api/brain/profile/facts`
- 导入端点使用 MiniMax 拆解（已有凭据）
- embedding 生成 fire-and-forget（已有 generateProfileFactEmbeddingAsync）
- 本版本只支持文本输入，文件解析留给 Workspace 端处理

## 验收标准

- [ ] GET 返回正确的 facts 列表和 total
- [ ] POST 成功创建 fact 并触发 embedding
- [ ] PUT 更新 fact 内容并重置 embedding
- [ ] DELETE 删除指定 fact
- [ ] POST /import 拆解文本并批量入库
- [ ] 所有端点有单元测试覆盖
