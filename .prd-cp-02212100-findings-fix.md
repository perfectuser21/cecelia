---
id: prd-cp-findings-fix
version: 1.0.0
created: 2026-02-21
updated: 2026-02-21
changelog:
  - 1.0.0: 初始版本
---

# PRD: 修复 Exploratory Findings 传递断链

## 背景

Cecelia 的 exploratory → dev 流程设计上是：

```
exploratory 任务完成 → findings 写回 Brain → 探索续拆读 findings → dev 任务有上下文
```

但实际调查（2026-02-21 架构审查）发现：
- 所有 exploratory 任务完成后 `payload.findings = NULL`
- 所有 exploratory 任务 `description = ""（空）`
- "探索续拆"任务拿到的是空 findings，description 变成空模板
- dev 任务没有任何调研结论支撑，CI 失败率高

## 根因

exploratory skill 完成后应该通过 execution-callback 把 findings 写回 task.result/payload，
但 routes.js 的 execution-callback 处理逻辑没有将 result 内容存入 task.payload.findings。

decomp-checker 的 checkExploratoryDecompositionContinue() 读取：
```javascript
const findings = expTask.payload?.findings || expTask.payload?.result || '';
```
由于两个字段都为空，findings 为空字符串。

## 功能描述

修复 exploratory 任务完成后 findings 无法传递给后续任务的问题，使 exploratory → dev 链路真正有效。

## 目标

修复 findings 在以下环节的传递：

1. **execution-callback**：当任务完成时，将 result 存入 task.payload（包括 findings 字段）
2. **decomp-checker**：读取 findings 时增加降级处理，findings 为空时输出告警
3. **exploratory skill output**：在 SKILL.md 中明确要求 findings 必须通过 callback 写回

## 范围

- `brain/src/routes.js`：execution-callback 写回 findings 到 payload
- `brain/src/decomposition-checker.js`：findings 读取逻辑 + 空值告警
- `~/.claude/skills/exploratory/SKILL.md`：强化 Output Loop 要求（不走 /dev，直接改 skill）

## 成功标准

- [ ] execution-callback 接收到 result 时，将其合并到 task.payload.findings
- [ ] 查询 DB：`SELECT payload->>'findings' FROM tasks WHERE task_type='exploratory' AND status='completed'` 不再全为 NULL
- [ ] 探索续拆任务的 description 包含实际的 findings 内容
- [ ] decomp-checker 日志：findings 为空时有 WARN 日志
- [ ] 现有测试不破坏
