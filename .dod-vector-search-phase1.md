# DoD - Memory API 与递进式搜索

## 验收标准

### 功能验收

- [ ] POST /api/brain/memory/search 端点正常工作
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] GET /api/brain/memory/detail/:id 端点正常工作
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] POST /api/brain/memory/search-related 端点正常工作
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] Memory Service 正确调用 similarity.js 的 searchWithVectors()
      Test: brain/src/__tests__/services/memory-service.test.js

- [ ] /search 返回 summary 格式（id, title, similarity, preview）
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] /detail/:id 返回完整信息（description, metadata, status）
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] /search-related 正确排除 base_id 自身
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] OpenAI API 失败时降级到 Jaccard（已在 similarity.js 实现）
      Test: brain/src/__tests__/services/memory-service.test.js

### 代码质量

- [ ] Memory Service 代码符合项目规范
      Test: manual:Code Review

- [ ] API 路由使用标准 Express router 模式
      Test: manual:Code Review

- [ ] 错误处理完整（API Key 缺失、Task 不存在等）
      Test: brain/src/__tests__/routes/memory.test.js

### 测试验收

- [ ] npm test 通过（所有测试）
      Test: contract:C2-001

- [ ] Memory Service 单元测试覆盖率 > 80%
      Test: brain/src/__tests__/services/memory-service.test.js

- [ ] Memory API 集成测试覆盖率 > 80%
      Test: brain/src/__tests__/routes/memory.test.js

### 文档验收

- [ ] server.js 正确挂载 /api/brain/memory/* 路由
      Test: brain/src/__tests__/routes/memory.test.js

- [ ] DEFINITION.md 更新（如需要，新增 API 端点文档）
      Test: manual:Documentation Check

### CI 验收

- [ ] DevGate DoD 映射检查通过
      Test: contract:check-dod-mapping

- [ ] DevGate RCI 覆盖率检查通过
      Test: contract:scan-rci-coverage

- [ ] Version Check 通过
      Test: contract:check-version-sync

- [ ] Facts Check 通过
      Test: contract:facts-check
