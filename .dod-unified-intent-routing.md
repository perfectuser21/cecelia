# DoD - 统一意图路由层

## 验收标准

### 数据库变更
- [x] desires 表增加 task_layer 字段（VARCHAR(20)）
      Test: manual:psql $DATABASE_URL -c "SELECT column_name FROM information_schema.columns WHERE table_name='desires' AND column_name='task_layer'" | grep -q 'task_layer'

### 欲望路径改造
- [x] desire-formation.js 在生成欲望时调用 /plan 识别层级
      Test: packages/brain/src/__tests__/desire-formation.test.js
- [x] 识别结果存入 desires.task_layer 字段
      Test: manual:curl -s http://localhost:5221/api/brain/desires/latest | jq -e '.[0].task_layer'

### 聊天路径改造
- [x] intent.js parseIntent 调用统一路由层
      Test: packages/brain/src/__tests__/intent.test.js
- [x] parseAndCreate 创建 task 时根据 task_layer 路由
      Test: packages/brain/src/__tests__/intent.test.js

### 统一路由层实现
- [x] 新建 unified-intent-router.js 导出 routeByTaskLayer 函数
      Test: packages/brain/src/__tests__/unified-intent-router.test.js
- [x] routeByTaskLayer 正确识别 Layer 1-4 → 秋米拆解
      Test: packages/brain/src/__tests__/unified-intent-router.test.js
- [x] routeByTaskLayer 正确识别 Layer 5-6 → /dev
      Test: packages/brain/src/__tests__/unified-intent-router.test.js

### Cortex 路径改造
- [x] cortex.js 生成 actions 时根据 task_layer 路由
      Test: packages/brain/src/__tests__/cortex.test.js

### 三路汇聚验证
- [x] 欲望路径、聊天路径、Cortex 路径都调用同一个 routeByTaskLayer 函数
      Test: manual:grep -r "routeByTaskLayer" packages/brain/src/desire/ packages/brain/src/intent.js packages/brain/src/cortex.js | wc -l | grep -q '[3-9]'

### 测试验收
- [x] npm run qa 通过
      Test: contract:C2-001
