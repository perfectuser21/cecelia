---
id: prd-okr-decomp-approval
version: 1.0.0
created: 2026-02-27
updated: 2026-02-27
changelog:
  - 1.0.0: 初始版本
---

# PRD: OKR 拆解确认门（Mode A + Mode B）

## 背景

秋米拆解 KR 完成后，当前流程直接将 KR 状态设为 `reviewing`，但没有通知用户，没有创建 pending_action，用户不知道需要确认。

## 目标

实现两种确认模式：
- **Mode A（对话式）**：用户跟 Cecelia 聊时，她主动提"有 N 个拆解等你确认"
- **Mode B（通知式）**：InboxPage 显示 OKR 拆解专属卡片，用户点"确认放行"

## 功能需求

### 改动 1：execution-callback 创建 pending_action
- 当 KR status 设为 `reviewing` 时，同时创建 `action_type='okr_decomp_review'` 的 pending_action
- params: `{ kr_id, project_id }`
- context: `{ kr_title, project_name, initiatives[], decomposed_at }`
- 优先级: urgent，72 小时过期

### 改动 2：approve 端点联动 KR 放行
- `POST /pending-actions/:id/approve` 中，识别 `okr_decomp_review` 类型
- 联动将 KR `reviewing → ready`
- reject 时：可选重拆（KR 回 ready）或保留 reviewing

### 改动 3：orchestrator-chat 注入待确认信息（Mode A）
- buildContext 中查询 pending_actions where `action_type='okr_decomp_review' AND status='pending_approval'`
- 注入 systemContext 提示 Cecelia 主动告知用户

### 改动 4：InboxPage OKR 拆解专属卡片（Mode B）
- 为 `action_type='okr_decomp_review'` 添加专属卡片渲染
- 显示 KR 标题、Project、Initiative 列表
- "确认放行" → POST /pending-actions/{id}/approve
- "需要调整" → reject + comment

## 成功标准

1. okr-tick 触发后，`pending_actions` 有 `okr_decomp_review` 记录
2. KR 保持 `reviewing` 状态，等待用户确认
3. Cecelia 对话时主动提及待确认拆解
4. InboxPage 显示专属卡片，点击可放行
5. 放行后 KR 变为 `ready`，下一 tick 继续执行
